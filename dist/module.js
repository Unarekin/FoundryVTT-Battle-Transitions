"use strict";(()=>{var _e="transition-cover",Be="BATTLETRANSITIONS",Xe="\u2694\uFE0F",Ue={INITIALIZE:"battle-transitions.init",TRANSITION_START:"battle-transitions.transitionStart",TRANSITION_END:"battle-transitions.transitionEnd"};var Q=class extends PIXI.Container{setInverseMatrix(){canvas?.app?.stage&&this.transform.setFromMatrix(canvas.app.stage.localTransform.clone().invert())}constructor(){super(),this.interactiveChildren=!1,this.interactive=!1,this.eventMode="none",canvas?.app&&canvas.app.renderer.addListener("prerender",()=>{this.setInverseMatrix()})}};var u=class extends Error{constructor(e,t){e?super(game.i18n?.format(`${Be}.ERRORS.${e}`,t)):super()}};var y=class extends u{constructor(){super("CANNOTINITIALIZECANVAS")}};var J=class extends u{constructor(){super("CANVASNOTFOUND")}};var g=class extends u{constructor(e){super("INVALIDDIRECTION",{direction:e})}};var ne=class extends u{constructor(){super("INVALIDELEMENT")}};var Y=class extends u{constructor(e){super("INVALIDMACRO",{macro:e})}};var h=class extends u{constructor(e){super("INVALIDSCENE",{name:e})}};var L=class extends u{constructor(){super("INVALIDTEXTURE")}};var I=class extends u{constructor(e){super("INVALIDTRANSITION",{name:e})}};var ie=class extends u{constructor(){super("NOCOVERELEMENT")}};var oe=class extends u{constructor(){super("NOTINITIALIZED")}};var se=class extends u{constructor(){super("EXECUTECALLEDPARALLEL")}};var ae=class extends u{constructor(){super("PERMISSIONDENIED")}};var ce=class extends u{constructor(){super("TRANSITIONTOSELF")}};function dt(n){try{return new PIXI.Color(n)}catch{}}function p(n){let e=dt(n);if(e)return l(e);try{return PIXI.Texture.from(n)}catch{}}function Z(n){if(game instanceof Game&&game.scenes){if(typeof n=="string"){let e=game.scenes.get(n);if(e||(e=game.scenes.getName(n),e))return e}else if(n instanceof Scene)return n}}function Pe(n){if(n instanceof Macro)return n;if(game.macros&&typeof n=="string"){let e=game.macros?.get(n);if(e||(e=game.macros?.getName(n),e))return e;if(n.split(".")[0]==="Macro")return game.macros?.get(n.split(".").slice(1).join("."))}}var ze=Math.sqrt(3),Ge=Math.sqrt(5),ft=.5*(ze-1),q=(3-ze)/6,Pr=1/3,kr=1/6,Mr=(Ge-1)/4,Fr=(5-Ge)/20,He=n=>Math.floor(n)|0,We=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function $e(n=Math.random){let e=Tt(n),t=new Float64Array(e).map(i=>We[i%12*2]),r=new Float64Array(e).map(i=>We[i%12*2+1]);return function(o,s){let c=0,S=0,b=0,N=(o+s)*ft,w=He(o+N),Ae=He(s+N),Fe=(w+Ae)*q,pt=w-Fe,mt=Ae-Fe,D=o-pt,R=s-mt,te,re;D>R?(te=1,re=0):(te=0,re=1);let ye=D-te+q,Oe=R-re+q,Le=D-1+2*q,ve=R-1+2*q,De=w&255,Re=Ae&255,z=.5-D*D-R*R;if(z>=0){let A=De+e[Re],V=t[A],K=r[A];z*=z,c=z*z*(V*D+K*R)}let G=.5-ye*ye-Oe*Oe;if(G>=0){let A=De+te+e[Re+re],V=t[A],K=r[A];G*=G,S=G*G*(V*ye+K*Oe)}let j=.5-Le*Le-ve*ve;if(j>=0){let A=De+1+e[Re+1],V=t[A],K=r[A];j*=j,b=j*j*(V*Le+K*ve)}return 70*(c+S+b)}}function Tt(n){let t=new Uint8Array(512);for(let r=0;r<512/2;r++)t[r]=r;for(let r=0;r<512/2-1;r++){let i=r+~~(n()*(256-r)),o=t[r];t[r]=t[i],t[i]=o}for(let r=256;r<512;r++)t[r]=t[r-256];return t}var je=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

void main() {
    color = texture(uSampler, vTextureCoord);
}`;var Ve=`in vec2 aVertexPosition;

uniform mat3 projectionMatrix;

out vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition(void) {
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;
    
    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord(void) {
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void) {
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var f=class extends PIXI.Filter{constructor(e,t,r){super(e||Ve,t||je,r),this.program.fragmentSrc.includes("#version 300 es")||(this.program.fragmentSrc=`#version 300 es 
`+this.program.fragmentSrc),this.program.vertexSrc.includes("#version 300 es")||(this.program.vertexSrc=`#version 300 es
`+this.program.vertexSrc)}};var Ke=`precision highp float;

in vec2 vTextureCoord;
out vec4 color;

uniform sampler2D uSampler;
uniform sampler2D noise_texture;
uniform sampler2D burn_texture;

uniform float integrity;
uniform float burn_size;

float inverse_lerp(float a, float b, float v) {
    return (v - a) / (b - a);
}

void main() {
    float noise = texture(noise_texture, vTextureCoord).r * vTextureCoord.y;
    vec4 base_color = texture(uSampler, vTextureCoord) * step(noise, integrity);
    vec2 burn_uv = vec2(inverse_lerp(integrity, integrity * burn_size, noise), 0.0);
    vec4 burn_color = texture(burn_texture, burn_uv) * step(noise, integrity * burn_size);
    
    color = mix(burn_color, base_color, base_color.a);
    // color = texture(uSampler, vTextureCoord);
}`;var ht=Je(1024,new PIXI.Color("#ff0400"),new PIXI.Color("#ffff01")),_=class extends f{constructor(e="transparent",t=1.3){let i={noise_texture:Qe(),integrity:1,burn_size:t,burn_texture:ht};super(void 0,Ke,i)}};var Ye=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform float size;
uniform vec2 screen_size;
uniform sampler2D bgSampler;

void main() {
    vec2 screenCoord = screen_size * vTextureCoord;
    
    float x = abs(fract(screenCoord.x / size) - 0.5);
    float y = abs(fract(screenCoord.y / size) - 0.5);
    
    if (x + y + vTextureCoord.x > progress * 2.0) {
        color = texture(uSampler, vTextureCoord);
    } else {
        color = texture(bgSampler, vTextureCoord);
    }
}`;var P=class extends f{constructor(e,t="transparent"){let r=p(t)??l("transparent");super(void 0,Ye,{progress:0,size:e,bgSampler:r,screen_size:{x:window.innerWidth,y:window.innerHeight}})}};var Ze=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform sampler2D wipeSampler;
uniform sampler2D bgSampler;

void main() {
    vec4 wipe = texture(wipeSampler, vTextureCoord);
    
    if (wipe.b < progress) {
        color = texture(bgSampler, vTextureCoord);
    } else {
        color = texture(uSampler, vTextureCoord);
    }
}`;var xt=l(new PIXI.Color("#00000000")),T=class extends f{constructor(e,t){let r={progress:0,wipeSampler:e,bgSampler:t??xt};super(void 0,Ze,r)}};var qe=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform sampler2D bgColor;

void main() {
    color = mix(texture(uSampler, vTextureCoord), texture(bgColor, vTextureCoord), progress);
}`;var k=class extends f{constructor(e="transparent"){let t=p(e)??l("transparent");super(void 0,qe,{bgColor:t,progress:0})}};var Nt={horizontal:{inside:"bilinear-horizontal-inside.webp",outside:"bilinear-horizontal-outside.webp"},vertical:{inside:"bilinear-vertical-inside.webp",outside:"bilinear-vertical-outside.webp"},topleft:{inside:"bilinear-top-left-inside.webp",outside:"bilinear-top-right-outside.webp"},topright:{inside:"bilinear-top-right-inside.webp",outside:"bilinear-top-right-outside.webp"},bottomleft:{inside:"bilinear-top-right-inside.webp",outside:"bilinear-top-right-outside.webp"},bottomright:{inside:"bilinear-top-left-inside.webp",outside:"bilinear-top-right-outside.webp"}},M=class extends T{constructor(e,t,r){let i=p(r)??l("transparent"),o=Nt[e]?.[t];if(!o)throw new g(`${e}-${t}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}`);super(s,i)}};var wt={left:"linear-left.webp",right:"linear-right.webp",top:"linear-top.webp",bottom:"linear-bottom.webp",topleft:"linear-top-left.webp",topright:"linear-top-right.webp",bottomleft:"linear-bottom-left.webp",bottomright:"linear-bottom-right.webp"},F=class extends T{constructor(e,t){let r=p(t)??l("transparent"),i=wt[e];if(!i)throw new g(e);let o=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${i}`);super(o,r)}};var At={clockwise:{top:"clockwise-top.webp",left:"clockwise-left.webp",right:"clockwise-right.webp",bottom:"clockwise-bottom.webp"},counterclockwise:{top:"anticlockwise-top.webp",left:"anticlockwise-left.webp",right:"anticlockwise-right.webp",bottom:"anticlockwise-bottom.webp"}},B=class extends T{constructor(e,t,r){let i=p(r)??l("transparent"),o=At[e]?.[t];if(!o)throw new g(`${e}-${t}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}`);super(s,i)}};var yt={left:{inside:"spotlight-left-inside.webp",outside:"spotlight-right-outside.webp"},top:{inside:"spotlight-top-inside.webp",outside:"spotlight-top-outside.webp"},right:{inside:"spotlight-right-inside.webp",outside:"spotlight-right-outside.webp"},bottom:{inside:"spotlight-bottom-inside.webp",outside:"spotlgiht-bottom-outside.webp"}},X=class extends T{constructor(e,t,r="transparent"){let i=p(r)??l("transparent"),o=yt[e]?.[t];if(!o)throw new g(`${e}-${t}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}`);super(s,i)}};var Ot={inside:"radial-inside.webp",outside:"radial-outside.webp"},U=class extends T{constructor(e,t){let r=p(t)??l("transparent"),i=Ot[e];if(!i)throw new g(e);let o=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${i}`);super(o,r)}};var et=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform sampler2D uTexture;

void main() {
    color = texture(uTexture, vTextureCoord);
}`;var v=class extends f{constructor(e){let t=p(e);if(!t)throw new L;super(void 0,et,{uTexture:t})}};var H=class n{#r=null;#e=[];#n=[];#i=null;#t="none";#o={bilinearwipe:this.#c.bind(this),clockwipe:this.#d.bind(this),diamondwipe:this.#l.bind(this),fade:this.#p.bind(this),firedissolve:this.#m.bind(this),linearwipe:this.#a.bind(this),macro:this.#h.bind(this),parallel:this.#E.bind(this),radialwipe:this.#u.bind(this),removeoverlay:this.#b.bind(this),spotlightwipe:this.#f.bind(this),textureswap:this.#T.bind(this),sound:this.#I.bind(this),video:this.#S.bind(this),wait:this.#g.bind(this)};get sequence(){return this.#e}constructor(e){try{if(e){let t=Z(e);if(!t)throw new h(e);this.#r=t}}catch(t){throw ui.notifications?.error(t.message),t}}async#s(e,t){for(let r of e){if(typeof this.#o[r.type]!="function")throw new I(r.type);let i=this.#o[r.type];typeof i=="function"&&await i(r,t)}}async execute(e=!1,t,r){if(!this.#r)throw new h("undefined");if(this.#r.id===canvas.scene?.id)throw new ce;if(e){if(!t)throw new I(typeof t);let i=await tt();this.#i=i.children[1],rt(),r!==game.users?.current?.id?await ue("canvasReady"):r===game.users?.current?.id&&await ot(this.#r),nt(),it(),await this.#s(t,i);for(let o of this.#n)o.stop();ke(i)}else{if(!this.#r.canUserModify(game.users?.current??null,"update"))throw new ae;O.transition(this.#r.id??"",t||this.#e)}}async#a(e,t){let r=C(e.background??l("transparent")),i=new F(e.direction,r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}linearWipe(e,t=1e3,r="transparent",i=this.#t){new F(e,r);let o=E(r);return this.#e.push({type:"linearwipe",duration:t,direction:e,background:o,easing:i}),this}async#c(e,t){let r=C(e.background),i=new M(e.direction,e.radial,r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}bilinearWipe(e,t,r=1e3,i="transparent",o=this.#t){new M(e,t,i);let s=E(i);return this.#e.push({type:"bilinearwipe",duration:r,direction:e,radial:t,background:s,easing:o}),this}async#u(e,t){let r=C(e.background),i=new U(e.radial,r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}radialWipe(e,t=1e3,r="transparent",i=this.#t){return new U(e,r),this.#e.push({type:"radialwipe",duration:t,radial:e,background:E(r),easing:i}),this}async#l(e,t){let r=C(e.background),i=new P(e.size,r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}diamondWipe(e,t=1e3,r="transparent",i=this.#t){return new P(e,r),this.#e.push({type:"diamondwipe",size:e,background:E(r),duration:t,easing:i}),this}async#p(e,t){let r=C(e.background),i=new k(r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}fade(e,t="transparent",r=this.#t){return new k(t),this.#e.push({type:"fade",duration:e,background:E(t),easing:r}),this}async#m(e,t){let r=new _(e.background,e.burnSize);Array.isArray(t.filters)?t.filters.push(r):t.filters=[r],await TweenMax.to(r.uniforms,{integrity:0,duration:e.duration/1e3,ease:e.easing||this.#t})}burn(e=1e3,t="transparent",r=1.3,i=this.#t){return new _(t,r),this.#e.push({type:"firedissolve",background:E(t),duration:e,burnSize:r,easing:i}),this}async#d(e,t){let r=C(e.background),i=new B(e.clockdirection,e.direction,r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}clockWipe(e,t,r=1e3,i="transparent",o=this.#t){return new B(e,t,i),this.#e.push({type:"clockwipe",duration:r,background:E(i),direction:t,clockdirection:e,easing:o}),this}async#f(e,t){let r=C(e.background),i=new X(e.direction,e.radial,r.baseTexture);Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],await TweenMax.to(i.uniforms,{progress:1,duration:e.duration/1e3,ease:e.easing||this.#t})}spotlightWipe(e,t,r=1e3,i="transparent",o=this.#t){return new X(e,t,i),this.#e.push({type:"spotlightwipe",direction:e,radial:t,duration:r,background:E(i),easing:o}),this}async#T(e,t){let r=C(e.texture),i=new v(r.baseTexture);return Array.isArray(t.filters)?t.filters.push(i):t.filters=[i],Promise.resolve()}textureSwap(e){return new v(e),this.#e.push({type:"textureswap",texture:E(e)}),this}async#g(e){return new Promise(t=>{setTimeout(t,e.duration)})}wait(e){return this.#e.push({type:"wait",duration:e}),this}async#I(e){await foundry.audio.AudioHelper.preloadSound(e.file);let t=await foundry.audio.AudioHelper.play({src:e.file,volume:e.volume/100,autoplay:!0},!0);return this.#n.push(t),Promise.resolve()}sound(e,t=100){return this.#e.push({type:"sound",file:typeof e=="string"?e:e.src,volume:t}),this}async#S(e,t){let r=await PIXI.Assets.load(e.file),o=r.baseTexture.resource.source;return new Promise((s,c)=>{let S=new v(r.baseTexture),b=PIXI.Sprite.from(r);t.addChild(b),b.filters=[S],o.addEventListener("ended",()=>{s()}),o.addEventListener("error",N=>{c(N.error)}),o.play()})}video(e,t,r="transparent"){return this.#e.push({type:"video",file:e,volume:t,background:E(r)}),this}async#h(e){let t=Pe(e.macro);if(!t)throw new Y(e.macro);let r=t.execute();if(r instanceof Promise)await r;else return Promise.resolve()}macro(e){let t=Pe(e);if(!t)throw new Y(typeof e=="string"?e:typeof e);return this.#e.push({type:"macro",macro:t.id}),this}async#E(e,t){await Promise.all(e.sequences.map(r=>this.#s(r,t)))}parallel(...e){let t=[];for(let r of e){let i=new n;if(r(i)instanceof Promise)throw new se;t.push(i.sequence)}return this.#e.push({type:"parallel",sequences:t}),this}async#b(){return this.#i&&(this.#i.alpha=0),Promise.resolve()}removeOverlay(){return this.#e.push({type:"removeoverlay"}),this}static TriggerForScene(e){let t=Z(e);if(!t)throw new h(typeof e=="string"?e:typeof e);let r=t.getFlag("battle-transitions","steps")??[];r.length&&O.transition(t.id??"",r)}static Cleanup(){ke()}static async SelectScene(){let e=await renderTemplate("/modules/battle-transitions/templates/scene-selector.hbs",{scenes:game.scenes?.contents.map(t=>({id:t.id,name:t.name}))});return Dialog.wait({title:a("BATTLETRANSITIONS.SCENESELECTOR.TITLE"),content:e,default:"ok",buttons:{cancel:{icon:"<i class='fas fa-times'></i>",label:a("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>null},ok:{icon:"<i class='fas fa-check'></i>",label:a("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),callback:t=>game.scenes?.get($(t).find("#scene").val())??null}}})}};var Me=class{#r;transition(e,t){this.#r.executeForEveryone("transition.exec",e,t,game.users?.current?.id??"")}_execute(e,t,r){ee("Executing transition chain:",t),new H(e).execute(!0,t,r)}register(e){ee("Registering socket:",e),this.#r=e,e.register("transition.exec",this._execute.bind(this))}},O=new Me;function Qe(n=256,e=256,t){let r=$e(t),i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new y;i.width=n,i.height=e;let s=o.createImageData(i.width,i.height),c=s.data;for(let S=0;S<i.height;S++)for(let b=0;b<i.width;b++){let N=r(b/32,S/32),w=(S*i.width+b)*4;c[w]=N*255,c[w+1]=N*255,c[w+2]=N*255,c[w+3]=255}return o.putImageData(s,0,0),PIXI.Texture.from(i)}function Je(n,e,t){let r=document.createElement("canvas");r.width=n,r.height=1;let i=r.getContext("2d");if(!i)throw new y;let o=i.createLinearGradient(0,0,n,0),s=e??new PIXI.Color("white"),c=t??new PIXI.Color("black");return o.addColorStop(0,s.toHex()),o.addColorStop(1,c.toHex()),i.fillStyle=o,i.fillRect(0,0,n,1),PIXI.Texture.from(r)}function l(n){let e=document.createElement("canvas");e.width=1,e.height=1;let t=e.getContext("2d");if(!t)throw new y;let r=new PIXI.Color(n);return t.fillStyle=r.toHexa(),t.fillRect(0,0,1,1),PIXI.Texture.from(e)}async function ue(n){return new Promise(e=>{Hooks.once(n,(...t)=>{e(t)})})}function a(n,e={}){return game.i18n?.format(n,e)??n}function le(){return game.release?.isNewer("12")??!1}function st(n){let e=atob(n.split(",")[1]),t=new Uint8Array(e.length);for(let r=0;r<t.length;r++)t[r]=e.charCodeAt(r);return t}function vt(n){let e=st(n.toDataURL());return{width:n.width,height:n.height,buffer:e}}function Dt(n){let e=st(n);return{mimeType:n.split(";")[0].split(":")[1],buffer:e}}function E(n){if(typeof n=="string"&&n.startsWith("data:"))return Dt(n);if(typeof n=="string")return n;if(typeof n.src=="string")return n.src;if(typeof n.value<"u")return n.value;let t=n.baseTexture.resource;if(typeof t.data<"u")return{width:t.width,height:t.height,buffer:t.data};let r=t.source;if(r instanceof HTMLImageElement)return r.getAttribute("src");if(r instanceof HTMLCanvasElement)return vt(r);throw console.error(n),new L}function Rt(n){let e=btoa(String.fromCharCode.apply(null,n.buffer));return PIXI.Texture.from(`data:${n.mimeType};base64,${e}`)}function _t(n){return PIXI.Texture.fromBuffer(n.buffer,n.width,n.height)}function C(n){if(typeof n=="string"){let r=p(n);if(r)return r}let e=n;if(e.buffer&&e.mimeType)return Rt(e);let t=n;if(t.buffer&&t.width&&t.height)return _t(t);throw new L}function ee(...n){console.log(Xe,"Battle Transitions",...n)}function at(n){n.push({name:"BATTLETRANSITIONS.NAVIGATION.TRIGGER",icon:'<i class="fas icon fa-fw crossed-swords"></i>',condition:e=>{let t=game.scenes?.get(e.data("sceneId")),r=t?.getFlag("battle-transitions","steps")??[];return game.users?.current&&t?.canUserModify(game.users?.current,"update")&&!t.active&&r.length},callback:e=>{let t=e.data("sceneId");if(!t)throw new h(typeof t=="string"?t:typeof t);let r=game.scenes?.get(t);if(!(r instanceof Scene))throw new h(typeof t=="string"?t:typeof t);let i=r.getFlag("battle-transitions","steps")??[];i.length&&O.transition(t,i)}})}function d(){return{none:"BATTLETRANSITIONS.EASINGS.NONE",power1in:"BATTLETRANSITIONS.EASINGS.POWER1IN",power1out:"BATTLETRANSITIONS.EASINGS.POWER1OUT",power1inout:"BATTLETRANSITIONS.EASINGS.POWER1INOUT",power2in:"BATTLETRANSITIONS.EASINGS.POWER2IN",power2out:"BATTLETRANSITIONS.EASINGS.POWER2OUT",power2inout:"BATTLETRANSITIONS.EASINGS.POWER2INOUT",power3in:"BATTLETRANSITIONS.EASINGS.POWER3IN",power3out:"BATTLETRANSITIONS.EASINGS.POWER3OUT",power3inout:"BATTLETRANSITIONS.EASINGS.POWER3INOUT",power4in:"BATTLETRANSITIONS.EASINGS.POWER4IN",power4out:"BATTLETRANSITIONS.EASINGS.POWER4OUT",power4inout:"BATTLETRANSITIONS.EASINGS.POWER4INOUT",backin:"BATTLETRANSITIONS.EASINGS.BACKIN",backout:"BATTLETRANSITIONS.EASINGS.BACKOUT",backinout:"BATTLETRANSITIONS.EASINGS.BACKINOUT",bouncein:"BATTLETRANSITIONS.EASINGS.BOUNCEIN",bounceout:"BATTLETRANSITIONS.EASINGS.BOUNCEOUT",bounceinout:"BATTLETRANSITIONS.EASINGS.BOUNCEINOUT",circin:"BATTLETRANSITIONS.EASINGS.CIRCIN",circout:"BATTLETRANSITIONS.EASINGS.CIRCOUT",circinout:"BATTLETRANSITIONS.EASINGS.CIRCINOUT",elasticin:"BATTLETRANSITIONS.EASINGS.ELASTICIN",elasticout:"BATTLETRANSITIONS.EASINGS.ELASTICOUT",elasticinout:"BATTLETRANSITIONS.EASINGS.ELASTICINOUT",expoin:"BATTLETRANSITIONS.EASINGS.EXPOIN",expoout:"BATTLETRANSITIONS.EASINGS.EXPOOUT",expoinout:"BATTLETRANSITIONS.EASINGS.EXPOINOUT",sinein:"BATTLETRANSITIONS.EASINGS.SINEIN",sineout:"BATTLETRANSITIONS.EASINGS.SINEOUT",sineinout:"BATTLETRANSITIONS.EASINGS.SINEINOUT"}}function m(n,...e){let t=n.serializeArray(),r=e.reduce((i,o)=>({...i,[o]:t.reduce((s,c)=>c.name===o?o==="id"&&!c.value?foundry.utils.randomID():c.value:s,"")}),{});return console.log("Parsed:",r),r}var x=document.createElement("div");x.style.display="none";x.style.position="absolute";x.style.width="100%";x.style.height="100%";x.id=_e;document.body.appendChild(x);var pe=null;function ct(){pe=new Q,canvas?.stage?.addChild(pe)}async function Pt(){if(!canvas)throw new J;if(!(canvas.app&&canvas.hidden&&canvas.primary&&canvas.tiles&&canvas.drawings&&canvas.scene&&canvas.stage))throw new oe;let{sceneWidth:n,sceneHeight:e}=canvas.scene.dimensions,t=canvas.app.renderer,r=PIXI.RenderTexture.create({width:n,height:e});t.render(canvas.stage,{renderTexture:r,skipUpdateTransform:!0,clear:!0});let i=document.getElementById(_e);if(!i)throw new ie;i.style.backgroundImage="";let o=Date.now(),s=await t.extract.image(r);return ee(`Image transfered in ${Date.now()-o}ms`),i.style.backgroundImage=`url(${s.src})`,i.style.backgroundColor=t.background.backgroundColor.toHex(),i.style.display="block",PIXI.Sprite.from(r)}async function tt(){if(!pe)throw new y;let n=await Pt(),e=new PIXI.Container,t=l(canvas?.app?.renderer.background.backgroundColor??"white");return e.addChild(new PIXI.Sprite(t)),e.addChild(n),pe.addChild(e),e}function ke(n){if(x.style.display="none",x.style.backgroundImage="",n){if(Array.isArray(n.children)&&n.children.length)for(let e=n.children.length-1;e>=0;e--)n.children[e].destroy();n.destroy()}}function rt(){let n=document.getElementById("loading");n&&(n.style.opacity="0")}function nt(){let n=document.getElementById("loading");n&&n.style.removeProperty("opacity")}function it(){x.style.display="none",x.style.removeProperty("backgroundImage")}async function ot(n){let e=Z(n);if(!(e instanceof Scene))throw new h(typeof n=="string"?n:"[Object object]");return await e.setFlag("battle-transitions","autoTriggered",!0),e.activate(),await ue("canvasReady"),e}function ut(){Handlebars.registerHelper("switch",function(n,e){this._switch_value_=n;let t=e.fn(this);return delete this._switch_value_,t}),Handlebars.registerHelper("case",function(n,e){if(n==this._switch_value_)return e.fn(this)})}async function lt(){return loadTemplates(["/modules/battle-transitions/templates/scene-config.hbs",...["add-step","fade-config","linearwipe-config","step-item"].map(n=>`/modules/battle-transitions/templates/config/${n}.hbs`)])}var me=class{get key(){return"fade"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.FADE"}defaultSettings={duration:1e3,background:"#00000000"};generateSummary(e){return e?[a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:e.duration}),e.background].join("; "):""}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/fade-config.hbs",{...this.defaultSettings,...e,easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","background","easing")}}};var de=class{defaultSettings={duration:1e3,background:"#00000000",direction:"left"};generateSummary(e){let t={...this.defaultSettings,...e};return[t.direction,t.duration,t.background].join("; ")}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/linearwipe-config.hbs",{...this.defaultSettings,...e,directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM",topleft:"BATTLETRANSITIONS.DIRECTIONS.TOPLEFT",topright:"BATTLETRANSITIONS.DIRECTIONS.TOPRIGHT",bottomleft:"BATTLETRANSITIONS.DIRECTIONS.BOTTOMLEFT",bottomright:"BATTLETRANSITIONS.DIRECTIONS.BOTTOMRIGHT"},easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","direction","background","easing")}}get key(){return"linearwipe"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.LINEARWIPE"}};var fe=class{get key(){return"bilinearwipe"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.BILINEARWIPE"}defaultSettings={duration:1e3,direction:"horizontal",radial:"inside",background:"#00000000"};generateSummary(e){return e?[a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:e.duration}),e.direction,e.radial,e.background].join("; "):""}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/bilinear-wipe-config.hbs",{...this.defaultSettings,...e,directionSelect:{horizontal:"BATTLETRANSITIONS.DIRECTIONS.HORIZONTAL",vertical:"BATTLETRANSITIONS.DIRECTIONS.VERTICAL",topleft:"BATTLETRANSITIONS.DIRECTIONS.TOPLEFT",topright:"BATTLETRANSITIONS.DIRECTIONS.TOPRIGHT"},radialSelect:{inside:"BATTLETRANSITIONS.DIRECTIONS.INSIDE",outside:"BATTLETRANSITIONS.DIRECTIONS.OUTSIDE"},easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"duration","background","direction","radial","easing","id")}}};var Te=class{get key(){return"chromakey"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.CHROMAKEY"}defaultSettings={keyColor:"#00b140",background:"#00000000"};generateSummary(e){let t={...this.defaultSettings,...e};return[t.keyColor,t.background].join("; ")}async renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/chromakey-config.hbs",{...this.defaultSettings,...e})}createFlagFromHTML(e){let t=$(e).find("form").serializeArray(),r=t.find(o=>o.name==="key-color"),i=t.find(o=>o.name==="background");return{...this.defaultSettings,...r?{keyColor:r.value}:{},...i?{background:i.value}:{}}}};var ge=class{get key(){return"clockwipe"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.CLOCKWIPE"}defaultSettings={direction:"top",clockdirection:"clockwise",duration:1e3,background:"#00000000"};generateSummary(e){let t={...this.defaultSettings,...e};return[t.clockdirection,t.direction,a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.duration}),t.background].join("; ")}async renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/clockwipe-config.hbs",{...this.defaultSettings,...e,directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"},clockDirectionSelect:{clockwise:"BATTLETRANSITIONS.DIRECTIONS.CLOCKWISE",counterclockwise:"BATTLETRANSITIONS.DIRECTIONS.COUNTERCLOCKWISE"},easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","direction","background","clockdirection","easing")}}};var Ie=class{get key(){return"diamondwipe"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.DIAMOND"}defaultSettings={duration:1e3,size:40,background:"#00000000"};generateSummary(e){let t={...this.defaultSettings,...e};return[a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.duration}),a("BATTLETRANSITIONS.FORMATTERS.PIXELS",{value:t.size}),t.background].join("; ")}async renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/diamond-config.hbs",{...this.defaultSettings,...e,easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","size","easing")}}};var Se=class{get key(){return"firedissolve"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.FIREDISSOLVE"}defaultSettings={duration:1e3,background:"#00000000",burnSize:1.3};generateSummary(e){let t={...this.defaultSettings,...e};return[a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.duration}),t.background].join("; ")}async renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/fire-dissolve-config.hbs",{...this.defaultSettings,...e,easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","background","burnsize","easing")}}};var he=class{get key(){return"radialwipe"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.RADIALWIPE"}defaultSettings={duration:1e3,background:"#00000000",radial:"inside"};generateSummary(e){let t={...this.defaultSettings,...e};return[a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.duration}),t.radial,t.background].join("; ")}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/radial-wipe-config.hbs",{...e,radialOptions:{inside:"BATTLETRANSITIONS.DIRECTIONS.INSIDE",outside:"BATTLETRANSITIONS.DIRECTIONS.OUTSIDE"},easingSelect:d()})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","radial","background","easing")}}};var Ee=class{get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.SPOTLIGHTWIPE"}get key(){return"spotlightwipe"}defaultSettings={duration:1e3,background:"#00000000",direction:"top",radial:"outside"};generateSummary(e){let t={...this.defaultSettings,...e};return[a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.duration}),t.direction,t.radial,t.background].join("; ")}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration","direction","radial","background","easing")}}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/spotlight-wipe-config.hbs",{...e,directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"},radialSelect:{inside:"BATTLETRANSITIONS.DIRECTIONS.INSIDE",outside:"BATTLETRANSITIONS.DIRECTIONS.OUTSIDE"},easingSelect:d()})}};var be=class{get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.TEXTURESWAP"}get key(){return"textureswap"}defaultSettings={texture:""};generateSummary(e){return[{...this.defaultSettings,...e}.texture.split("/").slice(-1)].join("; ")}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/texture-swap-config.hbs",{...this.defaultSettings,...e})}createFlagFromHTML(e){let r=$(e).find("form").serializeArray().find(o=>o.name==="id"),i=$(e).find("form #texture").val()??"";return{...this.defaultSettings,texture:i,id:r?r.value:foundry.utils.randomID()}}};var xe=class{get key(){return"wait"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.WAIT"}defaultSettings={duration:1e3};generateSummary(e){let t={...this.defaultSettings,...e};return a("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.duration})}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/wait-config.hbs",{...this.defaultSettings,...e})}createFlagFromHTML(e){return{...this.defaultSettings,...m($(e).find("form"),"id","duration")}}};var Ce=class{get key(){return"sound"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.SOUND"}defaultSettings={file:"",volume:1};generateSummary(e){let t={...this.defaultSettings,...e};return[t.file.split("/").slice(-1),a("BATTLETRANSITIONS.FORMATTERS.PERCENT",{value:t.volume*100})].join("; ")}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/sound-config.hbs",{...this.defaultSettings,...e})}createFlagFromHTML(e){let t=$(e).find("form").serializeArray(),r=$(e).find("form #file").val()??"",i=t.find(s=>s.name==="volume"),o=t.find(s=>s.name==="id");return{...this.defaultSettings,...r?{file:r}:{},...i?{volume:parseFloat(i.value)/100}:{},id:o?o.value:foundry.utils.randomID()}}};var Ne=class{get key(){return"video"}get name(){return"BATTLETRANSITIONS.TRANSITIONTYPES.VIDEO"}defaultSettings={file:"",background:"#00000000",volume:1};generateSummary(e){let t={...this.defaultSettings,...e};return[t.file.split("/").splice(-1),a("BATTLETRANSITIONS.FORMATTERS.PERCENT",{value:t.volume*100})].join("; ")}renderTemplate(e){return renderTemplate("/modules/battle-transitions/templates/config/video-config.hbs",{...this.defaultSettings,...e,volume:(e?.volume!==void 0?e.volume:this.defaultSettings.volume)*100})}createFlagFromHTML(e){let t=$(e).find("form").serializeArray(),r=$(e).find("form #file").val()??"",i=$(e).find("form #volume input[type='number']").val(),o=t.find(s=>s.name==="id");return{...this.defaultSettings,...r?{file:r}:{},...i?{volume:i/100}:{},id:o?o.value:foundry.utils.randomID()}}};new Te;var W=[new me,new de,new fe,new ge,new Ie,new Se,new he,new Ee,new be,new xe,new Ce,new Ne].sort((n,e)=>a(n.name).localeCompare(a(e.name))),we=class{#r;#e;#n=null;stepKey="steps";configKey="config";tabName="battle-transitions";icon=["fas","crossed-swords","fa-fw","icon"];get appId(){return this.#r.appId}get rootElement(){return $(this.#r.element)}get addStepDialogElement(){return this.#n?$(this.#n.element):null}updateConfiguration(){let e=[];this.rootElement.find(".step-config-item[data-transition-type]").each((i,o)=>{let s=$(o).data("flag"),c=$(o).data("transition-type");if(!c||typeof c!="string"||typeof s!="object")throw new I("");e.push({...s,type:c})});let r={autoTrigger:this.rootElement.find('[data-tab="battle-transitions"]').find("input#auto-trigger").is(":checked")};Promise.all([this.#e.setFlag("battle-transitions",this.stepKey,e),this.#e.setFlag("battle-transitions",this.configKey,r)])}addEventListeners(){this.rootElement.find("button[data-action='add-step']").on("click",e=>{if($(e.currentTarget).is(":focus"))return this.onAddStep(e)}),this.rootElement.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),this.rootElement.find("button[type='submit']").on("click",()=>{this.updateConfiguration()}),ColorPicker.install()}onAddStep(e){e.preventDefault(),le()&&foundry.applications.api.DialogV2?this.addStepDialogV2():this.addStepDialog()}resizeDialog(){this.rootElement.find(".item.active[data-tab]").data("tab")===this.tabName&&(this.#r.activateTab("basic"),this.#r.activateTab(this.tabName))}addStepEventListeners(e,t={}){e.find("[data-action='remove']").on("click",()=>{let r=e.data("transition-type")??"",i=W.find(o=>o.key===r);if(!i)throw new I(r);le()&&foundry.applications.api.DialogV2?foundry.applications.api.DialogV2.confirm({content:a("BATTLETRANSITIONS.SCENECONFIG.REMOVECONFIRM",{name:a(i.name)})}).then(o=>{o&&(e.remove(),this.resizeDialog())}):Dialog.confirm({content:a("BATTLETRANSITIONS.SCENECONFIG.REMOVECONFIRM",{name:a(i.name)})}).then(o=>{o&&(e.remove(),this.resizeDialog())})}),e.find("[data-action='configure']").on("click",()=>{let r=e.data("transition-type")??"",i=W.find(s=>s.key===r);if(!i)throw new I(r);let o=e.data("flag")??i.defaultSettings;this.configureStep(r,o)})}addConfigureStepEventListeners(e,t={}){e.find("input[type='text'],input[type='number']").on("focus",r=>{r.currentTarget.select()}),ColorPicker.install()}async configureStep(e,t={}){let r=W.find(o=>o.key===e);if(!r)throw new I(e);let i=await r.renderTemplate(t);le()&&foundry.applications.api.DialogV2?foundry.applications.api.DialogV2.wait({window:{title:a("BATTLETRANSITIONS.SCENECONFIG.EDITSTEPDIALOG.TITLE",{name:a(r.name)})},content:i,render:(o,s)=>{this.addConfigureStepEventListeners($(s),t)},buttons:[{label:"<i class='fas fa-times'></i> "+a("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),action:"cancel"},{label:"<i class='fas fa-check'></i> "+a("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),action:"ok",default:!0,callback:async(o,s,c)=>{let S=r.createFlagFromHTML($(c));this.addUpdateTransitionStep(e,S)}}]}):await Dialog.wait({title:a("BATTLETRANSITIONS.SCENECONFIG.EDITSTEPDIALOG.TITLE",{name:a(r.name)}),content:i,render:o=>{this.addConfigureStepEventListeners(o,t)},default:"ok",buttons:{cancel:{icon:"<i class='fas fa-times'></i>",label:a("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")},ok:{icon:"<i class='fas fa-check'></i>",label:a("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),callback:o=>{let s=r.createFlagFromHTML(o);this.addUpdateTransitionStep(e,s)}}}})}async addUpdateTransitionStep(e,t={}){let r=W.find(c=>c.key===e);if(!r)throw new I(e);t.id||(t.id=foundry.utils.randomID());let i=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...t??{},name:a(r?.name),summary:r.generateSummary(t),type:e,flag:JSON.stringify(t)}),o=$(i),s=this.rootElement.find(`[data-id="${t.id}"]`);s.length?s.replaceWith(o):this.rootElement.find("#transition-step-list").append(o),this.addStepEventListeners(o,t),this.resizeDialog(),ColorPicker.install()}async getRenderedDialogTemplate(){return renderTemplate("/modules/battle-transitions/templates/config/add-step.hbs",{transitionTypes:W.map(e=>({key:e.key,name:e.name}))})}onAddStepDialogRender(){if(!this.addStepDialogElement)throw new ne;this.addStepDialogElement.find("#add-step-form button[data-transition]").on("click",e=>{e.preventDefault();let t=e.currentTarget.dataset.transition??"";this.#n?.close();let r=W.find(i=>i.key===t);if(!r)throw new I(t);this.configureStep(t,r.defaultSettings)})}async addStepDialog(){let e=await this.getRenderedDialogTemplate(),t=new Dialog({title:a("BATTLETRANSITIONS.SCENECONFIG.ADDSTEPDIALOG.TITLE"),content:e,render:()=>{this.onAddStepDialogRender()},buttons:{cancel:{label:a("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),icon:"<i class='fas fa-times'></i>"}}});this.#n=t,t.render(!0)}async addStepDialogV2(){let e=await this.getRenderedDialogTemplate();foundry.applications.api.DialogV2.wait({window:{title:"BATTLETRANSITIONS.SCENECONFIG.ADDSTEPDIALOG.TITLE"},rejectClose:!1,render:t=>{this.#n=t.target,this.onAddStepDialogRender()},content:e,buttons:[{label:"<i class='fas fa-times'></i> "+a("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),action:"cancel"}]}).then(t=>t==="cancel"?null:t)}async inject(){return game.release?.isNewer("12")?this.injectV12():this.injectV11()}async injectV11(){let e=this.rootElement.find("nav.sheet-tabs.tabs"),t=document.createElement("a");t.classList.add("item"),t.dataset.tab=this.tabName;let r=document.createElement("i");r.classList.add(...this.icon),t.appendChild(r),t.innerHTML+=" "+a("BATTLETRANSITIONS.SCENECONFIG.TAB"),e.append(t);let i=this.#e.getFlag("battle-transitions",this.configKey),o=await renderTemplate("/modules/battle-transitions/templates/scene-config.hbs",i);this.rootElement.find("button[type='submit']").before(`<div class="tab" data-tab="${this.tabName}">${o}</div>`);let s=this.#e.getFlag("battle-transitions",this.stepKey);if(Array.isArray(s))for(let c of s)await this.addUpdateTransitionStep(c.type,c);this.addEventListeners()}async injectV12(){let e=this.rootElement.find("nav.sheet-tabs.tabs[data-group='main']"),t=document.createElement("a");t.classList.add("item"),t.dataset.tab=this.tabName;let r=document.createElement("i");r.classList.add(...this.icon),t.appendChild(r),t.innerHTML+=" "+a("BATTLETRANSITIONS.SCENECONFIG.TAB"),e.append(t);let i=this.#e.getFlag("battle-transitions",this.configKey),o=await renderTemplate("/modules/battle-transitions/templates/scene-config.hbs",i);this.rootElement.find("footer.sheet-footer").before(`<div class="tab" data-group="main" data-tab="${this.tabName}">${o}</div>`);let s=this.#e.getFlag("battle-transitions",this.stepKey);if(Array.isArray(s))for(let c of s)await this.addUpdateTransitionStep(c.type,c);this.addEventListeners()}constructor(e,t){this.#r=e,this.#e=t,this.inject()}};window.BattleTransition=H;Hooks.once("canvasReady",()=>{ct(),Hooks.callAll(Ue.INITIALIZE)});Hooks.on("renderSceneConfig",n=>{new we(n,n.object)});Hooks.once("init",async()=>{ut(),await lt()});Hooks.once("socketlib.ready",()=>{O.register(socketlib.registerModule("battle-transitions"))});Hooks.on("getSceneNavigationContext",(n,e)=>{at(e)});Hooks.on("preUpdateScene",(n,e,t,r)=>{if(e.active&&!(n.getFlag("battle-transitions","autoTriggered")??!1)){let i=n.getFlag("battle-transitions","config"),o=n.getFlag("battle-transitions","steps");i?.autoTrigger&&o?.length&&(e.active=!1,O.transition(n.id,o))}});Hooks.on("updateScene",async(n,e,t,r)=>{e.active&&(n.getFlag("battle-transitions","autoTriggered")??!1)&&n.canUserModify(game.users?.current,"update")&&await n.setFlag("battle-transitions","autoTriggered",!1)});})();
