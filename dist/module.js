"use strict";(()=>{var hs=Object.create;var Cn=Object.defineProperty;var Is=Object.getOwnPropertyDescriptor;var ys=Object.getOwnPropertyNames;var ws=Object.getPrototypeOf,Cs=Object.prototype.hasOwnProperty;var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),xs=(t,e)=>{for(var n in e)Cn(t,n,{get:e[n],enumerable:!0})},Ls=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ys(e))!Cs.call(t,i)&&i!==n&&Cn(t,i,{get:()=>e[i],enumerable:!(r=Is(e,i))||r.enumerable});return t};var Dr=(t,e,n)=>(n=t!=null?hs(ws(t)):{},Ls(e||!t||!t.__esModule?Cn(n,"default",{value:t,enumerable:!0}):n,t));var Ze=C((GT,pi)=>{var Sa="2.0.0",Ea=Number.MAX_SAFE_INTEGER||9007199254740991,ba=16,ha=250,Ia=["major","premajor","minor","preminor","patch","prepatch","prerelease"];pi.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:ba,MAX_SAFE_BUILD_LENGTH:ha,MAX_SAFE_INTEGER:Ea,RELEASE_TYPES:Ia,SEMVER_SPEC_VERSION:Sa,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var et=C((JT,fi)=>{var ya=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};fi.exports=ya});var xe=C((ae,mi)=>{var{MAX_SAFE_COMPONENT_LENGTH:Un,MAX_SAFE_BUILD_LENGTH:wa,MAX_LENGTH:Ca}=Ze(),xa=et();ae=mi.exports={};var La=ae.re=[],va=ae.safeRe=[],d=ae.src=[],g=ae.t={},Na=0,Xn="[a-zA-Z0-9-]",Da=[["\\s",1],["\\d",Ca],[Xn,wa]],Aa=t=>{for(let[e,n]of Da)t=t.split(`${e}*`).join(`${e}{0,${n}}`).split(`${e}+`).join(`${e}{1,${n}}`);return t},x=(t,e,n)=>{let r=Aa(e),i=Na++;xa(t,i,e),g[t]=i,d[i]=e,La[i]=new RegExp(e,n?"g":void 0),va[i]=new RegExp(r,n?"g":void 0)};x("NUMERICIDENTIFIER","0|[1-9]\\d*");x("NUMERICIDENTIFIERLOOSE","\\d+");x("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Xn}*`);x("MAINVERSION",`(${d[g.NUMERICIDENTIFIER]})\\.(${d[g.NUMERICIDENTIFIER]})\\.(${d[g.NUMERICIDENTIFIER]})`);x("MAINVERSIONLOOSE",`(${d[g.NUMERICIDENTIFIERLOOSE]})\\.(${d[g.NUMERICIDENTIFIERLOOSE]})\\.(${d[g.NUMERICIDENTIFIERLOOSE]})`);x("PRERELEASEIDENTIFIER",`(?:${d[g.NUMERICIDENTIFIER]}|${d[g.NONNUMERICIDENTIFIER]})`);x("PRERELEASEIDENTIFIERLOOSE",`(?:${d[g.NUMERICIDENTIFIERLOOSE]}|${d[g.NONNUMERICIDENTIFIER]})`);x("PRERELEASE",`(?:-(${d[g.PRERELEASEIDENTIFIER]}(?:\\.${d[g.PRERELEASEIDENTIFIER]})*))`);x("PRERELEASELOOSE",`(?:-?(${d[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${d[g.PRERELEASEIDENTIFIERLOOSE]})*))`);x("BUILDIDENTIFIER",`${Xn}+`);x("BUILD",`(?:\\+(${d[g.BUILDIDENTIFIER]}(?:\\.${d[g.BUILDIDENTIFIER]})*))`);x("FULLPLAIN",`v?${d[g.MAINVERSION]}${d[g.PRERELEASE]}?${d[g.BUILD]}?`);x("FULL",`^${d[g.FULLPLAIN]}$`);x("LOOSEPLAIN",`[v=\\s]*${d[g.MAINVERSIONLOOSE]}${d[g.PRERELEASELOOSE]}?${d[g.BUILD]}?`);x("LOOSE",`^${d[g.LOOSEPLAIN]}$`);x("GTLT","((?:<|>)?=?)");x("XRANGEIDENTIFIERLOOSE",`${d[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);x("XRANGEIDENTIFIER",`${d[g.NUMERICIDENTIFIER]}|x|X|\\*`);x("XRANGEPLAIN",`[v=\\s]*(${d[g.XRANGEIDENTIFIER]})(?:\\.(${d[g.XRANGEIDENTIFIER]})(?:\\.(${d[g.XRANGEIDENTIFIER]})(?:${d[g.PRERELEASE]})?${d[g.BUILD]}?)?)?`);x("XRANGEPLAINLOOSE",`[v=\\s]*(${d[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[g.XRANGEIDENTIFIERLOOSE]})(?:${d[g.PRERELEASELOOSE]})?${d[g.BUILD]}?)?)?`);x("XRANGE",`^${d[g.GTLT]}\\s*${d[g.XRANGEPLAIN]}$`);x("XRANGELOOSE",`^${d[g.GTLT]}\\s*${d[g.XRANGEPLAINLOOSE]}$`);x("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Un}})(?:\\.(\\d{1,${Un}}))?(?:\\.(\\d{1,${Un}}))?`);x("COERCE",`${d[g.COERCEPLAIN]}(?:$|[^\\d])`);x("COERCEFULL",d[g.COERCEPLAIN]+`(?:${d[g.PRERELEASE]})?(?:${d[g.BUILD]})?(?:$|[^\\d])`);x("COERCERTL",d[g.COERCE],!0);x("COERCERTLFULL",d[g.COERCEFULL],!0);x("LONETILDE","(?:~>?)");x("TILDETRIM",`(\\s*)${d[g.LONETILDE]}\\s+`,!0);ae.tildeTrimReplace="$1~";x("TILDE",`^${d[g.LONETILDE]}${d[g.XRANGEPLAIN]}$`);x("TILDELOOSE",`^${d[g.LONETILDE]}${d[g.XRANGEPLAINLOOSE]}$`);x("LONECARET","(?:\\^)");x("CARETTRIM",`(\\s*)${d[g.LONECARET]}\\s+`,!0);ae.caretTrimReplace="$1^";x("CARET",`^${d[g.LONECARET]}${d[g.XRANGEPLAIN]}$`);x("CARETLOOSE",`^${d[g.LONECARET]}${d[g.XRANGEPLAINLOOSE]}$`);x("COMPARATORLOOSE",`^${d[g.GTLT]}\\s*(${d[g.LOOSEPLAIN]})$|^$`);x("COMPARATOR",`^${d[g.GTLT]}\\s*(${d[g.FULLPLAIN]})$|^$`);x("COMPARATORTRIM",`(\\s*)${d[g.GTLT]}\\s*(${d[g.LOOSEPLAIN]}|${d[g.XRANGEPLAIN]})`,!0);ae.comparatorTrimReplace="$1$2$3";x("HYPHENRANGE",`^\\s*(${d[g.XRANGEPLAIN]})\\s+-\\s+(${d[g.XRANGEPLAIN]})\\s*$`);x("HYPHENRANGELOOSE",`^\\s*(${d[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${d[g.XRANGEPLAINLOOSE]})\\s*$`);x("STAR","(<|>)?=?\\s*\\*");x("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");x("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Ot=C((QT,di)=>{var Oa=Object.freeze({loose:!0}),Ra=Object.freeze({}),Fa=t=>t?typeof t!="object"?Oa:t:Ra;di.exports=Fa});var _n=C((jT,Si)=>{var gi=/^[0-9]+$/,Ti=(t,e)=>{let n=gi.test(t),r=gi.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1},ka=(t,e)=>Ti(e,t);Si.exports={compareIdentifiers:Ti,rcompareIdentifiers:ka}});var W=C((KT,Ii)=>{var Rt=et(),{MAX_LENGTH:Ei,MAX_SAFE_INTEGER:Ft}=Ze(),{safeRe:bi,t:hi}=xe(),Ma=Ot(),{compareIdentifiers:Le}=_n(),Vn=class t{constructor(e,n){if(n=Ma(n),e instanceof t){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Ei)throw new TypeError(`version is longer than ${Ei} characters`);Rt("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;let r=e.trim().match(n.loose?bi[hi.LOOSE]:bi[hi.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Ft||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ft||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ft||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let o=+i;if(o>=0&&o<Ft)return o}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Rt("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),Le(this.major,e.major)||Le(this.minor,e.minor)||Le(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{let r=this.prerelease[n],i=e.prerelease[n];if(Rt("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Le(r,i)}while(++n)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let n=0;do{let r=this.build[n],i=e.build[n];if(Rt("build compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Le(r,i)}while(++n)}inc(e,n,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(r)?1:0;if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(n){let o=[n,i];r===!1&&(o=[n]),Le(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Ii.exports=Vn});var Ee=C((YT,wi)=>{var yi=W(),Pa=(t,e,n=!1)=>{if(t instanceof yi)return t;try{return new yi(t,e)}catch(r){if(!n)return null;throw r}};wi.exports=Pa});var xi=C((ZT,Ci)=>{var $a=Ee(),Ha=(t,e)=>{let n=$a(t,e);return n?n.version:null};Ci.exports=Ha});var vi=C((eS,Li)=>{var Ba=Ee(),Wa=(t,e)=>{let n=Ba(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};Li.exports=Wa});var Ai=C((tS,Di)=>{var Ni=W(),qa=(t,e,n,r,i)=>{typeof n=="string"&&(i=r,r=n,n=void 0);try{return new Ni(t instanceof Ni?t.version:t,n).inc(e,r,i).version}catch{return null}};Di.exports=qa});var Fi=C((nS,Ri)=>{var Oi=Ee(),Ua=(t,e)=>{let n=Oi(t,null,!0),r=Oi(e,null,!0),i=n.compare(r);if(i===0)return null;let o=i>0,s=o?n:r,a=o?r:n,c=!!s.prerelease.length;if(!!a.prerelease.length&&!c)return!a.patch&&!a.minor?"major":s.patch?"patch":s.minor?"minor":"major";let S=c?"pre":"";return n.major!==r.major?S+"major":n.minor!==r.minor?S+"minor":n.patch!==r.patch?S+"patch":"prerelease"};Ri.exports=Ua});var Mi=C((rS,ki)=>{var Xa=W(),_a=(t,e)=>new Xa(t,e).major;ki.exports=_a});var $i=C((iS,Pi)=>{var Va=W(),za=(t,e)=>new Va(t,e).minor;Pi.exports=za});var Bi=C((oS,Hi)=>{var Ga=W(),Ja=(t,e)=>new Ga(t,e).patch;Hi.exports=Ja});var qi=C((sS,Wi)=>{var Qa=Ee(),ja=(t,e)=>{let n=Qa(t,e);return n&&n.prerelease.length?n.prerelease:null};Wi.exports=ja});var Q=C((aS,Xi)=>{var Ui=W(),Ka=(t,e,n)=>new Ui(t,n).compare(new Ui(e,n));Xi.exports=Ka});var Vi=C((cS,_i)=>{var Ya=Q(),Za=(t,e,n)=>Ya(e,t,n);_i.exports=Za});var Gi=C((lS,zi)=>{var ec=Q(),tc=(t,e)=>ec(t,e,!0);zi.exports=tc});var kt=C((uS,Qi)=>{var Ji=W(),nc=(t,e,n)=>{let r=new Ji(t,n),i=new Ji(e,n);return r.compare(i)||r.compareBuild(i)};Qi.exports=nc});var Ki=C((pS,ji)=>{var rc=kt(),ic=(t,e)=>t.sort((n,r)=>rc(n,r,e));ji.exports=ic});var Zi=C((fS,Yi)=>{var oc=kt(),sc=(t,e)=>t.sort((n,r)=>oc(r,n,e));Yi.exports=sc});var tt=C((mS,eo)=>{var ac=Q(),cc=(t,e,n)=>ac(t,e,n)>0;eo.exports=cc});var Mt=C((dS,to)=>{var lc=Q(),uc=(t,e,n)=>lc(t,e,n)<0;to.exports=uc});var zn=C((gS,no)=>{var pc=Q(),fc=(t,e,n)=>pc(t,e,n)===0;no.exports=fc});var Gn=C((TS,ro)=>{var mc=Q(),dc=(t,e,n)=>mc(t,e,n)!==0;ro.exports=dc});var Pt=C((SS,io)=>{var gc=Q(),Tc=(t,e,n)=>gc(t,e,n)>=0;io.exports=Tc});var $t=C((ES,oo)=>{var Sc=Q(),Ec=(t,e,n)=>Sc(t,e,n)<=0;oo.exports=Ec});var Jn=C((bS,so)=>{var bc=zn(),hc=Gn(),Ic=tt(),yc=Pt(),wc=Mt(),Cc=$t(),xc=(t,e,n,r)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return bc(t,n,r);case"!=":return hc(t,n,r);case">":return Ic(t,n,r);case">=":return yc(t,n,r);case"<":return wc(t,n,r);case"<=":return Cc(t,n,r);default:throw new TypeError(`Invalid operator: ${e}`)}};so.exports=xc});var co=C((hS,ao)=>{var Lc=W(),vc=Ee(),{safeRe:Ht,t:Bt}=xe(),Nc=(t,e)=>{if(t instanceof Lc)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let n=null;if(!e.rtl)n=t.match(e.includePrerelease?Ht[Bt.COERCEFULL]:Ht[Bt.COERCE]);else{let c=e.includePrerelease?Ht[Bt.COERCERTLFULL]:Ht[Bt.COERCERTL],u;for(;(u=c.exec(t))&&(!n||n.index+n[0].length!==t.length);)(!n||u.index+u[0].length!==n.index+n[0].length)&&(n=u),c.lastIndex=u.index+u[1].length+u[2].length;c.lastIndex=-1}if(n===null)return null;let r=n[2],i=n[3]||"0",o=n[4]||"0",s=e.includePrerelease&&n[5]?`-${n[5]}`:"",a=e.includePrerelease&&n[6]?`+${n[6]}`:"";return vc(`${r}.${i}.${o}${s}${a}`,e)};ao.exports=Nc});var uo=C((IS,lo)=>{var Qn=class{constructor(){this.max=1e3,this.map=new Map}get(e){let n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,n)}return this}};lo.exports=Qn});var j=C((yS,go)=>{var Dc=/\s+/g,jn=class t{constructor(e,n){if(n=Oc(n),e instanceof t)return e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease?e:new t(e.raw,n);if(e instanceof Kn)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=e.trim().replace(Dc," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(i=>!fo(i[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&Hc(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let n=this.set[e];for(let r=0;r<n.length;r++)r>0&&(this.formatted+=" "),this.formatted+=n[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&Pc)|(this.options.loose&&$c))+":"+e,i=po.get(r);if(i)return i;let o=this.options.loose,s=o?V[X.HYPHENRANGELOOSE]:V[X.HYPHENRANGE];e=e.replace(s,Jc(this.options.includePrerelease)),N("hyphen replace",e),e=e.replace(V[X.COMPARATORTRIM],Fc),N("comparator trim",e),e=e.replace(V[X.TILDETRIM],kc),N("tilde trim",e),e=e.replace(V[X.CARETTRIM],Mc),N("caret trim",e);let a=e.split(" ").map(p=>Bc(p,this.options)).join(" ").split(/\s+/).map(p=>Gc(p,this.options));o&&(a=a.filter(p=>(N("loose invalid filter",p,this.options),!!p.match(V[X.COMPARATORLOOSE])))),N("range list",a);let c=new Map,u=a.map(p=>new Kn(p,this.options));for(let p of u){if(fo(p))return[p];c.set(p.value,p)}c.size>1&&c.has("")&&c.delete("");let S=[...c.values()];return po.set(r,S),S}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(r=>mo(r,n)&&e.set.some(i=>mo(i,n)&&r.every(o=>i.every(s=>o.intersects(s,n)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Rc(e,this.options)}catch{return!1}for(let n=0;n<this.set.length;n++)if(Qc(this.set[n],e,this.options))return!0;return!1}};go.exports=jn;var Ac=uo(),po=new Ac,Oc=Ot(),Kn=nt(),N=et(),Rc=W(),{safeRe:V,t:X,comparatorTrimReplace:Fc,tildeTrimReplace:kc,caretTrimReplace:Mc}=xe(),{FLAG_INCLUDE_PRERELEASE:Pc,FLAG_LOOSE:$c}=Ze(),fo=t=>t.value==="<0.0.0-0",Hc=t=>t.value==="",mo=(t,e)=>{let n=!0,r=t.slice(),i=r.pop();for(;n&&r.length;)n=r.every(o=>i.intersects(o,e)),i=r.pop();return n},Bc=(t,e)=>(N("comp",t,e),t=Uc(t,e),N("caret",t),t=Wc(t,e),N("tildes",t),t=_c(t,e),N("xrange",t),t=zc(t,e),N("stars",t),t),_=t=>!t||t.toLowerCase()==="x"||t==="*",Wc=(t,e)=>t.trim().split(/\s+/).map(n=>qc(n,e)).join(" "),qc=(t,e)=>{let n=e.loose?V[X.TILDELOOSE]:V[X.TILDE];return t.replace(n,(r,i,o,s,a)=>{N("tilde",t,r,i,o,s,a);let c;return _(i)?c="":_(o)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:_(s)?c=`>=${i}.${o}.0 <${i}.${+o+1}.0-0`:a?(N("replaceTilde pr",a),c=`>=${i}.${o}.${s}-${a} <${i}.${+o+1}.0-0`):c=`>=${i}.${o}.${s} <${i}.${+o+1}.0-0`,N("tilde return",c),c})},Uc=(t,e)=>t.trim().split(/\s+/).map(n=>Xc(n,e)).join(" "),Xc=(t,e)=>{N("caret",t,e);let n=e.loose?V[X.CARETLOOSE]:V[X.CARET],r=e.includePrerelease?"-0":"";return t.replace(n,(i,o,s,a,c)=>{N("caret",t,i,o,s,a,c);let u;return _(o)?u="":_(s)?u=`>=${o}.0.0${r} <${+o+1}.0.0-0`:_(a)?o==="0"?u=`>=${o}.${s}.0${r} <${o}.${+s+1}.0-0`:u=`>=${o}.${s}.0${r} <${+o+1}.0.0-0`:c?(N("replaceCaret pr",c),o==="0"?s==="0"?u=`>=${o}.${s}.${a}-${c} <${o}.${s}.${+a+1}-0`:u=`>=${o}.${s}.${a}-${c} <${o}.${+s+1}.0-0`:u=`>=${o}.${s}.${a}-${c} <${+o+1}.0.0-0`):(N("no pr"),o==="0"?s==="0"?u=`>=${o}.${s}.${a}${r} <${o}.${s}.${+a+1}-0`:u=`>=${o}.${s}.${a}${r} <${o}.${+s+1}.0-0`:u=`>=${o}.${s}.${a} <${+o+1}.0.0-0`),N("caret return",u),u})},_c=(t,e)=>(N("replaceXRanges",t,e),t.split(/\s+/).map(n=>Vc(n,e)).join(" ")),Vc=(t,e)=>{t=t.trim();let n=e.loose?V[X.XRANGELOOSE]:V[X.XRANGE];return t.replace(n,(r,i,o,s,a,c)=>{N("xRange",t,r,i,o,s,a,c);let u=_(o),S=u||_(s),p=S||_(a),h=p;return i==="="&&h&&(i=""),c=e.includePrerelease?"-0":"",u?i===">"||i==="<"?r="<0.0.0-0":r="*":i&&h?(S&&(s=0),a=0,i===">"?(i=">=",S?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",S?o=+o+1:s=+s+1),i==="<"&&(c="-0"),r=`${i+o}.${s}.${a}${c}`):S?r=`>=${o}.0.0${c} <${+o+1}.0.0-0`:p&&(r=`>=${o}.${s}.0${c} <${o}.${+s+1}.0-0`),N("xRange return",r),r})},zc=(t,e)=>(N("replaceStars",t,e),t.trim().replace(V[X.STAR],"")),Gc=(t,e)=>(N("replaceGTE0",t,e),t.trim().replace(V[e.includePrerelease?X.GTE0PRE:X.GTE0],"")),Jc=t=>(e,n,r,i,o,s,a,c,u,S,p,h)=>(_(r)?n="":_(i)?n=`>=${r}.0.0${t?"-0":""}`:_(o)?n=`>=${r}.${i}.0${t?"-0":""}`:s?n=`>=${n}`:n=`>=${n}${t?"-0":""}`,_(u)?c="":_(S)?c=`<${+u+1}.0.0-0`:_(p)?c=`<${u}.${+S+1}.0-0`:h?c=`<=${u}.${S}.${p}-${h}`:t?c=`<${u}.${S}.${+p+1}-0`:c=`<=${c}`,`${n} ${c}`.trim()),Qc=(t,e,n)=>{for(let r=0;r<t.length;r++)if(!t[r].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let r=0;r<t.length;r++)if(N(t[r].semver),t[r].semver!==Kn.ANY&&t[r].semver.prerelease.length>0){let i=t[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var nt=C((wS,Io)=>{var rt=Symbol("SemVer ANY"),er=class t{static get ANY(){return rt}constructor(e,n){if(n=To(n),e instanceof t){if(e.loose===!!n.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Zn("comparator",e,n),this.options=n,this.loose=!!n.loose,this.parse(e),this.semver===rt?this.value="":this.value=this.operator+this.semver.version,Zn("comp",this)}parse(e){let n=this.options.loose?So[Eo.COMPARATORLOOSE]:So[Eo.COMPARATOR],r=e.match(n);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new bo(r[2],this.options.loose):this.semver=rt}toString(){return this.value}test(e){if(Zn("Comparator.test",e,this.options.loose),this.semver===rt||e===rt)return!0;if(typeof e=="string")try{e=new bo(e,this.options)}catch{return!1}return Yn(e,this.operator,this.semver,this.options)}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new ho(e.value,n).test(this.value):e.operator===""?e.value===""?!0:new ho(this.value,n).test(e.semver):(n=To(n),n.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!n.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Yn(this.semver,"<",e.semver,n)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Yn(this.semver,">",e.semver,n)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Io.exports=er;var To=Ot(),{safeRe:So,t:Eo}=xe(),Yn=Jn(),Zn=et(),bo=W(),ho=j()});var it=C((CS,yo)=>{var jc=j(),Kc=(t,e,n)=>{try{e=new jc(e,n)}catch{return!1}return e.test(t)};yo.exports=Kc});var Co=C((xS,wo)=>{var Yc=j(),Zc=(t,e)=>new Yc(t,e).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));wo.exports=Zc});var Lo=C((LS,xo)=>{var el=W(),tl=j(),nl=(t,e,n)=>{let r=null,i=null,o=null;try{o=new tl(e,n)}catch{return null}return t.forEach(s=>{o.test(s)&&(!r||i.compare(s)===-1)&&(r=s,i=new el(r,n))}),r};xo.exports=nl});var No=C((vS,vo)=>{var rl=W(),il=j(),ol=(t,e,n)=>{let r=null,i=null,o=null;try{o=new il(e,n)}catch{return null}return t.forEach(s=>{o.test(s)&&(!r||i.compare(s)===1)&&(r=s,i=new rl(r,n))}),r};vo.exports=ol});var Oo=C((NS,Ao)=>{var tr=W(),sl=j(),Do=tt(),al=(t,e)=>{t=new sl(t,e);let n=new tr("0.0.0");if(t.test(n)||(n=new tr("0.0.0-0"),t.test(n)))return n;n=null;for(let r=0;r<t.set.length;++r){let i=t.set[r],o=null;i.forEach(s=>{let a=new tr(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!o||Do(a,o))&&(o=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),o&&(!n||Do(n,o))&&(n=o)}return n&&t.test(n)?n:null};Ao.exports=al});var Fo=C((DS,Ro)=>{var cl=j(),ll=(t,e)=>{try{return new cl(t,e).range||"*"}catch{return null}};Ro.exports=ll});var Wt=C((AS,$o)=>{var ul=W(),Po=nt(),{ANY:pl}=Po,fl=j(),ml=it(),ko=tt(),Mo=Mt(),dl=$t(),gl=Pt(),Tl=(t,e,n,r)=>{t=new ul(t,r),e=new fl(e,r);let i,o,s,a,c;switch(n){case">":i=ko,o=dl,s=Mo,a=">",c=">=";break;case"<":i=Mo,o=gl,s=ko,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ml(t,e,r))return!1;for(let u=0;u<e.set.length;++u){let S=e.set[u],p=null,h=null;if(S.forEach(f=>{f.semver===pl&&(f=new Po(">=0.0.0")),p=p||f,h=h||f,i(f.semver,p.semver,r)?p=f:s(f.semver,h.semver,r)&&(h=f)}),p.operator===a||p.operator===c||(!h.operator||h.operator===a)&&o(t,h.semver))return!1;if(h.operator===c&&s(t,h.semver))return!1}return!0};$o.exports=Tl});var Bo=C((OS,Ho)=>{var Sl=Wt(),El=(t,e,n)=>Sl(t,e,">",n);Ho.exports=El});var qo=C((RS,Wo)=>{var bl=Wt(),hl=(t,e,n)=>bl(t,e,"<",n);Wo.exports=hl});var _o=C((FS,Xo)=>{var Uo=j(),Il=(t,e,n)=>(t=new Uo(t,n),e=new Uo(e,n),t.intersects(e,n));Xo.exports=Il});var zo=C((kS,Vo)=>{var yl=it(),wl=Q();Vo.exports=(t,e,n)=>{let r=[],i=null,o=null,s=t.sort((S,p)=>wl(S,p,n));for(let S of s)yl(S,e,n)?(o=S,i||(i=S)):(o&&r.push([i,o]),o=null,i=null);i&&r.push([i,null]);let a=[];for(let[S,p]of r)S===p?a.push(S):!p&&S===s[0]?a.push("*"):p?S===s[0]?a.push(`<=${p}`):a.push(`${S} - ${p}`):a.push(`>=${S}`);let c=a.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return c.length<u.length?c:e}});var Yo=C((MS,Ko)=>{var Go=j(),rr=nt(),{ANY:nr}=rr,ot=it(),ir=Q(),Cl=(t,e,n={})=>{if(t===e)return!0;t=new Go(t,n),e=new Go(e,n);let r=!1;e:for(let i of t.set){for(let o of e.set){let s=Ll(i,o,n);if(r=r||s!==null,s)continue e}if(r)return!1}return!0},xl=[new rr(">=0.0.0-0")],Jo=[new rr(">=0.0.0")],Ll=(t,e,n)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===nr){if(e.length===1&&e[0].semver===nr)return!0;n.includePrerelease?t=xl:t=Jo}if(e.length===1&&e[0].semver===nr){if(n.includePrerelease)return!0;e=Jo}let r=new Set,i,o;for(let f of t)f.operator===">"||f.operator===">="?i=Qo(i,f,n):f.operator==="<"||f.operator==="<="?o=jo(o,f,n):r.add(f.semver);if(r.size>1)return null;let s;if(i&&o){if(s=ir(i.semver,o.semver,n),s>0)return null;if(s===0&&(i.operator!==">="||o.operator!=="<="))return null}for(let f of r){if(i&&!ot(f,String(i),n)||o&&!ot(f,String(o),n))return null;for(let de of e)if(!ot(f,String(de),n))return!1;return!0}let a,c,u,S,p=o&&!n.includePrerelease&&o.semver.prerelease.length?o.semver:!1,h=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1;p&&p.prerelease.length===1&&o.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let f of e){if(S=S||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",i){if(h&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===h.major&&f.semver.minor===h.minor&&f.semver.patch===h.patch&&(h=!1),f.operator===">"||f.operator===">="){if(a=Qo(i,f,n),a===f&&a!==i)return!1}else if(i.operator===">="&&!ot(i.semver,String(f),n))return!1}if(o){if(p&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===p.major&&f.semver.minor===p.minor&&f.semver.patch===p.patch&&(p=!1),f.operator==="<"||f.operator==="<="){if(c=jo(o,f,n),c===f&&c!==o)return!1}else if(o.operator==="<="&&!ot(o.semver,String(f),n))return!1}if(!f.operator&&(o||i)&&s!==0)return!1}return!(i&&u&&!o&&s!==0||o&&S&&!i&&s!==0||h||p)},Qo=(t,e,n)=>{if(!t)return e;let r=ir(t.semver,e.semver,n);return r>0?t:r<0||e.operator===">"&&t.operator===">="?e:t},jo=(t,e,n)=>{if(!t)return e;let r=ir(t.semver,e.semver,n);return r<0?t:r>0||e.operator==="<"&&t.operator==="<="?e:t};Ko.exports=Cl});var sr=C((PS,ts)=>{var or=xe(),Zo=Ze(),vl=W(),es=_n(),Nl=Ee(),Dl=xi(),Al=vi(),Ol=Ai(),Rl=Fi(),Fl=Mi(),kl=$i(),Ml=Bi(),Pl=qi(),$l=Q(),Hl=Vi(),Bl=Gi(),Wl=kt(),ql=Ki(),Ul=Zi(),Xl=tt(),_l=Mt(),Vl=zn(),zl=Gn(),Gl=Pt(),Jl=$t(),Ql=Jn(),jl=co(),Kl=nt(),Yl=j(),Zl=it(),eu=Co(),tu=Lo(),nu=No(),ru=Oo(),iu=Fo(),ou=Wt(),su=Bo(),au=qo(),cu=_o(),lu=zo(),uu=Yo();ts.exports={parse:Nl,valid:Dl,clean:Al,inc:Ol,diff:Rl,major:Fl,minor:kl,patch:Ml,prerelease:Pl,compare:$l,rcompare:Hl,compareLoose:Bl,compareBuild:Wl,sort:ql,rsort:Ul,gt:Xl,lt:_l,eq:Vl,neq:zl,gte:Gl,lte:Jl,cmp:Ql,coerce:jl,Comparator:Kl,Range:Yl,satisfies:Zl,toComparators:eu,maxSatisfying:tu,minSatisfying:nu,minVersion:ru,validRange:iu,outside:ou,gtr:su,ltr:au,intersects:cu,simplifyRange:lu,subset:uu,SemVer:vl,re:or.re,src:or.src,tokens:or.t,SEMVER_SPEC_VERSION:Zo.SEMVER_SPEC_VERSION,RELEASE_TYPES:Zo.RELEASE_TYPES,compareIdentifiers:es.compareIdentifiers,rcompareIdentifiers:es.rcompareIdentifiers}});var xn="transition-cover",Ar="BATTLETRANSITIONS",Or="\u2694\uFE0F",K={INITIALIZE:"battle-transitions.init",TRANSITION_START:"battle-transitions.transitionStart",TRANSITION_END:"battle-transitions.transitionEnd",SCENE_ACTIVATED:"battle-transitions.sceneActivated"},lt={};var Fe=class extends PIXI.Container{setInverseMatrix(){canvas?.app?.stage&&this.transform.setFromMatrix(canvas.app.stage.localTransform.clone().invert())}constructor(){super(),this.interactiveChildren=!1,this.interactive=!1,this.eventMode="none",canvas?.app&&canvas.app.renderer.addListener("prerender",()=>{this.setInverseMatrix()})}};var I=class extends Error{constructor(e,n){e?super(game.i18n?.format(`${Ar}.ERRORS.${e}`,n)):super()}};var ie=class extends I{constructor(){super("CANNOTINITIALIZECANVAS")}};var ue=class extends I{constructor(){super("CANVASNOTFOUND")}};var ut=class extends I{constructor(e){super("FILENOTFOUND",{file:e})}};var H=class extends I{constructor(e){super("INVALIDDIRECTION",{direction:e})}};var Ie=class extends I{constructor(e){super("INVALIDMACRO",{macro:e})}};var D=class extends I{constructor(e){super("INVALIDSCENE",{name:e})}};var pt=class extends I{constructor(e){super("INVALIDSOUND",{sound:e})}};var F=class extends I{constructor(){super("INVALIDTEXTURE")}};var b=class extends I{constructor(e){super("INVALIDTRANSITION",{name:e})}};var ft=class extends I{constructor(e){super("INVALIDVERSION",{version:e})}};var ke=class extends I{constructor(e){super("NEWERVERSION",{version:e})}};var mt=class extends I{constructor(){super("NOCOVERELEMENT")}};var dt=class extends I{constructor(){super("NOPREVIOUSSTEP")}};var U=class extends I{constructor(){super("NOTIMPLEMENTED")}};var gt=class extends I{constructor(){super("NOTINITIALIZED")}};var Tt=class extends I{constructor(){super("EXECUTECALLEDPARALLEL")}};var St=class extends I{constructor(){super("PERMISSIONDENIED")}};var Et=class extends I{constructor(){super("EXECUTECALLEDREPEAT")}};var bt=class extends I{constructor(){super("SEQUENCETIMEDOUT")}};var ht=class extends I{constructor(){super("TRANSITIONTOSELF")}};var ye=class extends I{constructor(e,n){super("UNABLETOMIGRATE",{old:e,current:n})}};function vs(t){try{return new PIXI.Color(t)}catch{}}function v(t){let e=vs(t);if(e)return E(e);try{return PIXI.Texture.from(t)}catch{}}function It(t){if(game instanceof Game&&game.scenes){if(typeof t=="string"){let e=game.scenes.get(t);if(e||(e=game.scenes.getName(t),e))return e}else if(t instanceof Scene)return t}}function Rr(t){if(t instanceof Macro)return t;if(game.macros&&typeof t=="string"){let e=game.macros?.get(t);if(e||(e=game.macros?.getName(t),e))return e;if(t.split(".")[0]==="Macro")return game.macros?.get(t.split(".").slice(1).join("."))}}var Mr=Math.sqrt(3),Pr=Math.sqrt(5),Ns=.5*(Mr-1),Me=(3-Mr)/6,Hf=1/3,Bf=1/6,Wf=(Pr-1)/4,qf=(5-Pr)/20,Fr=t=>Math.floor(t)|0,kr=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function $r(t=Math.random){let e=Ds(t),n=new Float64Array(e).map(i=>kr[i%12*2]),r=new Float64Array(e).map(i=>kr[i%12*2+1]);return function(o,s){let a=0,c=0,u=0,S=(o+s)*Ns,p=Fr(o+S),h=Fr(s+S),f=(p+h)*Me,de=p-f,Nr=h-f,ee=o-de,M=s-Nr,be,he;ee>M?(be=1,he=0):(be=0,he=1);let En=ee-be+Me,bn=M-he+Me,hn=ee-1+2*Me,In=M-1+2*Me,yn=p&255,wn=h&255,Ne=.5-ee*ee-M*M;if(Ne>=0){let le=yn+e[wn],Oe=n[le],Re=r[le];Ne*=Ne,a=Ne*Ne*(Oe*ee+Re*M)}let De=.5-En*En-bn*bn;if(De>=0){let le=yn+be+e[wn+he],Oe=n[le],Re=r[le];De*=De,c=De*De*(Oe*En+Re*bn)}let Ae=.5-hn*hn-In*In;if(Ae>=0){let le=yn+1+e[wn+1],Oe=n[le],Re=r[le];Ae*=Ae,u=Ae*Ae*(Oe*hn+Re*In)}return 70*(a+c+u)}}function Ds(t){let n=new Uint8Array(512);for(let r=0;r<512/2;r++)n[r]=r;for(let r=0;r<512/2-1;r++){let i=r+~~(t()*(256-r)),o=n[r];n[r]=n[i],n[i]=o}for(let r=256;r<512;r++)n[r]=n[r-256];return n}var oe=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function Hr(t){let e="",n,r=t.length;for(n=2;n<r;n+=3)e+=oe[t[n-2]>>2],e+=oe[(t[n-2]&3)<<4|t[n-1]>>4],e+=oe[(t[n-1]&15)<<2|t[n]>>6],e+=oe[t[n]&63];return n===r+1&&(e+=oe[t[n-2]>>2],e+=oe[(t[n-2]&3)<<4],e+="=="),n===r&&(e+=oe[t[n-2]>>2],e+=oe[(t[n-2]&3)<<4|t[n-1]>>4],e+=oe[(t[n-1]&15)<<2],e+="="),e}var Tn={};xs(Tn,{AngularWipeStep:()=>Ln,BarWipeStep:()=>vn,BilinearWipeStep:()=>Nn,BossSplashStep:()=>Dn,ClearEffectsStep:()=>An,ClockWipeStep:()=>On,DiamondWipeStep:()=>Rn,FadeStep:()=>Fn,FireDissolveStep:()=>kn,FlashStep:()=>Mn,HueShiftStep:()=>Pn,InvertStep:()=>$n,LinearWipeStep:()=>Hn,MacroStep:()=>Bn,MeltStep:()=>Wn,ParallelStep:()=>lr,PixelateStep:()=>fr,RadialWipeStep:()=>mr,RemoveOverlayStep:()=>dr,RepeatStep:()=>gr,RestoreOverlayStep:()=>Tr,SceneChangeStep:()=>Y,SoundStep:()=>Sr,SpiralShutterStep:()=>Er,SpiralWipeStep:()=>br,SpotlightWipeStep:()=>hr,StartPlaylistStep:()=>Ce,TextureSwapStep:()=>Ir,TransitionStep:()=>m,TwistStep:()=>yr,VideoStep:()=>wr,WaitStep:()=>at,WaveWipeStep:()=>Cr,ZoomBlurStep:()=>xr});var m=class{constructor(e){this.config=e;e.id||(this.config.id=foundry.utils.randomID())}static DefaultSettings={id:"",type:"UNKNOWN",version:"1.1.0"};static hidden=!0;static key="unknown";static name="UNNAMED";static skipConfig=!1;static template="";static icon="";static category="";static async RenderTemplate(e){throw new U}static Upgrade(e){throw new U}static from(e){throw new U}static validate(e){return!0}static addEventListeners(e,n){}prepare(e){}serialize(){return this.config}teardown(e){}validate(){return!0}addFilter(e,n){Array.isArray(e.filters)?e.filters.push(n):e.filters=[n]}getConfigTemplateParams(){return{...this.config}}removeFilter(e,n){let r=e.filters?.indexOf(n)??-1;r!==-1&&e.filters?.splice(r,1)}async simpleTween(e){await TweenMax.to(e.uniforms,{progress:1,duration:this.config.duration/1e3,ease:this.config.easing||"none"})}};var Br=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

void main() {
    color = texture(uSampler, vTextureCoord);
}`;var Wr=`#version 300 es

in vec2 aVertexPosition;

uniform mat3 projectionMatrix;

out vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition(void) {
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord(void) {
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void) {
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var O=class extends PIXI.Filter{constructor(e,n,r){super(e||Wr,n||Br,r),this.program.fragmentSrc.includes("#version 300 es")||(this.program.fragmentSrc=this.#e(300,this.program.fragmentSrc)),this.program.vertexSrc.includes("#version 300 es")||(this.program.vertexSrc=this.#e(300,this.program.vertexSrc))}#e(e,n){let r=n.split(`
`),i=r.findIndex(o=>o.startsWith("#version"));if(i!==-1){let o=r.splice(i,1);r.unshift(...o)}else r.unshift("#version 300 es");return r.join(`
`)}};var qr=`#version 300 es

precision highp float;

in vec2 vTextureCoord;
out vec4 color;

uniform sampler2D uSampler;
uniform sampler2D noise_texture;
uniform sampler2D burn_texture;

uniform float progress;
uniform float burn_size;

float inverse_lerp(float a, float b, float v) {
    return (v - a) / (b - a);
}

void main() {
    float integrity = 1.0 - progress;
    float noise = texture(noise_texture, vTextureCoord).r * vTextureCoord.y;
    vec4 base_color = texture(uSampler, vTextureCoord) * step(noise, integrity);
    vec2 burn_uv = vec2(inverse_lerp(integrity, integrity * burn_size, noise), 0.0);
    vec4 burn_color = texture(burn_texture, burn_uv) * step(noise, integrity * burn_size);

    color = mix(burn_color, base_color, base_color.a);
}`;var Fs=Ur(1024,new PIXI.Color("#ff0400"),new PIXI.Color("#ffff01")),Pe=class extends O{constructor(e=1.3){let r={noise_texture:Xr(),progress:0,burn_size:e,burn_texture:Fs};super(void 0,qr,r)}};var _r=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform float size;
uniform vec2 screen_size;
uniform sampler2D bgSampler;

void main() {
    vec2 screenCoord = screen_size * vTextureCoord;
    
    float x = abs(fract(screenCoord.x / size) - 0.5);
    float y = abs(fract(screenCoord.y / size) - 0.5);
    
    if (x + y + vTextureCoord.x > progress * 2.0) {
        color = texture(uSampler, vTextureCoord);
    } else {
        color = texture(bgSampler, vTextureCoord);
    }
}`;var $e=class extends O{constructor(e,n="transparent"){let r=v(n)??E("transparent");super(void 0,_r,{progress:0,size:e,bgSampler:r,screen_size:{x:window.innerWidth,y:window.innerHeight}})}};var Vr=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform sampler2D wipeSampler;
uniform sampler2D bgSampler;

void main() {
    vec4 wipe = texture(wipeSampler, vTextureCoord);
    
    if (wipe.b < progress) {
        color = texture(bgSampler, vTextureCoord);
    } else {
        color = texture(uSampler, vTextureCoord);
    }
}`;var Ps=E(new PIXI.Color("#00000000")),A=class extends O{constructor(e,n){let r={progress:0,wipeSampler:e,bgSampler:n??Ps};super(void 0,Vr,r)}};var zr=`#version 300 es
precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform sampler2D bgColor;

void main() {
    color = mix(texture(uSampler, vTextureCoord), texture(bgColor, vTextureCoord), progress);
}`;var He=class extends O{constructor(e="transparent"){let n=v(e)??E("transparent");super(void 0,zr,{bgColor:n,progress:0})}};var Hs={horizontal:{inside:"bilinear-horizontal-inside.webp",outside:"bilinear-horizontal-outside.webp"},vertical:{inside:"bilinear-vertical-inside.webp",outside:"bilinear-vertical-outside.webp"},topleft:{inside:"bilinear-top-left-inside.webp",outside:"bilinear-top-right-outside.webp"},topright:{inside:"bilinear-top-right-inside.webp",outside:"bilinear-top-right-outside.webp"},bottomleft:{inside:"bilinear-top-right-inside.webp",outside:"bilinear-top-right-outside.webp"},bottomright:{inside:"bilinear-top-left-inside.webp",outside:"bilinear-top-right-outside.webp"}},Be=class extends A{constructor(e,n,r){let i=v(r)??E("transparent"),o=Hs[e]?.[n];if(!o)throw new H(`${e}-${n}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}`);super(s,i)}};var Bs={left:"linear-left.webp",right:"linear-right.webp",top:"linear-top.webp",bottom:"linear-bottom.webp",topleft:"linear-top-left.webp",topright:"linear-top-right.webp",bottomleft:"linear-bottom-left.webp",bottomright:"linear-bottom-right.webp"},We=class extends A{constructor(e,n){let r=v(n)??E("transparent"),i=Bs[e];if(!i)throw new H(e);let o=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${i}`);super(o,r)}};var Ws={clockwise:{top:"clockwise-top.webp",left:"clockwise-left.webp",right:"clockwise-right.webp",bottom:"clockwise-bottom.webp"},counterclockwise:{top:"anticlockwise-top.webp",left:"anticlockwise-left.webp",right:"anticlockwise-right.webp",bottom:"anticlockwise-bottom.webp"}},qe=class extends A{constructor(e,n,r){let i=v(r)??E("transparent"),o=Ws[e]?.[n];if(!o)throw new H(`${e}-${n}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}`);super(s,i)}};var qs={left:{inside:"spotlight-left-inside.webp",outside:"spotlight-right-outside.webp"},top:{inside:"spotlight-top-inside.webp",outside:"spotlight-top-outside.webp"},right:{inside:"spotlight-right-inside.webp",outside:"spotlight-right-outside.webp"},bottom:{inside:"spotlight-bottom-inside.webp",outside:"spotlgiht-bottom-outside.webp"}},Ue=class extends A{constructor(e,n,r="transparent"){let i=v(r)??E("transparent"),o=qs[e]?.[n];if(!o)throw new H(`${e}-${n}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}`);super(s,i)}};var Us={inside:"radial-inside.webp",outside:"radial-outside.webp"},Xe=class extends A{constructor(e,n){let r=v(n)??E("transparent"),i=Us[e];if(!i)throw new H(e);let o=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${i}`);super(o,r)}};var Gr=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform sampler2D uTexture;

void main() {
    color = texture(uTexture, vTextureCoord);
}`;var se=class extends O{constructor(e){let n=v(e);if(!n)throw new F;super(void 0,Gr,{uTexture:n})}};var Jr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform float[512] offsets;
uniform sampler2D uBackground;

void main() {
    vec2 tex_uv = vTextureCoord;

    float index = tex_uv.x * float(offsets.length());
    tex_uv.y -= progress * offsets[int(index)];

    // float index = tex_uv.x * float(offsets.length());
    // tex_uv.y -= progress * offsets[int(index)];

    color = texture(uSampler, tex_uv);
    if (tex_uv.y < 0.0 || tex_uv.y > 1.0) color = texture(uBackground, vTextureCoord); // texture(uBackground, vTextureCoord);
}
`;var _e=class extends O{constructor(e){let n=v(e);if(!(n instanceof PIXI.Texture))throw new F;super(void 0,Jr,{progress:0,offsets:new Array(512).fill(0).map(()=>Math.random()+1),uBackground:n})}};var Ve=class extends A{constructor(e){let n=v(e);if(!(n instanceof PIXI.Texture))throw new F;let r=PIXI.Texture.from("/modules/battle-transitions/assets/wipes/angular.webp");super(r,n)}};var ze=class extends A{constructor(e,n){let r=v(n);if(!(r instanceof PIXI.Texture))throw new F;let i=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/wave-${e==="inside"?"inside":"outside"}.webp`);super(i,r)}};var Qr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

void main() {
    color = 1.0 - texture(uSampler, vTextureCoord);
    color.a = 1.0;
}`;var Ge=class extends O{constructor(){super(void 0,Qr,{})}};var zs={clockwise:{inside:"spiral-radial-clockwise-inside",outside:"spiral-radial-clockwise-outside"},counterclockwise:{inside:"spiral-radial-counterclockwise-inside",outside:"spiral-radial-counterclockwise-outside"}},Je=class extends A{constructor(e,n,r){let i=v(r);if(!(i instanceof PIXI.Texture))throw new F;let o=zs[e]?.[n];if(!o)throw new H(`${e}-${n}`);let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}.webp`);super(s,i)}};var Qe=class extends A{constructor(e,n,r,i){let o=v(i);if(!(o instanceof PIXI.Texture))throw new F;let s=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/spiral-linear-${e}-${r}-${n}.webp`);if(!(s instanceof PIXI.Texture))throw new F;super(s,o)}};var jr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float shift;

void main() {
    vec4 texture_color = texture(uSampler, vTextureCoord);
    vec3 input_color = texture_color.rgb;

    vec3 color_hsv; {
        vec3 c = input_color;
        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
        vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
        float d = q.x - min(q.w, q.y);
        float e = 1.0e-10;
        color_hsv=vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
    }

    color_hsv.x = mod((color_hsv.x + shift), 1.0f);

    vec3 color_rgb; {
        vec3 c = color_hsv;
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        color_rgb=c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }

    color = vec4(color_rgb.rgb, texture_color.a);
}`;var je=class extends O{constructor(e){super(void 0,jr,{shift:e})}};function Js(t){let e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new ue;e.width=window.innerWidth,e.height=window.innerHeight;let r=n.createLinearGradient(0,0,e.width,0),i=n.createLinearGradient(0,0,e.width,0);r.addColorStop(0,"black"),r.addColorStop(1,"white"),i.addColorStop(0,"white"),i.addColorStop(1,"black");let o=e.height/t;for(let s=0;s<t;s++)n.fillStyle=s%2===0?r:i,n.fillRect(0,o*s,e.width,o+o*s);return PIXI.Texture.from(e)}function Qs(t){let e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new ue;e.width=window.innerWidth,e.height=window.innerHeight;let r=n.createLinearGradient(0,0,0,e.height),i=n.createLinearGradient(0,0,0,e.height);r.addColorStop(0,"black"),r.addColorStop(1,"white"),i.addColorStop(0,"white"),i.addColorStop(1,"black");let o=e.width/t;for(let s=0;s<t;s++)n.fillStyle=s%2===0?r:i,n.fillRect(o*s,0,o+o*s,e.height);return PIXI.Texture.from(e)}var Ke=class extends A{constructor(e,n,r){let i=v(r)??E("transparent");if(!(e==="horizontal"||e==="vertical"))throw new H(e);let o=e==="horizontal"?Js(n):Qs(n);Kr(o),super(o,i)}};var Ln=class t extends m{static DefaultSettings={type:"angularwipe",duration:1e3,easing:"none",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="angularwipe";static name="ANGULARWIPE";static template="angularwipe-config";static icon="<i class='bt-icon angular-wipe fa-fw fas'></i>";static category="wipe";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","easing","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e){let n=this.config.deserializedTexture??E("transparent"),r=new Ve(n.baseTexture);this.addFilter(e,r),await this.simpleTween(r)}};var vn=class t extends m{static DefaultSettings={type:"barwipe",duration:1e3,easing:"none",direction:"horizontal",version:"1.1.0",backgroundType:"color",backgroundColor:"#00000000",backgroundImage:"",bgSizingMode:"stretch",bars:4};static hidden=!1;static key="barwipe";static name="BARWIPE";static template="barwipe-config";static category="wipe";static icon='<i class="fas fa-fw fa-bars"></i>';static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),directionSelect:{horizontal:"BATTLETRANSITIONS.DIRECTIONS.HORIZONTAL",vertical:"BATTLETRANSITIONS.DIRECTIONS.VERTICAL"}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,...T(n,"id","duration","bars","direction","easing","backgroundType","backgroundColor"),serializedTexture:r})}async execute(e){let n={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??E("transparent"),i=new Ke(n.direction,n.bars,r.baseTexture);this.addFilter(e,i),await this.simpleTween(i)}};var Nn=class t extends m{static DefaultSettings={type:"bilinearwipe",duration:1e3,easing:"none",radial:"inside",direction:"vertical",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="bilinearwipe";static name="BILINEARWIPE";static template="bilinearwipe-config";static category="wipe";static icon='<i class="fas fa-fw fa-arrows-left-right-to-line"></i>';static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),directionSelect:Yr(),radialSelect:G()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","radial","easing","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??E("transparent"),o=new Be(r.direction,r.radial,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};function B(t){return game.settings?.get("boss-splash",t)}var Dn=class t extends m{static get DefaultSettings(){return{type:"bosssplash",version:"1.1.0",duration:5e3,actor:"",topColor:B("colorFirst"),midColor:B("colorSecond"),botColor:B("colorThird"),fontColor:B("colorFont"),fontShadow:B("colorShadow"),subColor:B("subColorFont"),subShadow:B("subColorShadow"),sound:B("bossSound"),font:B("fontFamily"),fontSize:B("fontSize"),subSize:B("subFontSize"),message:B("splashMessage")==="{{actor.name}}"?"":B("splashMessage"),subText:B("subText"),animationDelay:B("animationDelay")*1e3,animationDuration:B("animationDuration")*1e3}}static get hidden(){return!game.modules?.get("boss-splash")?.active}static key="bosssplash";static name="BOSSSPLASH";static template="bosssplash-config";static category="effect";static icon="<i class='bt-icon boss-splash fa-fw fas'></i>";static RenderTemplate(e){let n=ei().sort(Ys).map(r=>({...Ks(r),selected:e?.actor===r.uuid}));return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,...e||{},fontSelect:Zr(),actors:n})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLElement?t.fromFormElement(e[0]):new t({...t.DefaultSettings,...e})}static fromFormElement(e){let n=$(e),r=n.find("#sound").val()??"";return ge("Form:",n.serializeArray()),new t({...t.DefaultSettings,sound:r,...T(n,"id","actor","message","subText","duration","animationDelay","animationDuration","topColor","midColor","botColor","fontColor","fontShadow","subColor","subShadow","font","fontSize","subSize")})}async execute(e,n){let r={...t.DefaultSettings,...this.config};n.caller===game.user?.id&&game.bossSplash.splashBoss(js(r)),console.log("Waiting:",r.duration+r.animationDelay),await Te(r.duration+r.animationDelay)}};function js(t){let e=fromUuidSync(t.actor);return{sound:t.sound,colorFirst:t.topColor,colorSecond:t.midColor,colorThird:t.botColor,colorFont:t.fontColor,subColorFont:t.subColor,colorShadow:t.fontShadow,subColorShadow:t.subShadow,message:t.message?t.message:e?.name??"",subText:t.subText,fontFamily:t.font,fontSize:t.fontSize,subFontSize:t.subSize,timer:t.duration,duration:t.duration,animationDelay:t.animationDelay,actorImg:e?.img??""}}function Ks(t){let e={name:t.name,uuid:t.uuid,pack:"",type:t.type,selected:!1};if(game.packs){let n=t.uuid.split(".");if(n[0]==="Compendium"){let r=n.slice(1,3).join("."),i=game.packs.get(r);i?.documentName==="Actor"&&(e.pack=i.title)}}return e}function Ys(t,e){let n=we(t.uuid),r=we(e.uuid);return n!==r?n.localeCompare(r):t.name.localeCompare(e.name)}var An=class t extends m{static DefaultSettings={id:"",type:"cleareffects",version:"1.1.0"};static hidden=!1;static key="cleareffects";static name="CLEAREFFECTS";static skipConfig=!0;static icon='<i class="fas fa-fw fa-eraser"></i>';static category="technical";static from(e){return new t({...t.DefaultSettings,id:foundry.utils.randomID()})}execute(e,n,r){let i=e.children.filter(o=>!r.overlay.includes(o));for(let o of i)o.destroy();for(let o of e.children)if(Array.isArray(o.filters)&&o.filters.length){let s=[...o.filters];o.filters=[];for(let a of s)a.destroy()}if(Array.isArray(e.filters)&&e.filters.length){let o=[...e.filters];for(let s of o)s.destroy();e.filters=[]}}};var On=class t extends m{static DefaultSettings={type:"clockwipe",duration:1e3,easing:"none",clockDirection:"clockwise",direction:"top",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="clockwipe";static name="CLOCKWIPE";static template="clockwipe-config";static icon="<i class='bt-icon clock-wipe fa-fw fas'></i>";static category="wipe";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),clockDirectionSelect:pe(),directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","direction","clockdirection","easing","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??E("transparent"),o=new qe(r.clockDirection,r.direction,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var Rn=class t extends m{static DefaultSettings={type:"diamondwipe",size:40,duration:1e3,easing:"none",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="diamondwipe";static name="DIAMONDWIPE";static template="diamondwipe-config";static icon="<i class='bt-icon diamond-wipe fa-fw fas'></i>";static category="wipe";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","easing","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e){let n={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??E("transparent"),i=new $e(n.size,r.baseTexture);this.addFilter(e,i),await this.simpleTween(i)}};var Fn=class t extends m{static DefaultSettings={type:"fade",duration:1e3,version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundColor:"#00000000",easing:"none"};static hidden=!1;static key="fade";static name="FADE";static template="fade-config";static icon="<i class='bt-icon fade fa-fw fas'></i>";static category="effect";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","backgroundType","backgroundColor","easing");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e,n){let i={...t.DefaultSettings,...this.config}.deserializedTexture??E("transparent"),o=new He(i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var kn=class t extends m{static DefaultSettings={type:"firedissolve",duration:1e3,easing:"none",burnSize:1.3,version:"1.1.0"};static hidden=!1;static key="firedissolve";static name="FIREDISSOLVE";static template="firedissolve-config";static icon="<i class='bt-icon fire-dissolve fa-fw fas'></i>";static category="wipe";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=T($(e),"id","duration","easing","burnSize");return new t({...t.DefaultSettings,...n})}async execute(e,n){let r=new Pe(this.config.burnSize);this.addFilter(e,r),await this.simpleTween(r)}};var Mn=class t extends m{static DefaultSettings={type:"flash",duration:250,version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="flash";static name="FLASH";static template="flash-config";static icon="<i class='bt-icon flash fa-fw fas'></i>";static category="effect";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??E("tranparent"),o=new se(i.baseTexture);this.addFilter(e,o),await Te(r.duration),this.removeFilter(e,o),o.destroy()}};var Pn=class t extends m{static DefaultSettings={type:"hueshift",duration:0,version:"1.1.0",maxShift:0,easing:"none"};static hidden=!1;static key="hueshift";static name="HUESHIFT";static template="hueshift-config";static category="effect";static icon="<i class='bt-icon hue-shift fa-fw fas'></i>";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#maxShift input[type='number']").val();return new t({...t.DefaultSettings,maxShift:r,...T(n,"id","duration","easing")})}async execute(e){let n={...t.DefaultSettings,...this.config},r=new je(0);this.addFilter(e,r),await TweenMax.to(r.uniforms,{shift:n.maxShift,duration:n.duration/1e3,ease:n.easing??"none"})}};var $n=class t extends m{static DefaultSettings={type:"invert",version:"1.1.0"};static hidden=!1;static key="invert";static name="INVERT";static skipConfig=!0;static template="";static category="effect";static icon="<i class='bt-icon invert fa-fw fas'></i>";static RenderTemplate(e){throw new U}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=T($(e),"id");return new t({id:foundry.utils.randomID(),...t.DefaultSettings,...n})}execute(e,n){let r=new Ge;this.addFilter(e,r)}};var Hn=class t extends m{defaultSettings={duration:1e3};static DefaultSettings={type:"linearwipe",duration:1e3,easing:"none",direction:"left",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="linearwipe";static name="LINEARWIPE";static template="linearwipe-config";static category="wipe";static icon='<i class="fas fa-fw fa-arrow-right"></i>';static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),directionSelect:ti()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",r=T($(e),"id","duration","direction","easing","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=r.deserializedTexture??E("transparent"),o=new We(r.direction,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var Bn=class t extends m{static DefaultSettings={type:"macro",macro:"",version:"1.1.0"};static hidden=!1;static key="macro";static name="MACRO";static template="macro-config";static icon="<i class='bt-icon macro fa-fw fas'></i>";static category="technical";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},macros:ni().sort(Zs).map(ea)})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=T($(e),"id","macro");return new t({...t.DefaultSettings,...n})}execute(e,n){let r={...t.DefaultSettings,...this.config},i=fromUuidSync(r.macro);if(!(i instanceof Macro))throw new Ie(r.macro);return i.execute()}};function Zs(t,e){let n=we(t.uuid),r=we(e.uuid);return n!==r?n.localeCompare(r):t.name.localeCompare(e.name)}function ea(t){let e={name:t.name,uuid:t.uuid,pack:""};if(game.packs){let n=t.uuid.split(".");if(n[0]==="Compendium"){let r=n.slice(1,3).join("."),i=game.packs.get(r);i?.documentName==="Macro"&&(e.pack=i.title)}}return e}var Wn=class t extends m{static DefaultSettings={type:"melt",duration:1e3,version:"1.1.0",easing:"none",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="melt";static name="MELT";static template="melt-config";static icon="<i class='bt-icon melt fa-fw fas'></i>";static category="warp";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroudnimage").val()??"",r=T($(e),"id","duration","easing","backgroundType","backgroundColor");return new t({...t.DefaultSettings,...r,serializedTexture:n})}async execute(e,n){let r=this.config.deserializedTexture??E("transparent"),i=new _e(r.baseTexture);this.addFilter(e,i),await this.simpleTween(i)}};var ri=3e3,qn=class{#e;async#t(e){await R.executePreparedSequence(e)}async#n(e){await R.prepareSequence(e)}async execute(e){try{let n=foundry.utils.randomID(),r={caller:game.user?.id??"",id:n,sequence:e.map(a=>typeof a.id>"u"?{...a,id:foundry.utils.randomID()}:a)};if(!e.some(a=>a.type==="startplaylist")){let a={...Ce.DefaultSettings,...new Ce({}).config};r.sequence.push(a)}let i=e.reduce((a,c)=>{switch(typeof c.duration){case"string":{let u=parseFloat(c.duration);if(!isNaN(u))return a+u;break}case"number":return a+c.duration}return a},0),o=game.users?.contents.filter(a=>a.active)??[],s=[];await Promise.any([Promise.all(o.map(a=>this.#e.executeAsUser("transition.prep",a.id,r).then(()=>{s.push(a)}))),Te(ri)]),s.length<o.length&&ui.notifications?.warn(l("BATTLETRANSITIONS.WARNINGS.PREPARETIMEOUT"),{console:!1}),await Promise.any([Promise.all(s.map(a=>this.#e.executeAsUser("transition.exec",a.id,r.id))),Te(i+ri)])}catch(n){ui.notifications?.error(n.message,{console:!1}),console.error(n)}}register(e){ge("Registering socket."),this.#e=e,e.register("transition.exec",this.#t.bind(this)),e.register("transition.prep",this.#n.bind(this))}},Ye=new qn;function ta(){let t=Ct();return lunr(function(){this.field("name"),this.field("description"),this.ref("key");for(let e of t)this.add({name:l(`BATTLETRANSITIONS.${e.name}.NAME`),description:l(`BATTLETRANSITIONS.${e.name}.DESCRIPTION`),key:e.key})})}function te(){wt=!1,$("#step-search-results").children().remove(),$("#step-search-results").css("display","none"),$("#clear-search").css("display","none")}function na(){let t=document.createElement("div");return t.setAttribute("id","step-search-results"),t.classList.add("step-search-results"),document.body.appendChild(t),$(t)}function ra(t){let e=document.createElement("div");return e.dataset.key=t.key,e.innerHTML=l(`BATTLETRANSITIONS.${t.name}.NAME`),t.icon?e.innerHTML=`${t.icon}${e.innerHTML}`:e.style.paddingLeft="calc(1.25em + 12px)",e}function ia(t){return ta().search(t).map(r=>w(r.ref)).filter(r=>!!r)}function yt(t,e,n){let r=t.val();if(!r||r.length<3){oa();return}let i=$("#step-search-results");(!i||!i.length)&&(i=na()),te(),$("#clear-search").css("display","block");let o=ia(r);for(let s of o){let a=ra(s);$(a).on("click",()=>{n(s.key)}),i.append(a)}sa(t,e)}function oa(){wt=!1,te(),$("#clear-search").css("display","none")}function ii(t,e){if(!wt)return;let n=$("#step-search-results");if(!n?.length||!t.length||e instanceof Dialog&&e.closing||foundry.applications?.api?.DialogV2&&e instanceof foundry.applications.api.DialogV2&&e.state===-2){te();return}n.css("top",(t?.offset()?.top??0)+(t?.height()??0)+8),n.css("left",t?.offset()?.left??0),n.css("width",t?.width()??150),requestAnimationFrame(()=>{ii(t,e)})}function sa(t,e){$("#step-search-results").css("display","block"),wt=!0,ii(t,e)}var wt=!1;var xt=class{static async prompt(){let e=await renderTemplate("/modules/battle-transitions/templates/dialogs/AddStepDialogV1.hbs",{tabs:[{icon:"",id:"wipes",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WIPES",data:ne("wipe")},{icon:"",id:"warps",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WARPS",data:ne("warp")},{icon:"",id:"effects",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.EFFECTS",data:ne("effect")},{icon:"",id:"technical",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.TECHNICAL",data:ne("technical")}]});return new Promise(n=>{let r=new Dialog({title:l("BATTLETRANSITIONS.DIALOGS.ADDSTEP.TITLE"),content:e,buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>{n(null)}}},close:()=>{te()},render:i=>{aa(r,$(i),n)}});r.render(!0,{classes:["dialog","bt"],resizable:!0})})}};function aa(t,e,n){new Tabs({contentSelector:".tab-content",navSelector:'.tabs[data-group="primary-tabs"]',initial:"wipes",callback:()=>{t.setPosition()}}).bind($(e)[0]),e.find("#search-text").on("input",i=>{yt($(i.currentTarget),t,o=>{n(o),t.close()})}),e.find("#clear-search").on("click",()=>{te(),e.find("#search-text").val("")}),e.find("button[data-transition]").on("click",i=>{i.preventDefault();let o=i.currentTarget?.dataset?.transition??"";n(o||null),t.close()})}var Lt=class{static async prompt(){let e=await renderTemplate("/modules/battle-transitions/templates/dialogs/AddStepDialogV2.hbs",{tabs:[{icon:"",id:"wipes",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WIPES",data:ne("wipe")},{icon:"",id:"warps",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WARPS",data:ne("warp")},{icon:"",id:"effects",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.EFFECTS",data:ne("effect")},{icon:"",id:"technical",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.TECHNICAL",data:ne("technical")}]});return new Promise(n=>{new foundry.applications.api.DialogV2({window:{title:l("BATTLETRANSITIONS.DIALOGS.ADDSTEP.TITLE")},content:e,position:{width:450},buttons:[{label:`<i class="fas fa-times"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel",callback:()=>(n(null),Promise.resolve())}]}).render(!0).then(i=>{ca(i,$(i.element),n)})})}};function ca(t,e,n){new Tabs({contentSelector:".tab-content",navSelector:".tabs[data-group='primary-tabs']",initial:"wipes"}).bind(t.element),e.find("button[data-transition]").on("click",i=>{i.preventDefault();let o=i.currentTarget.dataset.transition??"";n(o||null),te(),t.close()}),e.find("#clear-search").on("click",()=>{te(),e.find("#search-text").val("")}),e.find("#search-text").on("input",i=>{yt($(i.currentTarget),t,o=>{n(o),t.close(),te()})})}var vt=class{static async prompt(e){let n=w(e.type);if(!n)throw new b(typeof e.type=="string"?e.type:typeof e.type);let r=await n.RenderTemplate(e);return new Promise(i=>{let o=new Dialog({title:l("BATTLETRANSITIONS.DIALOGS.EDITSTEP.TITLE",{name:l(`BATTLETRANSITIONS.${n.name}.NAME`)}),content:r,buttons:{ok:{icon:'<i class="fas fa-check"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),callback:s=>{let a=n.from($(s).find("form"))?.config??null;i(a?{...n.DefaultSettings,...a}:null)}},cancel:{icon:'<i class="fas fa-times"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>{i(null)}}},render:s=>{la(o,$(s)),n.addEventListeners($(s),e)}});o.render(!0,{classes:["dialog","bt"],resizable:!0,width:500})})}};function la(t,e){e.find("input[type='number'],input[type='text']").on("focus",r=>{r.currentTarget.select()}),new Tabs({contentSelector:".tab-content",navSelector:".tabs[data-group='primary-tabs']",initial:"wipes"}).bind(e[0]),oi(e),e.find("#backgroundType").on("change",()=>{oi(e)}),ColorPicker.install()}function oi(t){let e=t.find("#backgroundType").val();e==="color"?(t.find("#backgroundColor").css("display","block"),t.find("#backgroundImage").css("display","none")):e==="image"&&(t.find("#backgroundImage").css("display",""),t.find("#backgroundColor").css("display","none"))}var Nt=class{static async prompt(e){let n=w(e.type);if(!n)throw new b(typeof e.type=="string"?e.type:typeof e.type);let r=await n.RenderTemplate(e);return new Promise(i=>{new foundry.applications.api.DialogV2({window:{title:l("BATTLETRANSITIONS.DIALOGS.EDITSTEP.TITLE",{name:l(`BATTLETRANSITIONS.${n.name}.NAME`)})},content:r,buttons:[{label:`<i class="fas fa-check"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK")}`,default:!0,action:"ok",callback:(s,a,c)=>{let u=n.from($(c).find("form"))?.config??null;return i(u?{...n.DefaultSettings,...u}:null),Promise.resolve()}},{label:`<i class="fas fa-times"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel"}]}).render(!0).then(s=>{s.position.width=500,ua(s,$(s.element)),n.addEventListeners($(s.element),e)})})}};function ua(t,e){e.find("input[type='number'],input[type='text']").on("focus",r=>{r.currentTarget.select()}),new Tabs({contentSelector:".tab-content",navSelector:".tabs[data-group='primary-tabs']",initial:"wipes"}).bind(t.element),si(e),e.find("#backgroundType").on("change",()=>{si(e)}),ColorPicker.install()}function si(t){let e=t.find("#backgroundType").val();e==="color"?(t.find("#backgroundColor").css("display","block"),t.find("#backgroundImage").css("display","none")):e==="image"&&(t.find("#backgroundImage").css("display",""),t.find("#backgroundColor").css("display","none"))}var Dt=class{static async prompt(e){let n=await renderTemplate("/modules/battle-transitions/templates/dialogs/TransitionBuilder.hbs",{scene:e?.id,scenes:game.scenes?.contents.map(r=>({id:r.id,name:r.name}))??[]});return new Promise(r=>{let i=new Dialog({title:l("BATTLETRANSITIONS.DIALOGS.TRANSITIONBUILDER.TITLE"),content:n,render:o=>{pa(i,$(o))},default:"ok",buttons:{ok:{icon:'<i class="fas fa-play"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.TRANSITION"),callback:o=>{let s=$(o),a=fe(s),c=e?e.id:s.find("#scene").val();if(!c)throw new D(typeof c=="string"?c:typeof c);let u=w("scenechange");if(!u)throw new b("scenechange");let S={...u.DefaultSettings,scene:c};r([S,...a])}},cancel:{icon:'<i class="fas fa-times"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>{r(null)}}}});i.render(!0,{resizable:!0})})}};function pa(t,e){e.find("button[data-action='add-step']").on("click",n=>{n.preventDefault(),fa(t,e)}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"})}async function fa(t,e){let n=await J();if(!n)return;let r=w(n);if(!r)throw new b(n);let i=null;r.skipConfig?i={...r.DefaultSettings,id:foundry.utils.randomID()}:i=await k(r.DefaultSettings),i&&(await ai(t,e,i),t.setPosition())}async function ai(t,e,n){let r=w(n.type);if(!r)throw new b(n.type);let i=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...r.DefaultSettings,...n,name:l(`BATTLETRANSITIONS.${r.name}.NAME`),description:l(`BATTLETRANSITIONS.${r.name}.DESCRIPTION`),type:r.key,flag:JSON.stringify({...r.DefaultSettings,...n})}),o=$(i),s=e.find(`[data-id="${n.id}"]`);s.length?s.replaceWith(o):e.find("#transition-step-list").append(o),ma(t,e,o,n)}function ma(t,e,n,r){n.find("[data-action='remove']").on("click",()=>{let i=w(r.type);if(!i)throw new b(r.type);z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)})).then(o=>{o&&(n.remove(),t.setPosition())}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{k(r).then(i=>{if(i)return ai(t,e,i)}).then(()=>{}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})})}var At=class{static async prompt(e){let n=await renderTemplate("/modules/battle-transitions/templates/dialogs/TransitionBuilder.hbs",{scene:e?.id,scenes:game.scenes?.contents.map(r=>({id:r.id,name:r.name}))??[]});return new Promise(r=>{new foundry.applications.api.DialogV2({window:{title:l("BATTLETRANSITIONS.DIALOGS.TRANSITIONBUILDER.TITLE")},content:n,buttons:[{label:`<i class="fas fa-play"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.TRANSITION")}`,default:!0,action:"ok",callback:(o,s,a)=>{let c=$(a),u=fe(c),S=e?e.id:c.find("#scene").val();if(!S)throw new D(typeof S=="string"?S:typeof S);let p=w("scenechange");if(!p)throw new b("scenechange");let h={...p.DefaultSettings,scene:S};return r([h,...u]),Promise.resolve()}},{label:`<I class="fas fa-times"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel",callback:()=>(r(null),Promise.resolve())}]}).render(!0).then(o=>{da(o,$(o.element))})})}};function da(t,e){e.find("button[data-action='add-step']").on("click",n=>{n.preventDefault(),ga(t,e)}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"})}async function ga(t,e){let n=await J();if(!n)return;let r=w(n);if(!r)throw new b(n);let i=null;r.skipConfig?i={...r.DefaultSettings,id:foundry.utils.randomID()}:i=await k(r.DefaultSettings),i&&await ci(t,e,i)}async function ci(t,e,n){let r=w(n.type);if(!r)throw new b(n.type);let i=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...r.DefaultSettings,...n,name:l(`BATTLETRANSITIONS.${r.name}.NAME`),description:l(`BATTLETRANSITIONS.${r.name}.DESCRIPTION`),type:r.key,flag:JSON.stringify({...r.DefaultSettings,...n})}),o=$(i),s=e.find(`[data-id="${n.id}"]`);s.length?s.replaceWith(o):e.find("#transition-step-list").append(o),Ta(t,e,o,n)}function Ta(t,e,n,r){n.find("[data-action='remove']").on("click",()=>{let i=w(r.type);if(!i)throw new b(r.type);z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)})).then(o=>{o&&n.remove()}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{k(r).then(i=>{if(i)return ci(t,e,i)}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})})}async function J(){return Se()?Lt.prompt():xt.prompt()}function ne(t,e=!1){return Ct().reduce((n,r)=>r.category===t&&(e||r.hidden===!1)?[...n,{key:r.key,name:`BATTLETRANSITIONS.${r.name}.NAME`,description:`BATTLETRANSITIONS.${r.name}.DESCRIPTION`,icon:r.icon,tooltip:"",hasIcon:!!r.icon}]:n,[])}async function k(t){return Se()?Nt.prompt(t):vt.prompt(t)}async function z(t,e){return Se()?foundry.applications.api.DialogV2.confirm({window:{title:t},content:e}):Dialog.confirm({title:t,content:e}).then(n=>!!n)}function fe(t){let e=[];return t.find("#transition-step-list [data-transition-type]").each((n,r)=>{let i=r.dataset.flag??"",o=JSON.parse(i);e.push(o)}),e}async function li(t){return Se()?At.prompt(t):Dt.prompt(t)}var st=Dr(sr());var y=class{Migrate(e){let n=this.Version(e);if(st.default.gt(n,this.NewestVersion))throw new ke(n);if(!n)throw new ft(n);if(n===this.NewestVersion)return e;let r=Object.entries(this.migrationFunctions);for(let[i,o]of r)if(st.default.satisfies(n,i))return o(e);throw new ye(n,this.NewestVersion)}NeedsMigration(e){let n=this.Version(e);if(st.default.gt(n,this.NewestVersion))throw new ke(n);return st.default.lt(n,this.NewestVersion)}};var pu="1.1.0",qt=class extends y{migrationFunctions={"~1.0":fu};Version(e){return typeof e.version>"u"?"1.0.5":e.version}NewestVersion=pu};function fu(t){let e={autoTrigger:t.config?.autoTrigger??!1,version:"1.1.0",isTriggered:!1,sequence:[]};return Array.isArray(t.steps)&&t.steps.length&&(e.sequence=t.steps.map(n=>{if(!w(n.type))throw new b(typeof n.type=="string"?n.type:typeof n.class);let i=me.TransitionSteps[n.type];if(!i)throw new ye("undefined","#{VERSION}#");return i.NeedsMigration(n)?i.Migrate(n):n})),e}var Ut=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Xt=class extends y{migrationFunctions={"~1.0":mu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function mu(t){return{id:t.id,type:"bilinearwipe",version:"1.1.0",duration:t.duration,easing:t.easing,direction:t.direction,radial:t.radial,...q(t)}}var _t=class extends y{migrationFunctions={"~1.0":du};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function du(t){return{id:t.id,type:"clockwipe",version:"1.1.0",easing:t.easing,duration:t.duration,direction:t.direction,clockDirection:t.clockdirection,...q(t)}}var Vt=class extends y{migrationFunctions={"~1.0":gu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function gu(t){return{id:t.id,type:"diamondwipe",version:"1.1.0",duration:t.duration,size:t.size,easing:t.easing,...q(t)}}var zt=class extends y{migrationFunctions={"~1.0":Tu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Tu(t){return{id:t.id,easing:t.easing,duration:t.duration,type:"fade",version:"1.1.0",...q(t)}}var Gt=class extends y{migrationFunctions={"~1.1.0":Su};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Su(t){return{id:t.id,easing:t.easing,duration:t.duration,burnSize:t.burnSize,type:"firedissolve",version:"1.1.0"}}var Jt=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Qt=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var jt=class extends y{migrationFunctions={"~1.0":Eu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Eu(t){return{id:t.id,type:"linearwipe",version:"1.1.0",duration:t.duration,direction:t.direction,easing:t.easing,...q(t)}}var Kt=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Yt=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Zt=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var en=class extends y{migrationFunctions={"~1.0":bu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function bu(t){return{id:t.id,easing:t.easing??"none",version:"1.1.0",radial:t.radial,duration:t.duration,type:"radialwipe",...q(t)}}var tn=class extends y{migrationFunctions={"~1.0":hu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function hu(t){return{type:t.type,version:"1.1.0"}}var nn=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var rn=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var on=class extends y{migrationFunctions={"~1.0":Iu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Iu(t){return{id:t.id,file:t.file,type:"sound",version:"1.1.0",volume:t.volume}}var sn=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var an=class extends y{migrationFunctions={"~1.0":yu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function yu(t){return{version:"1.1.0",type:"spotlightwipe",duration:t.duration,easing:t.easing??"none",direction:t.direction,radial:t.radial,...q(t)}}var cn=class extends y{migrationFunctions={"~1.0":wu};NewestVersion="1.1";Version(e){return e.version??"1.0.5"}};function wu(t){return{version:"1.1.0",type:"textureswap",bgSizingMode:"stretch",backgroundImage:t.texture&&!ce(t.texture)?t.texture:"",backgroundColor:t.texture&&!ce(t.texture)?"":t.texture,backgroundType:t.texture&&!ce(t.texture)?"image":"color"}}var ln=class extends y{migrationFunctions={"~1.0":Cu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Cu(t){return{version:"1.1.0",type:"video",id:t.id,file:t.file,volume:t.volume,clear:t.clear,videoSizingMode:"stretch",...q(t)}}var un=class extends y{migrationFunctions={"~1.0":xu};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function xu(t){return{type:"wait",version:"1.1.0",duration:t.duration}}var pn=class extends y{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var ns={angularwipe:new Ut,bilinearwipe:new Xt,clockwipe:new _t,diamondwipe:new Vt,fade:new zt,firedissolve:new Gt,flash:new Jt,invert:new Qt,linearwipe:new jt,macro:new Kt,melt:new Yt,parallel:new Zt,radialwipe:new en,removeoverlay:new tn,restoreoverlay:new nn,scenechange:new rn,sound:new on,spiralradialwipe:new sn,spotlightwipe:new an,textureswap:new cn,video:new ln,wait:new un,wavewipe:new pn};var me=class{static SceneConfiguration=new qt;static TransitionSteps=ns};var re=class t{static AddToNavigationBar(e){e.push({name:"BATTLETRANSITIONS.NAVIGATION.TRIGGER",icon:'<i class="fas bt-icon fa-fw crossed-swords"></i>',condition:n=>{try{let r=ar(n);if(!r||r.id===canvas?.scene?.id)return!1;let i=this.GetSceneTransition(r)??[];return Array.isArray(i)&&i.length}catch(r){ui.notifications?.error(r.message,{console:!1}),console.error(r)}},callback:n=>{let r=ar(n);if(!r)throw new D(typeof n.data("sceneId")=="string"?n.data("sceneId"):typeof n.data("sceneId"));let i=this.GetSceneTransition(r)??[];if(!(Array.isArray(i)&&i.length))return;let o=new Y({scene:r.id??""}),s={id:foundry.utils.randomID(),...Y.DefaultSettings,...o.config};R.executeSequence([s,...i])}},{name:"BATTLETRANSITIONS.NAVIGATION.CUSTOM",icon:"<i class='fas fa-fw fa-hammer'></i>",condition:n=>{let r=ar(n);return r?r.id!==canvas?.scene?.id:!1},callback:n=>{let r=n.data("sceneId"),i=game.scenes?.get(r);if(!(i instanceof Scene))throw new D(typeof r=="string"?r:typeof r);i.canUserModify(game.user,"update")&&R.BuildTransition(i)}})}static SetSceneConfiguration(e,n){let r={...n},i=e.flags["battle-transitions"];for(let o in i)Object.keys(r).includes(o)||(r[`-=${o}`]=null);return e.update({flags:{"battle-transitions":r}})}static GetSceneConfiguration(e){let n=e.flags["battle-transitions"];return n?me.SceneConfiguration.NeedsMigration(n)?me.SceneConfiguration.Migrate(n):n:{autoTrigger:!1,version:me.SceneConfiguration.NewestVersion,sequence:[]}}static GetSceneTransition(e){return t.GetSceneConfiguration(e).sequence}static async InjectSceneConfig(e,n,r){let i=t.GetSceneConfiguration(e.object);game.release?.isNewer("12")?await mn.inject(e,n,r,i):await fn.inject(e,n,r,t.GetSceneConfiguration(e.object))}static BuildTransitionFromForm(e){let n=[];return e.find("#transition-step-list [data-transition-type]").each((r,i)=>{let o=i.dataset.flag??"",s=JSON.parse(o);n.push(s)}),n}};function ar(t){let e=t.data("sceneId");if(!e)return;if(!e)throw new D(typeof e=="string"?e:typeof e);let n=game.scenes?.get(e);if(!(n instanceof Scene))throw new D(typeof e=="string"?e:typeof e);return n}var fn=class extends SceneConfig{static async inject(e,n,r,i){let o=await renderTemplate("/modules/battle-transitions/templates/config/scene-nav-bar.hbs",{});n.find("nav.sheet-tabs.tabs").append(o);let a=await renderTemplate("/modules/battle-transitions/templates/scene-config.hbs",i);n.find('button[type="submit"]').before(`<div class="tab" data-tab="battle-transitions">${a}</div>`),Lu(e,n)}};function Lu(t,e){e.find("button[data-action='add-step']").on("click",n=>{n.preventDefault(),vu(t,e)}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),e.find("button[type='submit']").on("click",()=>{let n=!!(e.find("#auto-trigger").val()??!1),r=fe(e);re.SetSceneConfiguration(t.document,{version:"1.1.0",autoTrigger:n,isTriggered:!1,sequence:r})})}async function vu(t,e){let n=await J();if(!n)return;let r=w(n);if(!r)throw new b(n);let i=null;r.skipConfig?i={...r.DefaultSettings,id:foundry.utils.randomID()}:i=await k(r.DefaultSettings),i&&(await rs(t,e,i),t.setPosition())}async function rs(t,e,n){let r=w(n.type);if(!r)throw new b(n.type);let i=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...r.DefaultSettings,...n,name:l(`BATTLETRANSITIONS.${r.name}.NAME`),description:l(`BATTLETRANSITIONS.${r.name}.DESCRIPTION`),type:r.key,flag:JSON.stringify({...r.DefaultSettings,...n})}),o=$(i),s=e.find(`[data-id="${n.id}"]`);s.length?s.replaceWith(o):e.find("#transition-step-list").append(o),Nu(t,e,o,n)}function Nu(t,e,n,r){n.find("[data-action='remove']").on("click",()=>{let i=w(r.type);if(!i)throw new b(r.type);z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)})).then(o=>{o&&(n.remove(),t.setPosition())}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{k(r).then(i=>{if(i)return rs(t,e,i)}).then(()=>{}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})})}var mn=class extends SceneConfig{static async inject(e,n,r,i){let o=await renderTemplate("/modules/battle-transitions/templates/config/scene-nav-bar.hbs",{});n.find("nav.sheet-tabs.tabs[data-group='main']").append(o);let a=await renderTemplate("/modules/battle-transitions/templates/scene-config.hbs",i);n.find("footer.sheet-footer").before(`<div class="tab" data-group="main" data-tab="battle-transitions">${a}</div>`);for(let c of i.sequence)await cr(e,n,c);Du(e,n)}};function Du(t,e){e.find('button[data-action="add-step"]').on("click",n=>{n.preventDefault(),Au(t,e)}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),e.find(".sheet-footer button[type='submit']").on("click",()=>{let n=!!(e.find("#auto-trigger").val()??!1),r=fe(e);re.SetSceneConfiguration(t.document,{version:"1.1.0",autoTrigger:n,isTriggered:!1,sequence:r})})}async function Au(t,e){let n=await J();if(!n)return;let r=w(n);if(!r)throw new b(n);let i=null;r.skipConfig?i={...r.DefaultSettings,id:foundry.utils.randomID()}:i=await k(r.DefaultSettings),i&&(await cr(t,e,i),t.setPosition())}async function cr(t,e,n){let r=w(n.type);if(!r)throw new b(n.type);let i=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...r.DefaultSettings,...n,name:l(`BATTLETRANSITIONS.${r.name}.NAME`),description:l(`BATTLETRANSITIONS.${r.name}.DESCRIPTION`),type:r.key,flag:JSON.stringify({...r.DefaultSettings,...n})}),o=$(i),s=e.find(`[data-id="${n.id}"]`);s.length?s.replaceWith(o):e.find("#transition-step-list").append(o),Ou(t,e,o,n)}function Ou(t,e,n,r){n.find("[data-action='remove']").on("click",()=>{let i=w(r.type);if(!i)throw new b(r.type);z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l(`BATTLETRANSITIONS.${i.name}.NAME`)})).then(o=>{o&&(n.remove(),t.setPosition())}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{k(r).then(i=>{if(i)return cr(t,e,i)}).then(()=>{}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})})}var R=class t{#e=[];static SuppressSoundUpdates=!1;constructor(e){try{if(e){let n=It(e);if(!(n instanceof Scene))throw new D(typeof e=="string"?e:typeof e);if(n.id===canvas?.scene?.id)throw new ht;this.#e.push({type:"scenechange",scene:n.id})}}catch(n){throw ui.notifications?.error(n.message),n}}get sequence(){return this.#e}static async BuildTransition(e){let n=await li(e);n&&await t.executeSequence(n)}static async SelectScene(e=!1){let n=await renderTemplate("/modules/battle-transitions/templates/scene-selector.hbs",{scenes:game.scenes?.contents.reduce((r,i)=>e&&i.id===game.scenes?.current?.id?r:[...r,{id:i.id,name:i.name}],[])});return Se()?foundry.applications.api.DialogV2.wait({window:{title:l("BATTLETRANSITIONS.SCENESELECTOR.TITLE")},content:n,buttons:[{label:`<i class="fas fa-times"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel",callback:()=>Promise.resolve(null)},{label:`<i class="fas fa-check"></i> ${l("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK")}`,action:"ok",callback:(r,i,o)=>Promise.resolve(game.scenes?.get($(o).find("#scene").val())??null)}]}):Dialog.wait({title:l("BATTLETRANSITIONS.SCENESELECTOR.TITLE"),content:n,default:"ok",buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>null},ok:{icon:'<i class="fas fa-check"></i>',label:l("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),callback:r=>game.scenes?.get($(r).find("#scene").val())??null}}})}static async executePreparedSequence(e){let n=lt[e];if(!n)throw new b(typeof n);Hooks.callAll(K.TRANSITION_START,n.original);let r=null;try{r=await is(),n.overlay=[...r.children],ss(),t.SuppressSoundUpdates=!0;for(let i of n.prepared.sequence){let o=i.execute(r,n.original,n);o instanceof Promise&&await o}t.SuppressSoundUpdates=!1;for(let i of n.prepared.sequence)await i.teardown(r)}finally{setTimeout(()=>{as()},250),r&&os(r),n?Hooks.callAll(K.TRANSITION_END,n.original):Hooks.callAll(K.TRANSITION_END),delete lt[e]}}static async executeSequence(e){if(e[0].type!=="scenechange")throw new D("undefined");let n=game.scenes?.get(e[0].scene);if(!(n instanceof Scene))throw new D(typeof e[0].scene=="string"?e[0].scene:typeof e[0].scene);if(!n.canUserModify(game.user,"update"))throw new St;await Ye.execute(e)}static async prepareSequence(e){try{let n=[];for(let r of e.sequence){let i={...r},o=Ru(i);if(!o)throw new b(typeof i.type=="string"?i.type:typeof i.type);if(Object.prototype.hasOwnProperty.call(i,"backgroundType")){let a=i;if(a.serializedTexture)a.deserializedTexture=dn(a.serializedTexture);else switch(a.backgroundType){case"color":a.deserializedTexture=dn(a.backgroundColor??"transparent");break;case"image":a.deserializedTexture=dn(a.backgroundImage??"transparent");break}}let s=o.prepare(e);s instanceof Promise&&await s,n.push(o)}return lt[e.id]={original:e,prepared:{...e,sequence:n},overlay:[]},n}catch(n){return ui.notifications?.error(n.message,{console:!1}),console.error(n),[]}}static async teardownSequence(e,n){for(let r of n.sequence)await r.teardown(e)}static async validateSequence(e){try{for(let n of e){let r=w(n.type);if(!r)throw new b(n.type);let i=await r.validate(n);if(i instanceof Error)return i}return!0}catch(n){throw n}}angularWipe(e=1e3,n="transparent",r="none"){let i=P(n);return this.#e.push({type:"angularwipe",duration:e,serializedTexture:i,easing:r}),this}barWipe(e,n,r=1e3,i="transparent",o="none"){let s=P(i),a=w("barwipe");if(!a)throw new b("barwipe");return this.#e.push({...a.DefaultSettings,duration:r,bars:e,easing:o,direction:n,serializedTexture:s}),this}bilinearWipe(e,n,r=1e3,i="transparent",o="none"){let s=P(i);return this.#e.push({type:"bilinearwipe",serializedTexture:s,duration:r,direction:e,radial:n,easing:o}),this}bossSplash(e){let n=w("bosssplash");if(!n)throw new b("bosssplash");let r={...n.DefaultSettings,...e};return this.#e.push(r),this}burn(e=1e3,n=1.3,r="none"){return this.#e.push({type:"firedissolve",duration:e,burnSize:n,easing:r}),this}clockWipe(e,n,r=1e3,i="transparent",o="none"){let s=P(i);return this.#e.push({type:"clockwipe",serializedTexture:s,duration:r,clockDirection:e,direction:n,easing:o}),this}diamondWipe(e=40,n=1e3,r="transparent",i="none"){let o=P(r);return this.#e.push({type:"diamondwipe",serializedTexture:o,size:e,duration:n,easing:i}),this}async execute(){if(!(Array.isArray(this.#e)&&this.#e.length))throw new b(typeof this.#e);await Ye.execute(this.#e)}fade(e=1e3,n="transparent",r="none"){let i=P(n);return this.#e.push({type:"fade",serializedTexture:i,duration:e,easing:r}),this}flash(e,n){let r=w("flash");if(!r)throw new b("flash");let i=P(e);return this.#e.push({...r.DefaultSettings,duration:n,serializedTexture:i}),this}hueShift(e,n=0){let r=w("hueshift");if(!r)throw new b("hueshift");let i={...r.DefaultSettings,maxShift:e,duration:n};return this.#e.push(i),this}invert(){let e=w("invert");if(!e)throw new b("invert");return this.#e.push({...e.DefaultSettings,id:foundry.utils.randomID()}),this}linearWipe(e,n=1e3,r="transparent",i="none"){let o=P(r);return this.#e.push({type:"linearwipe",serializedTexture:o,direction:e,duration:n,easing:i}),this}macro(e){let n=Rr(e);if(!n)throw new Ie(typeof e=="string"?e:typeof e);return this.#e.push({type:"macro",macro:n.uuid}),this}melt(e=1e3,n="transparent",r="none"){let i=P(n);return this.#e.push({type:"melt",serializedTexture:i,duration:e,easing:r}),this}parallel(...e){let n=[];for(let o of e){let s=o(new t);if(s instanceof Promise)throw new Tt;n.push(s.sequence)}let r=w("parallel");if(!r)throw new b("parallel");let i={...r?.DefaultSettings,sequences:n};return this.#e.push(i),this}pixelate(e=100,n=1e3){let r=w("pixelate");if(!r)throw new b("pixelate");let i={...r.DefaultSettings,maxSize:e,duration:n};return this.#e.push(i),this}radialWipe(e,n=1e3,r="transparent",i="none"){let o=P(r);return this.#e.push({type:"radialwipe",serializedTexture:o,radial:e,duration:n,easing:i}),this}removeOverlay(){return this.#e.push({id:foundry.utils.randomID(),type:"removeoverlay",version:"1.1.0"}),this}clearEffects(){let e=w("cleareffects");if(!e)throw new b("cleareffects");return this.#e.push({...e.DefaultSettings,id:foundry.utils.randomID()}),this}repeat(e,...n){let r=typeof n[0]=="number"?n[0]:0,i=typeof n[0]=="number"?n[1]:n[0];if(typeof i=="function"&&!this.#e.some(s=>s.type!=="scenechange"))throw new dt;let o=w("repeat");if(!o)throw new b("repeat");if(i){let s=new t,a=i(s);if(a instanceof Promise)throw new Et;this.#e.push({...o.DefaultSettings,iterations:e,delay:r,style:"sequence",sequence:a.sequence})}else this.#e.push({...o.DefaultSettings,iterations:e-1,delay:r,style:"previous"});return this}restoreOverlay(){return this.#e.push({id:foundry.utils.randomID(),type:"restoreoverlay",version:"1.1.0"}),this}sound(e,n=100){let r=typeof e=="string"?e:e instanceof Sound?e.id:null;if(!r)throw new pt(typeof e=="string"?e:typeof e);return this.#e.push({type:"sound",volume:n,file:r}),this}spiralShutter(e,n,r=1e3,i="transparent",o="none"){let s=P(i);return this.#e.push({type:"spiralradialwipe",serializedTexture:s,duration:r,easing:o,direction:e,radial:n}),this}spiralWipe(e,n,r,i=1e3,o="transparent",s="none"){let a=P(o),c=typeof a=="string"&&ce(a)?"color":"image";return this.#e.push({type:"spiralwipe",version:"1.1.0",duration:i,direction:r,clockDirection:e,radial:n,easing:s,bgSizingMode:"stretch",backgroundType:c,serializedTexture:a}),this}spotlightWipe(e,n,r=1e3,i="transparent",o="none"){let s=P(i);return this.#e.push({type:"spotlightwipe",direction:e,radial:n,duration:r,serializedTexture:s,easing:o}),this}textureSwap(e){let n=P(e);return this.#e.push({type:"textureswap",serializedTexture:n}),this}twist(e=1e3,n="clockwise",r=10){return this.#e.push({type:"twist",duration:e,direction:n,maxAngle:r}),this}video(e,...n){let r=n.find(a=>typeof a=="number")??100,i=n.find(a=>typeof a=="boolean")??!1,o=n.find(a=>!(typeof a=="boolean"||typeof a=="number"))??"transparent",s=P(o);return this.#e.push({type:"video",volume:r,file:e,serializedTexture:s,clear:i}),this}wait(e){return this.#e.push({type:"wait",duration:e}),this}waveWipe(e,n=1e3,r="transparent",i="none"){let o=P(r);return this.#e.push({type:"wavewipe",serializedTexture:o,direction:e,duration:n,easing:i}),this}zoomBlur(e=1e3,n=.5,r=0){return this.#e.push({type:"zoomblur",duration:e,maxStrength:n,innerRadius:r}),this}};function Ru(t){let e=w(t.type);if(!e)throw new b(t.type);return e.from(t)}var lr=class t extends m{#e=[];static DefaultSettings={type:"parallel",version:"1.1.0",sequences:[]};static category="technical";static hidden=!1;static icon='<i class="fas fa-fw fa-arrows-down-to-line"></i>';static key="parallel";static name="PARALLEL";static template="parallel-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static async addEventListeners(e,n){if(Array.isArray(n?.sequences)&&n.sequences.length)for(let r of n.sequences)await gn(e,r);else await gn(e,[]),await gn(e,[]);ur(e,0),e.find('button[data-action="add-sequence"]').on("click",r=>{r.preventDefault(),gn(e,[]).then(()=>{let i=e.find("#sequence-list .sequence-item").length-1;ur(e,i)}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})}),e.find("[data-action='add-step']").on("click",r=>{r.preventDefault(),ku(e)}),e.find("#selected-sequence-steps").sortable({handle:".drag-handle",containment:"parent",axis:"y"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=[],r=$(e);r.find(".sequence-item").each((o,s)=>{if(!s.dataset.sequence)return;let a=JSON.parse(s.dataset.sequence);n.push(a)});let i={...t.DefaultSettings,...T(r,"id"),sequences:n};return new t(i)}async execute(e,n){await Promise.all(this.#e.map(r=>this.executeSequence(e,n,r)))}async prepare(e){let n={...t.DefaultSettings,...this.config};this.#e=[];for(let r of n.sequences){let i=await R.prepareSequence({...e,sequence:r});this.#e.push(i)}}async executeSequence(e,n,r){for(let i of r){let o=i.execute(e,n);o instanceof Promise&&await o}}};async function gn(t,e=[]){let n=t.find("#sequence-list .sequence-item").length,r=await renderTemplate("/modules/battle-transitions/templates/config/sequence-item.hbs",{index:n,sequence:e,serialized:JSON.stringify(e),name:l("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:n+1})}),i=$(r);t.find("button[data-action='add-sequence']").before(i),Fu(i)}function Fu(t){t.find("[data-action='configure']").on("click",()=>{let e=t.data("index");ur(t.parents("[data-transition-type='parallel']"),e)}),t.find("[data-action='remove']").on("click",e=>{e.preventDefault();let n=t.data("index");z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:n})}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:n})})).then(r=>{if(r){let i=t.parents("#sequence-list");t.remove(),$u(i)}}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})})}async function ku(t){let e=await J();if(!e)return;let n=w(e);if(!n)throw new b(e);let r=n.skipConfig?n.DefaultSettings:await k(n.DefaultSettings);r&&pr(t,r)}function Mu(t,e,n){e.find("[data-action='remove']").on("click",()=>{let r=w(n.type);if(!r)throw new b(n.type);z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l(`BATTLETRANSITIONS.${r.name}.NAME`)}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l(`BATTLETRANSITIONS.${r.name}.NAME`)})).then(i=>{i&&e.remove()}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})}),e.find("[data-action='configure']").on("click",()=>{k(n).then(r=>{if(r)return pr(t,r)}).then(()=>{}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})})}function Pu(t){let e=[];return t.find("#selected-sequence-steps [data-transition-type]").each((n,r)=>{let i=r.dataset.flag??"";if(!i)return;let o=JSON.parse(i);e.push(o)}),e}function $u(t){t.find("[data-sequence]").each((e,n)=>{$(n).data("index",e),$(n).find("[data-action='configure']").text(l("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:e+1}))})}async function ur(t,e){let r=t.find(`.sequence-item[data-index="${e}"]`).attr("data-sequence"),i=JSON.parse(r),o=t.find("#selected-sequence");o.data("index",e),o.find("#sequence-name").text(l("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:e+1})),o.find("#selected-sequence-steps").children().remove();for(let a of i){if(!w(a.type))throw new b(typeof a.type=="string"?a.type:typeof a.type);await pr(t,a)}}async function pr(t,e){let n=w(e.type);if(!n)throw new b(e.type);let r=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...n.DefaultSettings,...e,name:l(`BATTLETRANSITIONS.${n.name}.NAME`),description:l(`BATTLETRANSITIONS.${n.name}.DESCRIPTION`),type:n.key,flag:JSON.stringify({...n.DefaultSettings,...e})}),i=$(r),o=t.find(`[data-id="${e.id}"]`);o.length?o.replaceWith(i):t.find("#selected-sequence-steps").append(i),Mu(t,i,e);let s=i.parents("[data-index]").data("index"),a=Pu(t);t.find(`#sequence-list [data-index="${s}"]`).attr("data-sequence",JSON.stringify(a))}var fr=class t extends m{static DefaultSettings={type:"pixelate",version:"1.1.0",maxSize:100,duration:1e3,easing:"none"};static hidden=!1;static key="pixelate";static name="PIXELATE";static template="pixelate-config";static category="effect";static icon='<i class="fas fa-fw fa-image"></i>';static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e);return new t({...t.DefaultSettings,...T(n,"id","duration","maxSize")})}async execute(e){let n=new PIXI.filters.PixelateFilter(1);this.addFilter(e,n);let r={...t.DefaultSettings,...this.config};await TweenMax.to(n.uniforms.size,{0:r.maxSize,1:r.maxSize,duration:r.duration/1e3,ease:r.easing})}};var mr=class t extends m{defaultSettings={duration:1e3,easing:"none"};static DefaultSettings={type:"radialwipe",easing:"none",radial:"inside",duration:1e3,bgSizingMode:"stretch",version:"1.1.0",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="radialwipe";static name="RADIALWIPE";static template="radialwipe-config";static icon="<i class='bt-icon radial-wipe fa-fw fas'></i>";static category="wipe";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),radialSelect:G()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,serializedTexture:r,...T(n,"id","duration","radial","backgroundType","backgroundColor","easing")})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=r.deserializedTexture??E("transparent"),o=new Xe(r.radial,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var dr=class t extends m{static DefaultSettings={type:"removeoverlay",version:"1.1.0"};static hidden=!1;static key="removeoverlay";static name="REMOVEOVERLAY";static skipConfig=!0;static template="";static icon="<i class='bt-icon remove-overlay fa-fw fas'></i>";static category="technical";static RenderTemplate(e){throw new U}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,...T($(e),"id")})}execute(e,n){e.alpha=0}};var Hu="1.1.0",at=class t extends m{static DefaultSettings={type:"wait",duration:0,version:Hu};static hidden=!1;static key="wait";static name="WAIT";static template="wait-config";static icon="<i class='bt-icon wait fa-fw fas'></i>";static category="technical";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e);return new t({...t.DefaultSettings,...T(n,"id","duration")})}execute(){let e={...t.DefaultSettings,...this.config};return new Promise(n=>{setTimeout(n,e.duration)})}};var gr=class t extends m{#e=[];static DefaultSettings={id:"",type:"repeat",version:"1.1.0",style:"previous",delay:0,iterations:2};static category="technical";static hidden=!1;static icon='<i class="fas fa-fw fa-repeat"></i>';static key="repeat";static name="REPEAT";static template="repeat-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},styleSelect:{sequence:"BATTLETRANSITIONS.SCENECONFIG.REPEAT.SEQUENCE.LABEL",previous:"BATTLETRANSITIONS.SCENECONFIG.REPEAT.PREVIOUS.LABEL"}})}static addEventListeners(e,n){let r=$(e);cs(r),r.find("#style").on("input",()=>{cs(r)}),r.find("[data-action='add-step']").on("click",i=>{i.preventDefault(),Bu(r)})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=ls(n);return new t({...t.DefaultSettings,...T(n,"id","iterations","style","delay"),id:foundry.utils.randomID(),sequence:r})}async execute(e,n){for(let r of this.#e){let i=r.execute(e,n);i instanceof Promise&&await i}}async prepare(e){let n={...t.DefaultSettings,...this.config};if(n.style==="sequence"&&!n.sequence?.length)throw new b(t.key);let r=e.sequence.findIndex(a=>a.id===n.id);if(r===-1)throw new b(t.key);let i=e.sequence[r-1];if(!i)throw new b(t.key);let o={...at.DefaultSettings,duration:n.delay},s=[];if(n.delay&&n.style==="previous"&&s.push(o),n.style==="previous")for(let a=0;a<n.iterations-1;a++)s.push({...i,id:foundry.utils.randomID()}),n.delay&&s.push(o);else n.style==="sequence"&&(s.push(...n.sequence??[]),n.delay&&s.push(o));this.#e=await R.prepareSequence({...e,sequence:s})}};async function Bu(t){let e=await J();if(!e)return;let n=w(e);if(!n)throw new b(e);let r=n.skipConfig?n.DefaultSettings:await k(n.DefaultSettings);r&&us(t,r)}function Wu(t,e,n){e.find("[data-action='remove']").on("click",()=>{let r=w(n.type);if(!r)throw new b(n.type);z(l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:l(`BATTLETRANSITIONS.${r.name}.NAME`)}),l("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:l(`BATTLETRANSITIONS.${r.name}.NAME`)})).then(i=>{i&&e.remove()}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})}),e.find("[data-action='configure']").on("click",()=>{k(n).then(r=>{if(r)return us(t,r)}).then(()=>{}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})})}function ls(t){let e=[];return t.find("#transition-step-list [data-transition-type]").each((n,r)=>{let i=r.dataset.flag??"";if(!i)return;let o=JSON.parse(i);e.push(o)}),e}function cs(t){let e=t.find("#style").val();t.find("[data-repeat-style='previous']").css("display",e==="previous"?"block":"none"),t.find("[data-repeat-style='sequence']").css("display",e==="sequence"?"block":"none"),t.find("#sequenceContainer").css("display",e==="sequence"?"block":"none")}async function us(t,e){let n=w(e.type);if(!n)throw new b(e.type);let r=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...n.DefaultSettings,...e,name:l(`BATTLETRANSITIONS.${n.name}.NAME`),description:l(`BATTLETRANSITIONS.${n.name}.DESCRIPTION`),type:n.key,flag:JSON.stringify({...n.DefaultSettings,...e})}),i=$(r),o=t.find(`[data-id="${e.id}"]`);o.length?o.replaceWith(i):t.find("#transition-step-list").append(i),Wu(t,i,e);let s=i.parents("[data-index]").data("index"),a=ls(t);t.find(`#sequence-list [data-index="${s}"]`).attr("data-sequence",JSON.stringify(a))}var Tr=class t extends m{static template="";static DefaultSettings={type:"restoreoverlay",version:"1.1.0"};static hidden=!1;static key="restoreoverlay";static name="RESTOREOVERLAY";static skipConfig=!0;static icon="<i class='bt-icon restore-overlay fa-fw fas'></i>";static category="technical";static RenderTemplate(e){throw new U}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,...T($(e),"id")})}execute(e,n){e.alpha=1}};var Y=class t extends m{static DefaultSettings={type:"scenechange",scene:"",version:"1.1.0"};static hidden=!0;static key="scenechange";static name="SCENECHANGE";static template="scenechange-config";static icon="<i class='bt-icon scene-change fa-fw fas'></i>";static category="technical";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=T($(e),"id","scene");return new t({...t.DefaultSettings,...n})}async execute(e,n){if(this.config.scene===canvas?.scene?.id)throw new bt;n.caller===game.user.id?await fs({...t.DefaultSettings,...this.config}.scene):await ve(K.SCENE_ACTIVATED),ps()}async validate(){return game.scenes.get(this.config.scene)instanceof Scene?Promise.resolve(!0):Promise.resolve(new D({...t.DefaultSettings,...this.config}.scene))}};var Sr=class t extends m{#e=null;static DefaultSettings={type:"sound",volume:100,file:"",version:"1.1.0"};static hidden=!1;static key="sound";static name="SOUND";static template="sound-config";static icon="<i class='bt-icon sound fa-fw fas'></i>";static category="technical";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#file").val()??"",i=n.find("#volume").val()??100;return new t({...t.DefaultSettings,file:r,volume:i,...T(n,"id")})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=await foundry.audio.AudioHelper.play({src:this.config.file,volume:r.volume/100,autoplay:!0},!0);this.#e=i}async prepare(){await foundry.audio.AudioHelper.preloadSound(this.config.file)}teardown(e){this.#e?.stop()}};var Er=class t extends m{static DefaultSettings={type:"spiralshutter",duration:1e3,direction:"clockwise",radial:"inside",easing:"none",bgSizingMode:"stretch",version:"1.1.0",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="spiralshutter";static name="SPIRALSHUTTER";static template="spiralshutter-config";static category="wipe";static icon="<i class='bt-icon spiral-shutter fa-fw fas'></i>";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),radialSelect:G(),directionSelect:pe()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,backgroundImage:r,...T(n,"id","duration","easing","backgroundType","backgroundColor","direction","radial")})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??E("transparent"),o=new Je(r.direction,r.radial,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var br=class t extends m{static DefaultSettings={type:"spiralwipe",duration:1e3,direction:"left",clockDirection:"clockwise",radial:"outside",easing:"none",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="spiralwipe";static name="SPIRALWIPE";static template="spiralwipe-config";static category="wipe";static icon='<i class="fas fa-fw fa-arrows-spin"></i>';static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),radialSelect:G(),directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"},clockDirectionSelect:pe()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,backgroundImage:r,...T(n,"id","duration","backgroundType","backgroundColor","radial","direction","clockDirection","easing")})}async execute(e){let n={...t.DefaultSettings,...this.config},r=n.deserializedTexture??E("transparent"),i=new Qe(n.clockDirection,n.radial,n.direction,r.baseTexture);this.addFilter(e,i),await this.simpleTween(i)}};var hr=class t extends m{defaultSettings={duration:1e3,easing:"none"};static DefaultSettings={type:"spotlightwipe",duration:1e3,easing:"none",direction:"top",radial:"outside",bgSizingMode:"stretch",version:"1.1.0",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="spotlightwipe";static name="SPOTLIGHTWIPE";static template="spotlightwipe-config";static icon="<i class='bt-icon spotlight-wipe fa-fw fas'></i>";static category="wipe";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L(),directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"},radialSelect:G()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,serializedTexture:r,...T(n,"id","duration","direction","radial","backgroundType","backgroundColor","easing")})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??E("transparent"),o=new Ue(r.direction,r.radial,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var Ce=class t extends m{static template="";static hidden=!1;static skipConfig=!0;static key="startplaylist";static name="STARTPLAYLIST";static icon="<i class='bt-icon start-ambient-playlist fa-fw fas'></i>";static category="technical";static DefaultSettings={type:"startplaylist",version:"1.1.0"};static RenderTemplate(e){throw new U}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,...T($(e),"id")})}async prepare(e){let n=e.sequence.filter(r=>r.type==="scenechange");for(let r of n){let i=r,o=game.scenes?.get(i.scene);if(!(o instanceof Scene))throw new D(typeof i.scene=="string"?i.scene:typeof i.scene);if(o.playlist)if(o.playlistSound){let s=typeof o.playlistSound=="string"?o.playlist.sounds.get(o.playlistSound):o.playlistSound;s&&await s.load()}else{let s=o.playlist.playbackOrder[0],a=o.playlist.sounds.get(s);a&&await a.load()}}}execute(e,n){R.SuppressSoundUpdates=!1;let r=n.sequence.reduce((o,s)=>s instanceof Y?s:o);if(!r)throw new D(typeof r);let i=game.scenes?.get(r.scene);if(!(i instanceof Scene))throw new D(r.scene);if(i.canUserModify(game.user,"update"))if(i.playlist&&!i.playlistSound)switch(i.playlist.mode){case CONST.PLAYLIST_MODES.SEQUENTIAL:case CONST.PLAYLIST_MODES.SHUFFLE:if(i.playlist.playbackOrder.length){let o=i.playlist.sounds.get(i.playlist.playbackOrder[0]);o&&i.playlist.playSound(o)}break;case CONST.PLAYLIST_MODES.SIMULTANEOUS:i.playlist.playAll();break}else i.playlist&&i.playlistSound instanceof PlaylistSound&&i.playlist.playSound(i.playlistSound)}};var Ir=class t extends m{defaultSettings={};static DefaultSettings={type:"textureswap",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="textureswap";static name="TEXTURESWAP";static template="textureswap-config";static icon="<i class='bt-icon texture-swap fa-fw fas'></i>";static category="effect";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,serializedTexture:r,...T(n,"id","backgroundType","backgroundColor")})}execute(e,n){let i={...t.DefaultSettings,...this.config}.deserializedTexture??E("transparent"),o=new se(i.baseTexture);this.addFilter(e,o)}};var yr=class t extends m{static DefaultSettings={type:"twist",version:"1.1.0",duration:1e3,maxAngle:10,easing:"none",direction:"clockwise"};static hidden=!1;static key="twist";static name="TWIST";static template="twist-config";static icon="<i class='bt-icon twist fa-fw fas'></i>";static category="warp";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},directionSelect:pe(),easingSelect:L()})}async execute(e){let n=new PIXI.filters.TwistFilter({radius:window.innerWidth,angle:0,offset:{x:window.innerWidth/2,y:window.innerHeight/2}});this.addFilter(e,n);let r={...t.DefaultSettings,...this.config};await TweenMax.to(n.uniforms,{angle:this.config.direction==="clockwise"?r.maxAngle*-1:this.config.maxAngle,duration:r.duration/1e3,ease:this.config.easing||"none"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e);return new t({...t.DefaultSettings,...T(n,"id","duration","direction","easing")})}};var wr=class t extends m{#e=null;#t=null;static DefaultSettings={type:"video",volume:100,clear:!1,file:"",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000",videoSizingMode:"stretch",version:"1.1.0"};static hidden=!1;static key="video";static name="VIDEO";static template="video-config";static icon="<i class='bt-icon video fa-fw fas'></i>";static category="effect";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#file").val()??"",r=$(e).find("#volume input[type='number']").val(),i=$(e).find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,...n?{file:n}:{},...r?{volume:r/100}:{},serializedTexture:i,...T($(e),"id","background","backgroundType","backgroundColor")})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.#e;if(!i)throw new ut(r.file);let o=this.config.deserializedTexture??E("transparent"),a=(i?.baseTexture.resource).source;return new Promise((c,u)=>{let S=new se(i.baseTexture),p=PIXI.Sprite.from(i),h=PIXI.Sprite.from(o),f=new PIXI.Container;f.addChild(h),h.width=window.innerWidth,h.height=window.innerHeight,f.addChild(p),p.width=window.innerWidth,p.height=window.innerHeight,p.filters=[S],a.currentTime=0,this.#t=f,e.parent.addChild(f),a.addEventListener("ended",()=>{r.clear&&setTimeout(()=>{p.destroy()},500),c()}),a.addEventListener("error",de=>{u(de.error)}),a.play()})}async prepare(){let e={...t.DefaultSettings,...this.config},n=await PIXI.loadVideo.load(e.file);this.#e=n}teardown(e){if(!this.#t)return;let n=[...this.#t.children];for(let r of n)r.destroy();this.#t.destroy()}};var Cr=class t extends m{static template="wavewipe-config";static DefaultSettings={type:"wavewipe",duration:1e3,easing:"none",direction:"inside",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static hidden=!1;static key="wavewipe";static name="WAVEWIPE";static icon="<i class='bt-icon wave-wipe fa-fw fas'></i>";static category="wipe";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,...e||{},radialSelect:G(),easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,serializedTexture:r,...T(n,"id","duration","backgroundType","backgroundColor","easing","direction")})}async execute(e,n){let r={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??E("transparent"),o=new ze(r.direction,i.baseTexture);this.addFilter(e,o),await this.simpleTween(o)}};var xr=class t extends m{static DefaultSettings={type:"zoomblur",version:"1.1.0",duration:1e3,maxStrength:.5,easing:"none",innerRadius:0};static hidden=!1;static key="zoomblur";static name="ZOOMBLUR";static template="zoomblur-config";static category="warp";static icon="<i class='bt-icon zoomblur fa-fw fas'></i>";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{id:foundry.utils.randomID(),...t.DefaultSettings,...e||{},easingSelect:L()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),r=n.find("#maxStrength input[type='number']").val()??1,i=n.find("#innerRadius input[type='number']").val()??0;return new t({...t.DefaultSettings,...T(n,"id","duration"),maxStrength:r,innerRadius:i})}async execute(e){let n={...t.DefaultSettings,...this.config},r=new PIXI.filters.ZoomBlurFilter({strength:0,innerRadius:n.innerRadius*window.innerWidth,radius:-1,center:[window.innerWidth/2,window.innerHeight/2]});this.addFilter(e,r),await TweenMax.to(r.uniforms,{uStrength:n.maxStrength,duration:n.duration/1e3,ease:n.easing||"none"})}};async function ve(t){return new Promise(e=>{Hooks.once(t,(...n)=>{e(n)})})}function E(t){let e=document.createElement("canvas");e.width=1,e.height=1;let n=e.getContext("2d");if(!n)throw new ie;let r=new PIXI.Color(t);return n.fillStyle=r.toHexa(),n.fillRect(0,0,1,1),PIXI.Texture.from(e)}function Ur(t,e,n){let r=document.createElement("canvas");r.width=t,r.height=1;let i=r.getContext("2d");if(!i)throw new ie;let o=i.createLinearGradient(0,0,t,0),s=e??new PIXI.Color("white"),a=n??new PIXI.Color("black");return o.addColorStop(0,s.toHex()),o.addColorStop(1,a.toHex()),i.fillStyle=o,i.fillRect(0,0,t,1),PIXI.Texture.from(r)}function Xr(t=256,e=256,n){let r=$r(n),i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new ie;i.width=t,i.height=e;let s=o.createImageData(i.width,i.height),a=s.data;for(let c=0;c<i.height;c++)for(let u=0;u<i.width;u++){let S=r(u/32,c/32),p=(c*i.width+u)*4;a[p]=S*255,a[p+1]=S*255,a[p+2]=S*255,a[p+3]=255}return o.putImageData(s,0,0),PIXI.Texture.from(i)}function ms(t){let e=atob(t.split(",")[1]),n=new Uint8Array(e.length);for(let r=0;r<n.length;r++)n[r]=e.charCodeAt(r);return n}function qu(t){let e=Hr(t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer):t.buffer);return PIXI.Texture.from(`data:${t.mimeType};base64,${e}`)}function dn(t){if(typeof t=="string")return v(t)??E("transparent");let e=t;if(e.buffer&&e.mimeType)return qu(e);let n=t;if(n.buffer&&n.width&&n.height)return Uu(n);throw new F}function Uu(t){return PIXI.Texture.fromBuffer(t.buffer,t.width,t.height)}function Xu(t){return typeof t=="number"?!0:typeof t=="string"?parseFloat(t).toString()===t:!1}function Lr(t,e){let n=t.find(({name:r})=>r===e);if(e==="background"){let r=t.find(({name:i})=>i==="backgroundType");return r?r.value==="image"?Lr(t,"backgroundImage"):Lr(t,"backgroundColor"):null}return n?e==="id"&&!n.value?foundry.utils.randomID():Xu(n.value)?parseFloat(n.value):n.value:null}function Yr(){return{horizontal:"BATTLETRANSITIONS.DIRECTIONS.HORIZONTAL",vertical:"BATTLETRANSITIONS.DIRECTIONS.VERTICAL",topleft:"BATTLETRANSITIONS.DIRECTIONS.TOPLEFT",topright:"BATTLETRANSITIONS.DIRECTIONS.TOPRIGHT"}}function pe(){return{clockwise:"BATTLETRANSITIONS.DIRECTIONS.CLOCKWISE",counterclockwise:"BATTLETRANSITIONS.DIRECTIONS.COUNTERCLOCKWISE"}}function L(){return{none:"BATTLETRANSITIONS.EASINGS.NONE",power1in:"BATTLETRANSITIONS.EASINGS.POWER1IN",power1out:"BATTLETRANSITIONS.EASINGS.POWER1OUT",power1inout:"BATTLETRANSITIONS.EASINGS.POWER1INOUT",power2in:"BATTLETRANSITIONS.EASINGS.POWER2IN",power2out:"BATTLETRANSITIONS.EASINGS.POWER2OUT",power2inout:"BATTLETRANSITIONS.EASINGS.POWER2INOUT",power3in:"BATTLETRANSITIONS.EASINGS.POWER3IN",power3out:"BATTLETRANSITIONS.EASINGS.POWER3OUT",power3inout:"BATTLETRANSITIONS.EASINGS.POWER3INOUT",power4in:"BATTLETRANSITIONS.EASINGS.POWER4IN",power4out:"BATTLETRANSITIONS.EASINGS.POWER4OUT",power4inout:"BATTLETRANSITIONS.EASINGS.POWER4INOUT",backin:"BATTLETRANSITIONS.EASINGS.BACKIN",backout:"BATTLETRANSITIONS.EASINGS.BACKOUT",backinout:"BATTLETRANSITIONS.EASINGS.BACKINOUT",bouncein:"BATTLETRANSITIONS.EASINGS.BOUNCEIN",bounceout:"BATTLETRANSITIONS.EASINGS.BOUNCEOUT",bounceinout:"BATTLETRANSITIONS.EASINGS.BOUNCEINOUT",circin:"BATTLETRANSITIONS.EASINGS.CIRCIN",circout:"BATTLETRANSITIONS.EASINGS.CIRCOUT",circinout:"BATTLETRANSITIONS.EASINGS.CIRCINOUT",elasticin:"BATTLETRANSITIONS.EASINGS.ELASTICIN",elasticout:"BATTLETRANSITIONS.EASINGS.ELASTICOUT",elasticinout:"BATTLETRANSITIONS.EASINGS.ELASTICINOUT",expoin:"BATTLETRANSITIONS.EASINGS.EXPOIN",expoout:"BATTLETRANSITIONS.EASINGS.EXPOOUT",expoinout:"BATTLETRANSITIONS.EASINGS.EXPOINOUT",sinein:"BATTLETRANSITIONS.EASINGS.SINEIN",sineout:"BATTLETRANSITIONS.EASINGS.SINEOUT",sineinout:"BATTLETRANSITIONS.EASINGS.SINEINOUT"}}function ti(){return{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM",topleft:"BATTLETRANSITIONS.DIRECTIONS.TOPLEFT",topright:"BATTLETRANSITIONS.DIRECTIONS.TOPRIGHT",bottomleft:"BATTLETRANSITIONS.DIRECTIONS.BOTTOMLEFT",bottomright:"BATTLETRANSITIONS.DIRECTIONS.BOTTOMRIGHT"}}function G(){return{inside:"BATTLETRANSITIONS.DIRECTIONS.INSIDE",outside:"BATTLETRANSITIONS.DIRECTIONS.OUTSIDE"}}function Zr(){return Object.fromEntries(FontConfig.getAvailableFonts().map(t=>[t,t]))}function Ct(){return Object.values(Tn).sort((t,e)=>l(`BATTLETRANSITIONS.TRANSITIONTYPES.${t.name}`).localeCompare(l(`BATTLETRANSITIONS.TRANSITIONTYPES.${e.name}`)))}function w(t){return Object.values(Tn).find(e=>e.key===t)}function l(t,e={}){return game.i18n?.format(t,e)??t}function ge(...t){console.log(Or,"Battle Transitions","|",...t)}function _u(t,e=256){let n=new Image;n.onload=function(){let r=["font-size: 1px",`padding: ${e}px`,`background: url(${t}) no-repeat`,"background-size:contain","border:1px solid black"].join(";");console.log("%c ",r)},n.src=t}function Kr(t,e=256){let n=PIXI.RenderTexture.create({width:t.width,height:t.height}),r=PIXI.Sprite.from(t);canvas?.app?.renderer.render(r,{renderTexture:n}),canvas?.app?.renderer.extract.base64(n).then(i=>{_u(i,e)}).catch(console.error)}function T(t,...e){let n=t.serializeArray();return Object.fromEntries(e.map(i=>[i,Lr(n,i)]))}function Vu(t){let e=ms(t.toDataURL());return{width:t.width,height:t.height,buffer:e}}function zu(t){let e=ms(t);return{mimeType:t.split(";")[0].split(":")[1],buffer:e}}function P(t){if(typeof t=="string"&&t.startsWith("data:"))return zu(t);if(typeof t=="string")return t;if(typeof t.src=="string")return t.src;if(typeof t.value<"u")return t.value;let n=t.baseTexture.resource;if(typeof n.data<"u")return{width:n.width,height:n.height,buffer:n.data};let r=n.source;if(r instanceof HTMLImageElement)return r.getAttribute("src");if(r instanceof HTMLCanvasElement)return Vu(r);throw console.error(t),new F}function Se(){return(game.release?.isNewer("12")??!1)&&!!foundry.applications.api.ApplicationV2}async function Te(t){return new Promise(e=>{setTimeout(e,t)})}function ce(t){return CSS.supports("color",t)}function q(t){return{backgroundType:t.background&&!ce(t.background)?"image":"color",backgroundColor:ce(t.background)?t.background:"",backgroundImage:!ce(t.background)&&t.background?t.background:"",bgSizingMode:"stretch"}}function ni(){return[...game.macros?.contents.slice()??[],...game.packs?.contents.reduce((t,e)=>e.documentName!=="Macro"?t:[...t,...e.index.contents],[])??[]]}function ei(){return[...game.actors?.contents.slice()??[],...game.packs?.contents.reduce((t,e)=>e.documentName!=="Actor"?t:[...t,...e.index.contents],[])??[]]}function we(t){let e=t.split(".");return e[0]!=="Compendium"?"":e[2]}var Z=document.createElement("div");Z.style.display="none";Z.style.position="absolute";Z.style.width="100%";Z.style.height="100%";Z.style.backgroundRepeat="no-repeat";Z.id=xn;document.body.appendChild(Z);var Sn=null;function ds(){Sn=new Fe,canvas?.stage?.addChild(Sn)}async function Gu(){if(!canvas)throw new ue;if(!(canvas.app&&canvas.hidden&&canvas.primary&&canvas.tiles&&canvas.drawings&&canvas.scene&&canvas.stage))throw new gt;let t=window.innerWidth,e=window.innerHeight,n=canvas.app.renderer,r=PIXI.RenderTexture.create({width:t,height:e});n.render(canvas.stage,{renderTexture:r,skipUpdateTransform:!0,clear:!0});let i=document.getElementById(xn);if(!i)throw new mt;i.style.backgroundImage="";let o=await n.extract.image(r),s=document.createElement("canvas"),a=s.getContext("2d");if(!a)throw new ie;s.width=o.width,s.height=o.height,a.fillStyle=n.background.backgroundColor.toHex(),a.fillRect(0,0,s.width,s.height),a.drawImage(o,0,0);let c=s.toDataURL();return i.style.backgroundImage=`url(${c})`,i.style.backgroundColor=n.background.backgroundColor.toHex(),i.style.display="block",new PIXI.Sprite(r)}async function is(){if(!Sn)throw new ie;let t=await Gu(),e=new PIXI.Container;e.width=window.innerWidth,e.height=window.innerHeight;let n=E(canvas?.app?.renderer.background.backgroundColor??"white"),r=new PIXI.Sprite(n);r.width=window.innerWidth,r.height=window.innerHeight,e.addChild(r),e.addChild(t);let i=new PIXI.Container;return i.width=window.innerWidth,i.height=window.innerHeight,i.addChild(e),Sn.addChild(i),e}function os(t){if(Z.style.display="none",Z.style.backgroundImage="",t){if(Array.isArray(t.children)&&t.children.length)for(let e=t.children.length-1;e>=0;e--)t.children[e].destroy();t.destroy()}}function ss(){let t=document.getElementById("loading");t&&(t.style.opacity="0")}function as(){let t=document.getElementById("loading");t&&t.style.removeProperty("opacity")}function ps(){Z.style.display="none",Z.style.removeProperty("backgroundImage")}async function fs(t){let e=It(t);if(!(e instanceof Scene))throw new D(typeof t=="string"?t:"[Object object]");return await e.setFlag("battle-transitions","isTriggered",!0),e.activate(),await ve("canvasReady"),e}function Ju(t,e){for(var n=e.split("."),r=n.pop();e=n.shift();)if(t=t[e],t==null)return;return t[r]}function gs(){return""}function vr(t){var e={group:function(n,r){r=r||{};var i=r.fn||gs,o=r.inverse||gs,s=r.hash,a=s&&s.by,c=[],u={};if(!a||!n||!n.length)return o(this);function S(h){var f=Ju(h,a);c.indexOf(f)===-1&&c.push(f),u[f]||(u[f]={value:f,items:[]}),u[f].items.push(h)}function p(h,f){return h+i(u[f])}return n.forEach(S),c.reduce(p,"")}};return t.registerHelper(e),t}vr.register=vr;var Ts=vr;function Ss(){Handlebars.registerHelper("switch",function(t,e){this._switch_value_=t;let n=e.fn(this);return delete this._switch_value_,n}),Handlebars.registerHelper("case",function(t,e){if(t==this._switch_value_)return e.fn(this)}),Ts.register(Handlebars)}async function Es(){return loadTemplates(["/modules/battle-transitions/templates/scene-config.hbs",...["add-step","fade-config","linearwipe-config","step-item","background-selector","duration-selector","add-step-button","sequence-item"].map(t=>`/modules/battle-transitions/templates/config/${t}.hbs`),"/modules/battle-transitions/templates/scene-selector.hbs","/modules/battle-transitions/templates/transition-steps.hbs","/modules/battle-transitions/templates/actor-selector.hbs"])}var bs=Dr(sr());var Ku={},ct;var Qu=new RegExp(`([^.[]+|\\[('([^'\\\\]|\\\\.)+?'|"([^"\\\\]|\\\\.)+?")\\])`,"g"),ju=new RegExp(`(^\\['|'\\]$|^\\["|"\\]$)`,"g");Hooks.once("init",()=>{if(globalThis.libWrapper&&!(globalThis.libWrapper.is_fallback??!0)){ct=globalThis.libWrapper;return}ct=class{static get is_fallback(){return!0}static get WRAPPER(){return"WRAPPER"}static get MIXED(){return"MIXED"}static get OVERRIDE(){return"OVERRIDE"}static get LISTENER(){return"LISTENER"}static register(t,e,n,r="MIXED",{chain:i=void 0,bind:o=[]}={}){let s=e.endsWith("#set");e=s?e.slice(0,-4):e;let a=e.match(Qu).map(M=>M.replace(/\\(.)/g,"$1").replace(ju,"")),c=a.splice(0,1)[0],u,S;if(a.length==0)u=globalThis,S=c;else{let M=eval;S=a.pop(),u=a.reduce((be,he)=>be[he],globalThis[c]??M(c))}let p=u,h=null;for(;p&&(h=Object.getOwnPropertyDescriptor(p,S),!h);)p=Object.getPrototypeOf(p);if(!h||h?.configurable===!1)throw new Error(`libWrapper Shim: '${e}' does not exist, could not be found, or has a non-configurable descriptor.`);let f=null,de=r==3||r.toUpperCase?.()=="OVERRIDE"||r==3,ee=r==4||r.toUpperCase?.()=="LISTENER"||r==4?function(...M){return n.call(this,...o,...M),f.call(this,...M)}:i??!de?function(...M){return n.call(this,f.bind(this),...o,...M)}:function(...M){return n.call(this,...o,...M)};if(!s)h.value?(f=h.value,h.value=ee):(f=h.get,h.get=ee);else{if(!h.set)throw new Error(`libWrapper Shim: '${e}' does not have a setter`);f=h.set,h.set=ee}h.configurable=!0,Object.defineProperty(u,S,h)}};{let[t,e]=(()=>{let n=(Ku?.url??Error().stack)?.match(/\/(worlds|systems|modules)\/(.+)(?=\/)/i);if(n?.length!==3)return[null,null];let r=n[2].split("/");if(n[1]==="worlds")return r.find(s=>s&&game.world.id===s)?[game.world.id,game.world.title]:[null,null];if(n[1]==="systems")return r.find(s=>s&&game.system.id===s)?[game.system.id,game.system.title??game.system.data.title]:[null,null];let i=r.find(s=>s&&game.modules.has(s)),o=game.modules.get(i);return[i,o?.title??o?.data?.title]})();if(!t||!e){console.error("libWrapper Shim: Could not auto-detect package ID and/or title. The libWrapper fallback warning dialog will be disabled.");return}Hooks.once("ready",()=>{let n=e,r=`
				<p><b>'${e}' depends on the 'libWrapper' module, which is not present.</b></p>
				<p>A fallback implementation will be used, which increases the chance of compatibility issues with other modules.</p>
				<small><p>'libWrapper' is a library which provides package developers with a simple way to modify core Foundry VTT code, while reducing the likelihood of conflict with other packages.</p>
				<p>You can install it from the "Add-on Modules" tab in the <a href="javascript:game.shutDown()">Foundry VTT Setup</a>, from the <a href="https://foundryvtt.com/packages/lib-wrapper">Foundry VTT package repository</a>, or from <a href="https://github.com/ruipin/fvtt-lib-wrapper/">libWrapper's Github page</a>.</p></small>
			`,i="libwrapper-dont-remind-again";console.warn(`${e}: libWrapper not present, using fallback implementation.`),game.settings.register(t,i,{name:"",default:!1,type:Boolean,scope:"world",config:!1}),game.user.isGM&&!game.settings.get(t,i)&&new Dialog({title:n,content:r,buttons:{ok:{icon:'<i class="fas fa-check"></i>',label:"Understood"},dont_remind:{icon:'<i class="fas fa-times"></i>',label:"Don't remind me again",callback:()=>game.settings.set(t,i,!0)}}}).render(!0)})}});window.semver=bs.default;window.BattleTransition=R;Hooks.once("canvasReady",()=>{ds(),Hooks.callAll(K.INITIALIZE)});Hooks.once("init",async()=>{Ss(),await Es(),typeof ct=="function"&&ct.register("battle-transitions","Scene.prototype.update",function(t,...e){let n=e[0],r=re.GetSceneConfiguration(this);if(n.active&&r.autoTrigger&&r.sequence?.length&&!this.flags["battle-transitions"].isTriggered){delete n.active;let i=new Y({scene:this.id??""});if(R.executeSequence([{id:foundry.utils.randomID(),...Y.DefaultSettings,...i.config},...r.sequence]),Object.keys(n).length===0)return!1}return t(n)},"MIXED")});Hooks.on("renderSceneConfig",(t,e,n)=>{re.InjectSceneConfig(t,e,n)});Hooks.once("socketlib.ready",()=>{Ye.register(socketlib.registerModule("battle-transitions"))});Hooks.on("getSceneNavigationContext",(t,e)=>{re.AddToNavigationBar(e)});Hooks.on("preUpdatePlaylist",(t,e)=>{if(e.playing&&R.SuppressSoundUpdates)return!1});Hooks.on("preUpdatePlaylistSound",(t,e)=>{if(e.playing&&R.SuppressSoundUpdates)return!1});Hooks.on(K.TRANSITION_START,(...t)=>{ge("Transition start:",t)});Hooks.on(K.TRANSITION_END,(...t)=>{ge("Transition end:",t)});Hooks.on("updateScene",(t,e,n,r)=>{e.active&&(t.canUserModify(game.user,"update")&&t.unsetFlag("battle-transitions","isTriggered"),ve("canvasReady").then(()=>{Hooks.callAll(K.SCENE_ACTIVATED,t)}).catch(console.error))});})();
