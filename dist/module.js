"use strict";(()=>{var Bs=Object.create;var pi=Object.defineProperty;var Ws=Object.getOwnPropertyDescriptor;var qs=Object.getOwnPropertyNames;var Xs=Object.getPrototypeOf,Gs=Object.prototype.hasOwnProperty;var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Us=(t,e)=>{for(var n in e)pi(t,n,{get:e[n],enumerable:!0})},zs=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of qs(e))!Gs.call(t,r)&&r!==n&&pi(t,r,{get:()=>e[r],enumerable:!(i=Ws(e,r))||i.enumerable});return t};var xr=(t,e,n)=>(n=t!=null?Bs(Xs(t)):{},zs(e||!t||!t.__esModule?pi(n,"default",{value:t,enumerable:!0}):n,t));var xt=C((Eh,yo)=>{var Ll="2.0.0",Nl=Number.MAX_SAFE_INTEGER||9007199254740991,Ol=16,Dl=250,Al=["major","premajor","minor","preminor","patch","prepatch","prerelease"];yo.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Ol,MAX_SAFE_BUILD_LENGTH:Dl,MAX_SAFE_INTEGER:Nl,RELEASE_TYPES:Al,SEMVER_SPEC_VERSION:Ll,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Lt=C((hh,wo)=>{var Rl=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};wo.exports=Rl});var st=C((ye,Co)=>{var{MAX_SAFE_COMPONENT_LENGTH:ki,MAX_SAFE_BUILD_LENGTH:kl,MAX_LENGTH:Fl}=xt(),Pl=Lt();ye=Co.exports={};var Ml=ye.re=[],Hl=ye.safeRe=[],S=ye.src=[],b=ye.t={},$l=0,Fi="[a-zA-Z0-9-]",Bl=[["\\s",1],["\\d",Fl],[Fi,kl]],Wl=t=>{for(let[e,n]of Bl)t=t.split(`${e}*`).join(`${e}{0,${n}}`).split(`${e}+`).join(`${e}{1,${n}}`);return t},v=(t,e,n)=>{let i=Wl(e),r=$l++;Pl(t,r,e),b[t]=r,S[r]=e,Ml[r]=new RegExp(e,n?"g":void 0),Hl[r]=new RegExp(i,n?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","\\d+");v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Fi}*`);v("MAINVERSION",`(${S[b.NUMERICIDENTIFIER]})\\.(${S[b.NUMERICIDENTIFIER]})\\.(${S[b.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${S[b.NUMERICIDENTIFIERLOOSE]})\\.(${S[b.NUMERICIDENTIFIERLOOSE]})\\.(${S[b.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${S[b.NUMERICIDENTIFIER]}|${S[b.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${S[b.NUMERICIDENTIFIERLOOSE]}|${S[b.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${S[b.PRERELEASEIDENTIFIER]}(?:\\.${S[b.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${S[b.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${S[b.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER",`${Fi}+`);v("BUILD",`(?:\\+(${S[b.BUILDIDENTIFIER]}(?:\\.${S[b.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${S[b.MAINVERSION]}${S[b.PRERELEASE]}?${S[b.BUILD]}?`);v("FULL",`^${S[b.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${S[b.MAINVERSIONLOOSE]}${S[b.PRERELEASELOOSE]}?${S[b.BUILD]}?`);v("LOOSE",`^${S[b.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${S[b.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${S[b.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${S[b.XRANGEIDENTIFIER]})(?:\\.(${S[b.XRANGEIDENTIFIER]})(?:\\.(${S[b.XRANGEIDENTIFIER]})(?:${S[b.PRERELEASE]})?${S[b.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${S[b.XRANGEIDENTIFIERLOOSE]})(?:\\.(${S[b.XRANGEIDENTIFIERLOOSE]})(?:\\.(${S[b.XRANGEIDENTIFIERLOOSE]})(?:${S[b.PRERELEASELOOSE]})?${S[b.BUILD]}?)?)?`);v("XRANGE",`^${S[b.GTLT]}\\s*${S[b.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${S[b.GTLT]}\\s*${S[b.XRANGEPLAINLOOSE]}$`);v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${ki}})(?:\\.(\\d{1,${ki}}))?(?:\\.(\\d{1,${ki}}))?`);v("COERCE",`${S[b.COERCEPLAIN]}(?:$|[^\\d])`);v("COERCEFULL",S[b.COERCEPLAIN]+`(?:${S[b.PRERELEASE]})?(?:${S[b.BUILD]})?(?:$|[^\\d])`);v("COERCERTL",S[b.COERCE],!0);v("COERCERTLFULL",S[b.COERCEFULL],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${S[b.LONETILDE]}\\s+`,!0);ye.tildeTrimReplace="$1~";v("TILDE",`^${S[b.LONETILDE]}${S[b.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${S[b.LONETILDE]}${S[b.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${S[b.LONECARET]}\\s+`,!0);ye.caretTrimReplace="$1^";v("CARET",`^${S[b.LONECARET]}${S[b.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${S[b.LONECARET]}${S[b.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${S[b.GTLT]}\\s*(${S[b.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${S[b.GTLT]}\\s*(${S[b.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${S[b.GTLT]}\\s*(${S[b.LOOSEPLAIN]}|${S[b.XRANGEPLAIN]})`,!0);ye.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${S[b.XRANGEPLAIN]})\\s+-\\s+(${S[b.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${S[b.XRANGEPLAINLOOSE]})\\s+-\\s+(${S[b.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var fn=C((Ih,vo)=>{var ql=Object.freeze({loose:!0}),Xl=Object.freeze({}),Gl=t=>t?typeof t!="object"?ql:t:Xl;vo.exports=Gl});var Pi=C((yh,No)=>{var xo=/^[0-9]+$/,Lo=(t,e)=>{let n=xo.test(t),i=xo.test(e);return n&&i&&(t=+t,e=+e),t===e?0:n&&!i?-1:i&&!n?1:t<e?-1:1},Ul=(t,e)=>Lo(e,t);No.exports={compareIdentifiers:Lo,rcompareIdentifiers:Ul}});var j=C((wh,Ro)=>{var mn=Lt(),{MAX_LENGTH:Oo,MAX_SAFE_INTEGER:dn}=xt(),{safeRe:Do,t:Ao}=st(),zl=fn(),{compareIdentifiers:ct}=Pi(),Mi=class t{constructor(e,n){if(n=zl(n),e instanceof t){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Oo)throw new TypeError(`version is longer than ${Oo} characters`);mn("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;let i=e.trim().match(n.loose?Do[Ao.LOOSE]:Do[Ao.FULL]);if(!i)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>dn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>dn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>dn||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){let o=+r;if(o>=0&&o<dn)return o}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(mn("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),ct(this.major,e.major)||ct(this.minor,e.minor)||ct(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{let i=this.prerelease[n],r=e.prerelease[n];if(mn("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return ct(i,r)}while(++n)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let n=0;do{let i=this.build[n],r=e.build[n];if(mn("build compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return ct(i,r)}while(++n)}inc(e,n,i){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,i),this.inc("pre",n,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,i),this.inc("pre",n,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let r=Number(i)?1:0;if(!n&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[r];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(n===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(n){let o=[n,r];i===!1&&(o=[n]),ct(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Ro.exports=Mi});var _e=C((Ch,Fo)=>{var ko=j(),Vl=(t,e,n=!1)=>{if(t instanceof ko)return t;try{return new ko(t,e)}catch(i){if(!n)return null;throw i}};Fo.exports=Vl});var Mo=C((vh,Po)=>{var Jl=_e(),Ql=(t,e)=>{let n=Jl(t,e);return n?n.version:null};Po.exports=Ql});var $o=C((xh,Ho)=>{var _l=_e(),jl=(t,e)=>{let n=_l(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};Ho.exports=jl});var qo=C((Lh,Wo)=>{var Bo=j(),Yl=(t,e,n,i,r)=>{typeof n=="string"&&(r=i,i=n,n=void 0);try{return new Bo(t instanceof Bo?t.version:t,n).inc(e,i,r).version}catch{return null}};Wo.exports=Yl});var Uo=C((Nh,Go)=>{var Xo=_e(),Kl=(t,e)=>{let n=Xo(t,null,!0),i=Xo(e,null,!0),r=n.compare(i);if(r===0)return null;let o=r>0,a=o?n:i,s=o?i:n,c=!!a.prerelease.length;if(!!s.prerelease.length&&!c)return!s.patch&&!s.minor?"major":a.patch?"patch":a.minor?"minor":"major";let p=c?"pre":"";return n.major!==i.major?p+"major":n.minor!==i.minor?p+"minor":n.patch!==i.patch?p+"patch":"prerelease"};Go.exports=Kl});var Vo=C((Oh,zo)=>{var Zl=j(),eu=(t,e)=>new Zl(t,e).major;zo.exports=eu});var Qo=C((Dh,Jo)=>{var tu=j(),nu=(t,e)=>new tu(t,e).minor;Jo.exports=nu});var jo=C((Ah,_o)=>{var iu=j(),ru=(t,e)=>new iu(t,e).patch;_o.exports=ru});var Ko=C((Rh,Yo)=>{var ou=_e(),au=(t,e)=>{let n=ou(t,e);return n&&n.prerelease.length?n.prerelease:null};Yo.exports=au});var le=C((kh,ea)=>{var Zo=j(),su=(t,e,n)=>new Zo(t,n).compare(new Zo(e,n));ea.exports=su});var na=C((Fh,ta)=>{var cu=le(),lu=(t,e,n)=>cu(e,t,n);ta.exports=lu});var ra=C((Ph,ia)=>{var uu=le(),pu=(t,e)=>uu(t,e,!0);ia.exports=pu});var gn=C((Mh,aa)=>{var oa=j(),fu=(t,e,n)=>{let i=new oa(t,n),r=new oa(e,n);return i.compare(r)||i.compareBuild(r)};aa.exports=fu});var ca=C((Hh,sa)=>{var mu=gn(),du=(t,e)=>t.sort((n,i)=>mu(n,i,e));sa.exports=du});var ua=C(($h,la)=>{var gu=gn(),Tu=(t,e)=>t.sort((n,i)=>gu(i,n,e));la.exports=Tu});var Nt=C((Bh,pa)=>{var Su=le(),bu=(t,e,n)=>Su(t,e,n)>0;pa.exports=bu});var Tn=C((Wh,fa)=>{var Eu=le(),hu=(t,e,n)=>Eu(t,e,n)<0;fa.exports=hu});var Hi=C((qh,ma)=>{var Iu=le(),yu=(t,e,n)=>Iu(t,e,n)===0;ma.exports=yu});var $i=C((Xh,da)=>{var wu=le(),Cu=(t,e,n)=>wu(t,e,n)!==0;da.exports=Cu});var Sn=C((Gh,ga)=>{var vu=le(),xu=(t,e,n)=>vu(t,e,n)>=0;ga.exports=xu});var bn=C((Uh,Ta)=>{var Lu=le(),Nu=(t,e,n)=>Lu(t,e,n)<=0;Ta.exports=Nu});var Bi=C((zh,Sa)=>{var Ou=Hi(),Du=$i(),Au=Nt(),Ru=Sn(),ku=Tn(),Fu=bn(),Pu=(t,e,n,i)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return Ou(t,n,i);case"!=":return Du(t,n,i);case">":return Au(t,n,i);case">=":return Ru(t,n,i);case"<":return ku(t,n,i);case"<=":return Fu(t,n,i);default:throw new TypeError(`Invalid operator: ${e}`)}};Sa.exports=Pu});var Ea=C((Vh,ba)=>{var Mu=j(),Hu=_e(),{safeRe:En,t:hn}=st(),$u=(t,e)=>{if(t instanceof Mu)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let n=null;if(!e.rtl)n=t.match(e.includePrerelease?En[hn.COERCEFULL]:En[hn.COERCE]);else{let c=e.includePrerelease?En[hn.COERCERTLFULL]:En[hn.COERCERTL],l;for(;(l=c.exec(t))&&(!n||n.index+n[0].length!==t.length);)(!n||l.index+l[0].length!==n.index+n[0].length)&&(n=l),c.lastIndex=l.index+l[1].length+l[2].length;c.lastIndex=-1}if(n===null)return null;let i=n[2],r=n[3]||"0",o=n[4]||"0",a=e.includePrerelease&&n[5]?`-${n[5]}`:"",s=e.includePrerelease&&n[6]?`+${n[6]}`:"";return Hu(`${i}.${r}.${o}${a}${s}`,e)};ba.exports=$u});var Ia=C((Jh,ha)=>{var Wi=class{constructor(){this.max=1e3,this.map=new Map}get(e){let n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){let r=this.map.keys().next().value;this.delete(r)}this.map.set(e,n)}return this}};ha.exports=Wi});var ue=C((Qh,va)=>{var Bu=/\s+/g,qi=class t{constructor(e,n){if(n=qu(n),e instanceof t)return e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease?e:new t(e.raw,n);if(e instanceof Xi)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=e.trim().replace(Bu," "),this.set=this.raw.split("||").map(i=>this.parseRange(i.trim())).filter(i=>i.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let i=this.set[0];if(this.set=this.set.filter(r=>!wa(r[0])),this.set.length===0)this.set=[i];else if(this.set.length>1){for(let r of this.set)if(r.length===1&&Qu(r[0])){this.set=[r];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let n=this.set[e];for(let i=0;i<n.length;i++)i>0&&(this.formatted+=" "),this.formatted+=n[i].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let i=((this.options.includePrerelease&&Vu)|(this.options.loose&&Ju))+":"+e,r=ya.get(i);if(r)return r;let o=this.options.loose,a=o?ie[Z.HYPHENRANGELOOSE]:ie[Z.HYPHENRANGE];e=e.replace(a,rp(this.options.includePrerelease)),A("hyphen replace",e),e=e.replace(ie[Z.COMPARATORTRIM],Gu),A("comparator trim",e),e=e.replace(ie[Z.TILDETRIM],Uu),A("tilde trim",e),e=e.replace(ie[Z.CARETTRIM],zu),A("caret trim",e);let s=e.split(" ").map(f=>_u(f,this.options)).join(" ").split(/\s+/).map(f=>ip(f,this.options));o&&(s=s.filter(f=>(A("loose invalid filter",f,this.options),!!f.match(ie[Z.COMPARATORLOOSE])))),A("range list",s);let c=new Map,l=s.map(f=>new Xi(f,this.options));for(let f of l){if(wa(f))return[f];c.set(f.value,f)}c.size>1&&c.has("")&&c.delete("");let p=[...c.values()];return ya.set(i,p),p}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(i=>Ca(i,n)&&e.set.some(r=>Ca(r,n)&&i.every(o=>r.every(a=>o.intersects(a,n)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Xu(e,this.options)}catch{return!1}for(let n=0;n<this.set.length;n++)if(op(this.set[n],e,this.options))return!0;return!1}};va.exports=qi;var Wu=Ia(),ya=new Wu,qu=fn(),Xi=Ot(),A=Lt(),Xu=j(),{safeRe:ie,t:Z,comparatorTrimReplace:Gu,tildeTrimReplace:Uu,caretTrimReplace:zu}=st(),{FLAG_INCLUDE_PRERELEASE:Vu,FLAG_LOOSE:Ju}=xt(),wa=t=>t.value==="<0.0.0-0",Qu=t=>t.value==="",Ca=(t,e)=>{let n=!0,i=t.slice(),r=i.pop();for(;n&&i.length;)n=i.every(o=>r.intersects(o,e)),r=i.pop();return n},_u=(t,e)=>(A("comp",t,e),t=Ku(t,e),A("caret",t),t=ju(t,e),A("tildes",t),t=ep(t,e),A("xrange",t),t=np(t,e),A("stars",t),t),ee=t=>!t||t.toLowerCase()==="x"||t==="*",ju=(t,e)=>t.trim().split(/\s+/).map(n=>Yu(n,e)).join(" "),Yu=(t,e)=>{let n=e.loose?ie[Z.TILDELOOSE]:ie[Z.TILDE];return t.replace(n,(i,r,o,a,s)=>{A("tilde",t,i,r,o,a,s);let c;return ee(r)?c="":ee(o)?c=`>=${r}.0.0 <${+r+1}.0.0-0`:ee(a)?c=`>=${r}.${o}.0 <${r}.${+o+1}.0-0`:s?(A("replaceTilde pr",s),c=`>=${r}.${o}.${a}-${s} <${r}.${+o+1}.0-0`):c=`>=${r}.${o}.${a} <${r}.${+o+1}.0-0`,A("tilde return",c),c})},Ku=(t,e)=>t.trim().split(/\s+/).map(n=>Zu(n,e)).join(" "),Zu=(t,e)=>{A("caret",t,e);let n=e.loose?ie[Z.CARETLOOSE]:ie[Z.CARET],i=e.includePrerelease?"-0":"";return t.replace(n,(r,o,a,s,c)=>{A("caret",t,r,o,a,s,c);let l;return ee(o)?l="":ee(a)?l=`>=${o}.0.0${i} <${+o+1}.0.0-0`:ee(s)?o==="0"?l=`>=${o}.${a}.0${i} <${o}.${+a+1}.0-0`:l=`>=${o}.${a}.0${i} <${+o+1}.0.0-0`:c?(A("replaceCaret pr",c),o==="0"?a==="0"?l=`>=${o}.${a}.${s}-${c} <${o}.${a}.${+s+1}-0`:l=`>=${o}.${a}.${s}-${c} <${o}.${+a+1}.0-0`:l=`>=${o}.${a}.${s}-${c} <${+o+1}.0.0-0`):(A("no pr"),o==="0"?a==="0"?l=`>=${o}.${a}.${s}${i} <${o}.${a}.${+s+1}-0`:l=`>=${o}.${a}.${s}${i} <${o}.${+a+1}.0-0`:l=`>=${o}.${a}.${s} <${+o+1}.0.0-0`),A("caret return",l),l})},ep=(t,e)=>(A("replaceXRanges",t,e),t.split(/\s+/).map(n=>tp(n,e)).join(" ")),tp=(t,e)=>{t=t.trim();let n=e.loose?ie[Z.XRANGELOOSE]:ie[Z.XRANGE];return t.replace(n,(i,r,o,a,s,c)=>{A("xRange",t,i,r,o,a,s,c);let l=ee(o),p=l||ee(a),f=p||ee(s),y=f;return r==="="&&y&&(r=""),c=e.includePrerelease?"-0":"",l?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&y?(p&&(a=0),s=0,r===">"?(r=">=",p?(o=+o+1,a=0,s=0):(a=+a+1,s=0)):r==="<="&&(r="<",p?o=+o+1:a=+a+1),r==="<"&&(c="-0"),i=`${r+o}.${a}.${s}${c}`):p?i=`>=${o}.0.0${c} <${+o+1}.0.0-0`:f&&(i=`>=${o}.${a}.0${c} <${o}.${+a+1}.0-0`),A("xRange return",i),i})},np=(t,e)=>(A("replaceStars",t,e),t.trim().replace(ie[Z.STAR],"")),ip=(t,e)=>(A("replaceGTE0",t,e),t.trim().replace(ie[e.includePrerelease?Z.GTE0PRE:Z.GTE0],"")),rp=t=>(e,n,i,r,o,a,s,c,l,p,f,y)=>(ee(i)?n="":ee(r)?n=`>=${i}.0.0${t?"-0":""}`:ee(o)?n=`>=${i}.${r}.0${t?"-0":""}`:a?n=`>=${n}`:n=`>=${n}${t?"-0":""}`,ee(l)?c="":ee(p)?c=`<${+l+1}.0.0-0`:ee(f)?c=`<${l}.${+p+1}.0-0`:y?c=`<=${l}.${p}.${f}-${y}`:t?c=`<${l}.${p}.${+f+1}-0`:c=`<=${c}`,`${n} ${c}`.trim()),op=(t,e,n)=>{for(let i=0;i<t.length;i++)if(!t[i].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let i=0;i<t.length;i++)if(A(t[i].semver),t[i].semver!==Xi.ANY&&t[i].semver.prerelease.length>0){let r=t[i].semver;if(r.major===e.major&&r.minor===e.minor&&r.patch===e.patch)return!0}return!1}return!0}});var Ot=C((_h,Aa)=>{var Dt=Symbol("SemVer ANY"),zi=class t{static get ANY(){return Dt}constructor(e,n){if(n=xa(n),e instanceof t){if(e.loose===!!n.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ui("comparator",e,n),this.options=n,this.loose=!!n.loose,this.parse(e),this.semver===Dt?this.value="":this.value=this.operator+this.semver.version,Ui("comp",this)}parse(e){let n=this.options.loose?La[Na.COMPARATORLOOSE]:La[Na.COMPARATOR],i=e.match(n);if(!i)throw new TypeError(`Invalid comparator: ${e}`);this.operator=i[1]!==void 0?i[1]:"",this.operator==="="&&(this.operator=""),i[2]?this.semver=new Oa(i[2],this.options.loose):this.semver=Dt}toString(){return this.value}test(e){if(Ui("Comparator.test",e,this.options.loose),this.semver===Dt||e===Dt)return!0;if(typeof e=="string")try{e=new Oa(e,this.options)}catch{return!1}return Gi(e,this.operator,this.semver,this.options)}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Da(e.value,n).test(this.value):e.operator===""?e.value===""?!0:new Da(this.value,n).test(e.semver):(n=xa(n),n.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!n.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Gi(this.semver,"<",e.semver,n)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Gi(this.semver,">",e.semver,n)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Aa.exports=zi;var xa=fn(),{safeRe:La,t:Na}=st(),Gi=Bi(),Ui=Lt(),Oa=j(),Da=ue()});var At=C((jh,Ra)=>{var ap=ue(),sp=(t,e,n)=>{try{e=new ap(e,n)}catch{return!1}return e.test(t)};Ra.exports=sp});var Fa=C((Yh,ka)=>{var cp=ue(),lp=(t,e)=>new cp(t,e).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));ka.exports=lp});var Ma=C((Kh,Pa)=>{var up=j(),pp=ue(),fp=(t,e,n)=>{let i=null,r=null,o=null;try{o=new pp(e,n)}catch{return null}return t.forEach(a=>{o.test(a)&&(!i||r.compare(a)===-1)&&(i=a,r=new up(i,n))}),i};Pa.exports=fp});var $a=C((Zh,Ha)=>{var mp=j(),dp=ue(),gp=(t,e,n)=>{let i=null,r=null,o=null;try{o=new dp(e,n)}catch{return null}return t.forEach(a=>{o.test(a)&&(!i||r.compare(a)===1)&&(i=a,r=new mp(i,n))}),i};Ha.exports=gp});var qa=C((eI,Wa)=>{var Vi=j(),Tp=ue(),Ba=Nt(),Sp=(t,e)=>{t=new Tp(t,e);let n=new Vi("0.0.0");if(t.test(n)||(n=new Vi("0.0.0-0"),t.test(n)))return n;n=null;for(let i=0;i<t.set.length;++i){let r=t.set[i],o=null;r.forEach(a=>{let s=new Vi(a.semver.version);switch(a.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!o||Ba(s,o))&&(o=s);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),o&&(!n||Ba(n,o))&&(n=o)}return n&&t.test(n)?n:null};Wa.exports=Sp});var Ga=C((tI,Xa)=>{var bp=ue(),Ep=(t,e)=>{try{return new bp(t,e).range||"*"}catch{return null}};Xa.exports=Ep});var In=C((nI,Ja)=>{var hp=j(),Va=Ot(),{ANY:Ip}=Va,yp=ue(),wp=At(),Ua=Nt(),za=Tn(),Cp=bn(),vp=Sn(),xp=(t,e,n,i)=>{t=new hp(t,i),e=new yp(e,i);let r,o,a,s,c;switch(n){case">":r=Ua,o=Cp,a=za,s=">",c=">=";break;case"<":r=za,o=vp,a=Ua,s="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(wp(t,e,i))return!1;for(let l=0;l<e.set.length;++l){let p=e.set[l],f=null,y=null;if(p.forEach(g=>{g.semver===Ip&&(g=new Va(">=0.0.0")),f=f||g,y=y||g,r(g.semver,f.semver,i)?f=g:a(g.semver,y.semver,i)&&(y=g)}),f.operator===s||f.operator===c||(!y.operator||y.operator===s)&&o(t,y.semver))return!1;if(y.operator===c&&a(t,y.semver))return!1}return!0};Ja.exports=xp});var _a=C((iI,Qa)=>{var Lp=In(),Np=(t,e,n)=>Lp(t,e,">",n);Qa.exports=Np});var Ya=C((rI,ja)=>{var Op=In(),Dp=(t,e,n)=>Op(t,e,"<",n);ja.exports=Dp});var es=C((oI,Za)=>{var Ka=ue(),Ap=(t,e,n)=>(t=new Ka(t,n),e=new Ka(e,n),t.intersects(e,n));Za.exports=Ap});var ns=C((aI,ts)=>{var Rp=At(),kp=le();ts.exports=(t,e,n)=>{let i=[],r=null,o=null,a=t.sort((p,f)=>kp(p,f,n));for(let p of a)Rp(p,e,n)?(o=p,r||(r=p)):(o&&i.push([r,o]),o=null,r=null);r&&i.push([r,null]);let s=[];for(let[p,f]of i)p===f?s.push(p):!f&&p===a[0]?s.push("*"):f?p===a[0]?s.push(`<=${f}`):s.push(`${p} - ${f}`):s.push(`>=${p}`);let c=s.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return c.length<l.length?c:e}});var cs=C((sI,ss)=>{var is=ue(),Qi=Ot(),{ANY:Ji}=Qi,Rt=At(),_i=le(),Fp=(t,e,n={})=>{if(t===e)return!0;t=new is(t,n),e=new is(e,n);let i=!1;e:for(let r of t.set){for(let o of e.set){let a=Mp(r,o,n);if(i=i||a!==null,a)continue e}if(i)return!1}return!0},Pp=[new Qi(">=0.0.0-0")],rs=[new Qi(">=0.0.0")],Mp=(t,e,n)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Ji){if(e.length===1&&e[0].semver===Ji)return!0;n.includePrerelease?t=Pp:t=rs}if(e.length===1&&e[0].semver===Ji){if(n.includePrerelease)return!0;e=rs}let i=new Set,r,o;for(let g of t)g.operator===">"||g.operator===">="?r=os(r,g,n):g.operator==="<"||g.operator==="<="?o=as(o,g,n):i.add(g.semver);if(i.size>1)return null;let a;if(r&&o){if(a=_i(r.semver,o.semver,n),a>0)return null;if(a===0&&(r.operator!==">="||o.operator!=="<="))return null}for(let g of i){if(r&&!Rt(g,String(r),n)||o&&!Rt(g,String(o),n))return null;for(let De of e)if(!Rt(g,String(De),n))return!1;return!0}let s,c,l,p,f=o&&!n.includePrerelease&&o.semver.prerelease.length?o.semver:!1,y=r&&!n.includePrerelease&&r.semver.prerelease.length?r.semver:!1;f&&f.prerelease.length===1&&o.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let g of e){if(p=p||g.operator===">"||g.operator===">=",l=l||g.operator==="<"||g.operator==="<=",r){if(y&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===y.major&&g.semver.minor===y.minor&&g.semver.patch===y.patch&&(y=!1),g.operator===">"||g.operator===">="){if(s=os(r,g,n),s===g&&s!==r)return!1}else if(r.operator===">="&&!Rt(r.semver,String(g),n))return!1}if(o){if(f&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===f.major&&g.semver.minor===f.minor&&g.semver.patch===f.patch&&(f=!1),g.operator==="<"||g.operator==="<="){if(c=as(o,g,n),c===g&&c!==o)return!1}else if(o.operator==="<="&&!Rt(o.semver,String(g),n))return!1}if(!g.operator&&(o||r)&&a!==0)return!1}return!(r&&l&&!o&&a!==0||o&&p&&!r&&a!==0||y||f)},os=(t,e,n)=>{if(!t)return e;let i=_i(t.semver,e.semver,n);return i>0?t:i<0||e.operator===">"&&t.operator===">="?e:t},as=(t,e,n)=>{if(!t)return e;let i=_i(t.semver,e.semver,n);return i<0?t:i>0||e.operator==="<"&&t.operator==="<="?e:t};ss.exports=Fp});var Yi=C((cI,ps)=>{var ji=st(),ls=xt(),Hp=j(),us=Pi(),$p=_e(),Bp=Mo(),Wp=$o(),qp=qo(),Xp=Uo(),Gp=Vo(),Up=Qo(),zp=jo(),Vp=Ko(),Jp=le(),Qp=na(),_p=ra(),jp=gn(),Yp=ca(),Kp=ua(),Zp=Nt(),ef=Tn(),tf=Hi(),nf=$i(),rf=Sn(),of=bn(),af=Bi(),sf=Ea(),cf=Ot(),lf=ue(),uf=At(),pf=Fa(),ff=Ma(),mf=$a(),df=qa(),gf=Ga(),Tf=In(),Sf=_a(),bf=Ya(),Ef=es(),hf=ns(),If=cs();ps.exports={parse:$p,valid:Bp,clean:Wp,inc:qp,diff:Xp,major:Gp,minor:Up,patch:zp,prerelease:Vp,compare:Jp,rcompare:Qp,compareLoose:_p,compareBuild:jp,sort:Yp,rsort:Kp,gt:Zp,lt:ef,eq:tf,neq:nf,gte:rf,lte:of,cmp:af,coerce:sf,Comparator:cf,Range:lf,satisfies:uf,toComparators:pf,maxSatisfying:ff,minSatisfying:mf,minVersion:df,validRange:gf,outside:Tf,gtr:Sf,ltr:bf,intersects:Ef,simplifyRange:hf,subset:If,SemVer:Hp,re:ji.re,src:ji.src,tokens:ji.t,SEMVER_SPEC_VERSION:ls.SEMVER_SPEC_VERSION,RELEASE_TYPES:ls.RELEASE_TYPES,compareIdentifiers:us.compareIdentifiers,rcompareIdentifiers:us.rcompareIdentifiers}});var fi="transition-cover",Lr="BATTLETRANSITIONS",Nr="\u2694\uFE0F",pe={INITIALIZE:"battle-transitions.init",TRANSITION_START:"battle-transitions.transitionStart",TRANSITION_END:"battle-transitions.transitionEnd",SCENE_ACTIVATED:"battle-transitions.sceneActivated"},Wt={};var gt=class extends PIXI.Container{setInverseMatrix(){canvas?.app?.stage&&this.transform.setFromMatrix(canvas.app.stage.localTransform.clone().invert())}constructor(){super(),this.interactiveChildren=!1,this.interactive=!1,this.eventMode="none",canvas?.app&&canvas.app.renderer.addListener("prerender",()=>{this.setInverseMatrix()})}};var E=class extends Error{constructor(e,n){e?super(game.i18n?.format(`${Lr}.ERRORS.${e}`,n)):super()}};var he=class extends E{constructor(){super("CANNOTINITIALIZECANVAS")}};var K=class extends E{constructor(){super("CANVASNOTFOUND")}};var qt=class extends E{constructor(e){super("FILENOTFOUND",{file:e})}};var re=class extends E{constructor(e){super("INVALIDDIRECTION",{direction:e})}};var Tt=class extends E{constructor(){super("INVALIDIMPORT")}};var Ke=class extends E{constructor(e){super("INVALIDMACRO",{macro:e})}};var St=class extends E{constructor(e){super("INVALIDOBJECT",{object:typeof e})}};var bt=class extends E{constructor(e){super("INVALIDROLLTABLE",{table:typeof e=="string"?e:typeof e})}};var O=class extends E{constructor(e){super("INVALIDSCENE",{name:e})}};var Xt=class extends E{constructor(e){super("INVALIDSOUND",{sound:e})}};var D=class extends E{constructor(e){super("INVALIDTARGET",{item:typeof e=="string"?e:typeof e})}};var H=class extends E{constructor(){super("INVALIDTEXTURE")}};var Et=class extends E{constructor(e){super("INVALIDTIPLOCATION",{location:typeof e=="string"?e:typeof e})}};var T=class extends E{constructor(e){super("INVALIDTRANSITION",{name:e})}};var Gt=class extends E{constructor(e){super("INVALIDVERSION",{version:e})}};var ht=class extends E{constructor(e){super("NEWERVERSION",{version:e})}};var Ut=class extends E{constructor(){super("NOCOVERELEMENT")}};var It=class extends E{constructor(){super("NOFILE")}};var Ze=class extends E{constructor(){super("NOPREVIOUSSTEP")}};var te=class extends E{constructor(){super("NOTIMPLEMENTED")}};var zt=class extends E{constructor(){super("NOTINITIALIZED")}};var Vt=class extends E{constructor(){super("EXECUTECALLEDPARALLEL")}};var Jt=class extends E{constructor(){super("PERMISSIONDENIED")}};var Qt=class extends E{constructor(){super("EXECUTECALLEDREPEAT")}};var _t=class extends E{constructor(){super("SEQUENCETIMEDOUT")}};var et=class extends E{constructor(e){super("STEPNOTREVERSIBLE",{type:e})}};var jt=class extends E{constructor(){super("TRANSITIONTOSELF")}};var tt=class extends E{constructor(e,n){super("UNABLETOMIGRATE",{old:e,current:n})}};function Vs(t){try{return new PIXI.Color(t)}catch{}}function L(t){let e=Vs(t);if(e)return h(e);try{return PIXI.Texture.from(t)}catch{}}function Yt(t){if(game instanceof Game&&game.scenes){if(typeof t=="string"){let e=game.scenes.get(t);if(e||(e=game.scenes.getName(t),e))return e}else if(t instanceof Scene)return t}}function Or(t){if(t instanceof Macro)return t;if(game.macros&&typeof t=="string"){let e=game.macros?.get(t);if(e||(e=game.macros?.getName(t),e))return e;if(t.split(".")[0]==="Macro")return game.macros?.get(t.split(".").slice(1).join("."))}}var Rr=Math.sqrt(3),kr=Math.sqrt(5),Js=.5*(Rr-1),yt=(3-Rr)/6,Dg=1/3,Ag=1/6,Rg=(kr-1)/4,kg=(5-kr)/20,Dr=t=>Math.floor(t)|0,Ar=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Fr(t=Math.random){let e=Qs(t),n=new Float64Array(e).map(r=>Ar[r%12*2]),i=new Float64Array(e).map(r=>Ar[r%12*2+1]);return function(o,a){let s=0,c=0,l=0,p=(o+a)*Js,f=Dr(o+p),y=Dr(a+p),g=(f+y)*yt,De=f-g,vr=y-g,de=o-De,G=a-vr,je,Ye;de>G?(je=1,Ye=0):(je=0,Ye=1);let ri=de-je+yt,oi=G-Ye+yt,ai=de-1+2*yt,si=G-1+2*yt,ci=f&255,li=y&255,ut=.5-de*de-G*G;if(ut>=0){let Ce=ci+e[li],mt=n[Ce],dt=i[Ce];ut*=ut,s=ut*ut*(mt*de+dt*G)}let pt=.5-ri*ri-oi*oi;if(pt>=0){let Ce=ci+je+e[li+Ye],mt=n[Ce],dt=i[Ce];pt*=pt,c=pt*pt*(mt*ri+dt*oi)}let ft=.5-ai*ai-si*si;if(ft>=0){let Ce=ci+1+e[li+1],mt=n[Ce],dt=i[Ce];ft*=ft,l=ft*ft*(mt*ai+dt*si)}return 70*(s+c+l)}}function Qs(t){let n=new Uint8Array(512);for(let i=0;i<512/2;i++)n[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(t()*(256-i)),o=n[i];n[i]=n[r],n[r]=o}for(let i=256;i<512;i++)n[i]=n[i-256];return n}var Ie=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function Pr(t){let e="",n,i=t.length;for(n=2;n<i;n+=3)e+=Ie[t[n-2]>>2],e+=Ie[(t[n-2]&3)<<4|t[n-1]>>4],e+=Ie[(t[n-1]&15)<<2|t[n]>>6],e+=Ie[t[n]&63];return n===i+1&&(e+=Ie[t[n-2]>>2],e+=Ie[(t[n-2]&3)<<4],e+="=="),n===i&&(e+=Ie[t[n-2]>>2],e+=Ie[(t[n-2]&3)<<4|t[n-1]>>4],e+=Ie[(t[n-1]&15)<<2],e+="="),e}var ni={};Us(ni,{AngularWipeStep:()=>mi,BarWipeStep:()=>di,BilinearWipeStep:()=>gi,BossSplashStep:()=>Ti,ClearEffectsStep:()=>Si,ClockWipeStep:()=>bi,DiamondWipeStep:()=>Ei,FadeStep:()=>hi,FireDissolveStep:()=>Ii,FlashStep:()=>yi,HueShiftStep:()=>wi,InvertStep:()=>Ci,LinearWipeStep:()=>vi,LoadingTipStep:()=>Li,MacroStep:()=>Ni,MeltStep:()=>Oi,ParallelStep:()=>Ft,PixelateStep:()=>rr,RadialWipeStep:()=>or,RemoveOverlayStep:()=>ar,RepeatStep:()=>$t,RestoreOverlayStep:()=>cr,ReverseStep:()=>fr,SceneChangeStep:()=>fe,SoundStep:()=>mr,SpiralShutterStep:()=>dr,SpiralWipeStep:()=>gr,SpotlightWipeStep:()=>Tr,StartPlaylistStep:()=>at,TextureSwapStep:()=>Sr,TransitionStep:()=>m,TwistStep:()=>br,VideoStep:()=>Er,WaitStep:()=>Ht,WaveWipeStep:()=>hr,ZoomBlurStep:()=>Ir,ZoomStep:()=>yr});var m=class{constructor(e){this.config=e;e.id||(this.config.id=foundry.utils.randomID())}static DefaultSettings={id:"",type:"UNKNOWN",version:"1.1.0"};static hidden=!0;static key="unknown";static name="UNNAMED";static skipConfig=!1;static template="";static icon="";static category="";static reversible=!1;reverse(){throw new te}static async RenderTemplate(e,n,i){throw new te}static Upgrade(e){throw new te}static from(e){throw new te}static validate(e,n){return e}static validateForm(e){return!0}static addEventListeners(e,n){}static editDialogClosed(e){}prepare(e){}serialize(){return this.config}teardown(e){}addFilter(e,n){Array.isArray(e.filters)?e.filters.push(n):e.filters=[n]}getConfigTemplateParams(){return{...this.config}}removeFilter(e,n){let i=e.filters?.indexOf(n)??-1;i!==-1&&e.filters?.splice(i,1)}async simpleReverse(e){await TweenMax.to(e.uniforms,{progress:0,duration:this.config.duration/1e3,ease:this.config.easing||"none"})}async simpleTween(e){await TweenMax.to(e.uniforms,{progress:1,duration:this.config.duration/1e3,ease:this.config.easing||"none"})}static getDuration(e,n){return 0}};var Mr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

void main() {
    color = texture(uSampler, vTextureCoord);
}`;var Hr=`#version 300 es

in vec2 aVertexPosition;

uniform mat3 projectionMatrix;

out vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition(void) {
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord(void) {
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void) {
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var R=class extends PIXI.Filter{constructor(e,n,i){super(e||Hr,n||Mr,i),this.program.fragmentSrc.includes("#version 300 es")||(this.program.fragmentSrc=this.#e(300,this.program.fragmentSrc)),this.program.vertexSrc.includes("#version 300 es")||(this.program.vertexSrc=this.#e(300,this.program.vertexSrc))}#e(e,n){let i=n.split(`
`),r=i.findIndex(o=>o.startsWith("#version"));if(r!==-1){let o=i.splice(r,1);i.unshift(...o)}else i.unshift("#version 300 es");return i.join(`
`)}};var $r=`#version 300 es

precision highp float;

in vec2 vTextureCoord;
out vec4 color;

uniform sampler2D uSampler;
uniform sampler2D noise_texture;
uniform sampler2D burn_texture;

uniform float progress;
uniform float burn_size;

float inverse_lerp(float a, float b, float v) {
    return (v - a) / (b - a);
}

void main() {
    float integrity = 1.0 - progress;
    float noise = texture(noise_texture, vTextureCoord).r * vTextureCoord.y;
    vec4 base_color = texture(uSampler, vTextureCoord) * step(noise, integrity);
    vec2 burn_uv = vec2(inverse_lerp(integrity, integrity * burn_size, noise), 0.0);
    vec4 burn_color = texture(burn_texture, burn_uv) * step(noise, integrity * burn_size);

    color = mix(burn_color, base_color, base_color.a);
}`;var Ks=Br(1024,new PIXI.Color("#ff0400"),new PIXI.Color("#ffff01")),Ae=class extends R{constructor(e=1.3){let i={noise_texture:Wr(),progress:0,burn_size:e,burn_texture:Ks};super(void 0,$r,i)}};var qr=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform float size;
uniform vec2 screen_size;
uniform sampler2D bgSampler;

void main() {
    vec2 screenCoord = screen_size * vTextureCoord;
    
    float x = abs(fract(screenCoord.x / size) - 0.5);
    float y = abs(fract(screenCoord.y / size) - 0.5);
    
    if (x + y + vTextureCoord.x > progress * 2.0) {
        color = texture(uSampler, vTextureCoord);
    } else {
        color = texture(bgSampler, vTextureCoord);
    }
}`;var Re=class extends R{constructor(e,n="transparent"){let i=L(n)??h("transparent");super(void 0,qr,{progress:0,size:e,bgSampler:i,screen_size:{x:window.innerWidth,y:window.innerHeight}})}};var Xr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform sampler2D wipeSampler;
uniform sampler2D bgSampler;

void main() {
    vec4 wipe = texture(wipeSampler, vTextureCoord);

    if (wipe.b <= progress) {
        color = texture(bgSampler, vTextureCoord);
    } else {
        color = texture(uSampler, vTextureCoord);
    }
}`;var tc=h(new PIXI.Color("#00000000")),k=class extends R{constructor(e,n){let i={progress:0,wipeSampler:e,bgSampler:n??tc};super(void 0,Xr,i)}};var Gr=`#version 300 es
precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform sampler2D bgColor;

void main() {
    color = mix(texture(uSampler, vTextureCoord), texture(bgColor, vTextureCoord), progress);
}`;var ke=class extends R{constructor(e="transparent"){let n=L(e)??h("transparent");super(void 0,Gr,{bgColor:n,progress:0})}};function ic(){return B(window.innerWidth,1,0,0,window.innerWidth,0,[{point:0,color:"white"},{point:.5,color:"black"},{point:1,color:"white"}])}function rc(){return B(window.innerWidth,1,0,0,window.innerWidth,0,[{point:0,color:"black"},{point:.5,color:"white"},{point:1,color:"black"}])}function Ur(){return B(window.innerWidth,window.innerHeight,0,0,window.innerWidth,window.innerHeight,[{point:0,color:"white"},{point:.5,color:"black"},{point:1,color:"white"}])}function zr(){return B(window.innerWidth,window.innerHeight,window.innerWidth,0,0,window.innerHeight,[{point:0,color:"white"},{point:.5,color:"black"},{point:1,color:"white"}])}function Vr(){return B(window.innerWidth,window.innerHeight,0,0,window.innerWidth,window.innerHeight,[{point:0,color:"black"},{point:.5,color:"white"},{point:1,color:"black"}])}function Jr(){return B(window.innerWidth,window.innerHeight,window.innerWidth,0,0,window.innerHeight,[{point:0,color:"black"},{point:.5,color:"white"},{point:1,color:"black"}])}function oc(){return B(1,window.innerHeight,0,0,0,window.innerHeight,[{point:0,color:"white"},{point:.5,color:"black"},{point:1,color:"white"}])}function ac(){return B(1,window.innerHeight,0,0,0,window.innerHeight,[{point:0,color:"black"},{point:.5,color:"white"},{point:1,color:"black"}])}function sc(t,e){if(t==="horizontal"&&e==="inside")return ic();if(t==="horizontal"&&e==="outside")return rc();if(t==="vertical"&&e==="inside")return oc();if(t==="vertical"&&e==="outside")return ac();if(t==="topleft"&&e==="inside")return Ur();if(t==="topleft"&&e==="outside")return Vr();if(t==="topright"&&e==="inside")return zr();if(t==="topright"&&e==="outside")return Jr();if(t==="bottomleft"&&e==="inside")return zr();if(t==="bottomleft"&&e==="outside")return Jr();if(t==="bottomright"&&e==="inside")return Ur();if(t==="bottomright"&&e==="outside")return Vr();throw new re(`${t}-${e}`)}var Fe=class extends k{constructor(e,n,i){let r=L(i)??h("transparent"),o=sc(e,n);if(!o)throw new re(`${e}-${n}`);super(o,r)}};function cc(){return B(window.innerWidth,1,0,0,window.innerWidth,0,[{point:0,color:"black"},{point:1,color:"white"}])}function lc(){return B(window.innerWidth,1,0,0,window.innerWidth,0,[{point:0,color:"white"},{point:1,color:"black"}])}function uc(){return B(1,window.innerHeight,0,0,0,window.innerHeight,[{point:0,color:"white"},{point:1,color:"black"}])}function pc(){return B(1,window.innerHeight,0,0,0,window.innerHeight,[{point:0,color:"black"},{point:1,color:"white"}])}function fc(){return B(window.innerWidth,window.innerHeight,0,0,window.innerWidth,window.innerHeight,[{point:0,color:"white"},{point:1,color:"black"}])}function mc(){return B(window.innerWidth,window.innerHeight,window.innerWidth,0,0,window.innerHeight,[{point:0,color:"white"},{point:1,color:"black"}])}function dc(){return B(window.innerWidth,window.innerHeight,window.innerWidth,0,0,window.innerHeight,[{point:0,color:"black"},{point:1,color:"white"}])}function gc(){return B(window.innerWidth,window.innerHeight,0,0,window.innerWidth,window.innerHeight,[{point:0,color:"black"},{point:1,color:"white"}])}function Tc(t){if(t==="left")return cc();if(t==="right")return lc();if(t==="top")return uc();if(t==="bottom")return pc();if(t==="topleft")return gc();if(t==="topright")return dc();if(t==="bottomleft")return mc();if(t==="bottomright")return fc();throw new re(t)}var Pe=class extends k{constructor(e,n){let i=L(n)??h("transparent"),r=Tc(e);super(r,i)}};function ve(t,e){let n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new K;n.width=window.innerWidth,n.height=window.innerHeight;let r=i.createConicGradient(t,n.width/2,n.height/2);return r.addColorStop(0,e==="clockwise"?"black":"white"),r.addColorStop(1,e==="clockwise"?"white":"black"),i.fillStyle=r,i.fillRect(0,0,n.width,n.height),PIXI.Texture.from(n)}function Sc(t,e){let n=window.innerWidth/2,i=window.innerHeight/2;switch(t){case"right":return ve(0,e);case"left":return ve(Math.PI,e);case"top":return ve(Math.PI*2*.75,e);case"bottom":return ve(Math.PI*.5,e);case"topleft":return ve(ne(n,i,0,0),e);case"topright":return ve(ne(n,i,window.innerWidth,0),e);case"bottomleft":return ve(ne(n,i,0,window.innerHeight),e);case"bottomright":return ve(ne(n,i,window.innerWidth,window.innerHeight),e)}}var Me=class extends k{constructor(e,n,i){let r=L(i)??h("transparent"),o=Sc(n,e);super(o,r)}};function bc(){return U(window.innerWidth,window.innerHeight,0,window.innerWidth/2,0,[{point:0,color:"black"},{point:.25,color:"white"},{point:.5,color:"black"}])}function Ec(){return U(window.innerWidth,window.innerHeight,0,window.innerWidth/2,0,[{point:0,color:"white"},{point:.25,color:"black"},{point:.5,color:"white"}])}function hc(){return U(window.innerWidth,window.innerHeight,Math.PI,window.innerWidth/2,window.innerHeight,[{point:0,color:"white"},{point:.25,color:"black"},{point:.5,color:"white"}])}function Ic(){return U(window.innerWidth,window.innerHeight,Math.PI,window.innerWidth/2,window.innerHeight,[{point:0,color:"black"},{point:.25,color:"white"},{point:.5,color:"black"}])}function yc(){return U(window.innerWidth,window.innerHeight,Math.PI*2*.75,0,window.innerHeight/2,[{point:0,color:"white"},{point:.25,color:"black"},{point:.5,color:"white"}])}function wc(){return U(window.innerWidth,window.innerHeight,Math.PI*2*.75,0,window.innerHeight/2,[{point:0,color:"black"},{point:.25,color:"white"},{point:.5,color:"black"}])}function Cc(){return U(window.innerWidth,window.innerHeight,Math.PI*.5,window.innerWidth,window.innerHeight/2,[{point:0,color:"white"},{point:.25,color:"black"},{point:.5,color:"white"}])}function vc(){return U(window.innerWidth,window.innerHeight,Math.PI*.5,window.innerWidth,window.innerHeight/2,[{point:0,color:"black"},{point:.25,color:"white"},{point:.5,color:"black"}])}function xc(){return U(window.innerWidth,window.innerHeight,ne(0,0,window.innerWidth,window.innerHeight),0,0,[{point:0,color:"white"},{point:.25,color:"black"},{point:.85,color:"black"},{point:1,color:"white"}])}function Lc(){let t=ne(0,0,window.innerWidth,window.innerHeight);return U(window.innerWidth,window.innerHeight,0,0,0,[{point:0,color:"white"},{point:t/(Math.PI*2),color:"black"},{point:.25,color:"white"}])}function Nc(){let t=ne(window.innerWidth,0,0,window.innerHeight);return U(window.innerWidth,window.innerHeight,0,window.innerWidth,0,[{point:.25,color:"white"},{point:t/(2*Math.PI),color:"black"},{point:.5,color:"white"}])}function Oc(){let t=ne(window.innerWidth,0,0,window.innerHeight);return U(window.innerWidth,window.innerHeight,0,window.innerWidth,0,[{point:.25,color:"black"},{point:t/(2*Math.PI),color:"white"},{point:.5,color:"black"}])}function Dc(){let t=ne(0,window.innerHeight,window.innerWidth,0);return U(window.innerWidth,window.innerHeight,0,0,window.innerHeight,[{point:.75,color:"black"},{point:1-Math.abs(t)/(2*Math.PI),color:"white"},{point:1,color:"black"}])}function Ac(){let t=ne(0,window.innerHeight,window.innerWidth,0);return U(window.innerWidth,window.innerHeight,0,0,window.innerHeight,[{point:.75,color:"white"},{point:1-Math.abs(t)/(2*Math.PI),color:"black"},{point:1,color:"white"}])}function Rc(){let t=ne(window.innerWidth,window.innerHeight,0,0);return U(window.innerWidth,window.innerHeight,0,window.innerWidth,window.innerHeight,[{point:.5,color:"black"},{point:1-Math.abs(t)/(2*Math.PI),color:"white"},{point:.75,color:"black"}])}function kc(){let t=ne(window.innerWidth,window.innerHeight,0,0);return U(window.innerWidth,window.innerHeight,0,window.innerWidth,window.innerHeight,[{point:.5,color:"white"},{point:1-Math.abs(t)/(2*Math.PI),color:"black"},{point:.75,color:"white"}])}var Fc={topinside:Ec,topoutside:bc,rightinside:Cc,rightoutside:vc,bottominside:Ic,bottomoutside:hc,leftinside:yc,leftoutside:wc,topleftinside:Lc,topleftoutside:xc,toprightinside:Nc,toprightoutside:Oc,bottomleftinside:Ac,bottomleftoutside:Dc,bottomrightinside:kc,bottomrightoutside:Rc};function Pc(t,e){let n=Fc[`${t}${e}`];if(!n)throw new re(`${t}-${e}`);return n()}var He=class extends k{constructor(e,n,i="transparent"){let r=L(i)??h("transparent"),o=Pc(e,n);super(o,r)}};function Mc(t,e){let n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new K;n.width=window.innerWidth,n.height=window.innerHeight;let r=i.createRadialGradient(t,e,0,t,e,Math.max(n.width,n.height));return r.addColorStop(0,"black"),r.addColorStop(1,"white"),i.fillStyle=r,i.fillRect(0,0,n.width,n.height),PIXI.Texture.from(n)}function Hc(t,e){let n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new K;n.width=window.innerWidth,n.height=window.innerHeight;let r=i.createRadialGradient(t,e,0,t,e,Math.max(n.width,n.height));return r.addColorStop(0,"white"),r.addColorStop(1,"black"),i.fillStyle=r,i.fillRect(0,0,n.width,n.height),PIXI.Texture.from(n)}var $e=class extends k{constructor(e,n,i,r){let o=L(r)??h("transparent"),a=e==="inside"?Mc(window.innerWidth*n,window.innerHeight*i):Hc(window.innerWidth*n,window.innerHeight*i);super(a,o)}};var Qr=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform vec4 chromaKey;
uniform vec2 maskRange;
uniform sampler2D bgSampler;
uniform vec2 iResolution;

mat4 RGBtoYUV = mat4(0.257,  0.439, -0.148, 0.0,
                     0.504, -0.368, -0.291, 0.0,
                     0.098, -0.071,  0.439, 0.0,
                     0.0625, 0.500,  0.500, 1.0 );


//compute color distance in the UV (CbCr, PbPr) plane
float colorClose(vec3 yuv, vec3 keyYuv, vec2 tol)
{
    float tmp = sqrt(pow(keyYuv.g - yuv.g, 2.0) + pow(keyYuv.b - yuv.b, 2.0));
    if (tmp < tol.x)
      return 0.0;
   	else if (tmp < tol.y)
      return (tmp - tol.x)/(tol.y - tol.x);
   	else
      return 1.0;
}

void main() {
  vec2 fragPos = vTextureCoord.xy / iResolution.xy;
  vec4 texColor0 = texture(uSampler, fragPos);
  vec4 texColor1 = texture(bgSampler, fragPos);

  vec4 keyYUV = RGBtoYUV * chromaKey;
  vec4 yuv = RGBtoYUV * texColor0;

  float mask = 1.0 - colorClose(yuv.rgb, keyYUV.rgb, maskRange);
  color = max(texColor0 - mask * chromaKey, 0.0) + texColor1 * mask;
}

// precision highp float;

// uniform sampler2D uSampler;
// in vec2 vTextureCoord;
// out vec4 color;

// uniform vec4 keyRGBA;
// uniform vec2 keyCC;
// uniform vec2 range;
// uniform vec2 iResolution;
// uniform sampler2D bgSampler;

// vec2 RGBToCC(vec4 rgba) {
//     float Y = 0.299 * rgba.r + 0.587 * rgba.g + 0.114 * rgba.b;
//     return vec2((rgba.b - Y) * 0.565, (rgba.r - Y) * 0.713);
// }

// void main() {
//     vec4 src1Color = texture(uSampler, vTextureCoord);
//     vec2 CC = RGBToCC(src1Color);
//     float mask = sqrt(pow(keyCC.x - CC.x, 2.0) + pow(keyCC.y - CC.y, 2.0));
//     mask = smoothstep(range.x, range.y, mask);
//     if (mask == 0.0) {
//         color = texture(bgSampler, vTextureCoord);
//     }
//     else if (mask == 1.0) {
//         color = src1Color;
//     }
//     else {
//         color = max(src1Color - (1.0 - mask) * keyRGBA, 0.0);
//     }
// }
`;var Kt=class extends R{constructor(e=[.05,.63,.14,1],n="transparent"){let i=new PIXI.Color(e),r=L(n)??h("transparent"),o={chromaKey:[i.red,i.green,i.blue,1],bgSampler:r,maskRange:[.005,.26],iResolution:[1,1]};super(void 0,Qr,o)}};var _r=`precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform sampler2D uTexture;

void main() {
    color = texture(uTexture, vTextureCoord);
}`;var oe=class extends R{constructor(e){let n=L(e);if(!n)throw new H;super(void 0,_r,{uTexture:n})}};var jr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float progress;
uniform float[512] offsets;
uniform sampler2D uBackground;

void main() {
    vec2 tex_uv = vTextureCoord;

    float index = tex_uv.x * float(offsets.length());
    tex_uv.y -= progress * offsets[int(index)];

    // float index = tex_uv.x * float(offsets.length());
    // tex_uv.y -= progress * offsets[int(index)];

    color = texture(uSampler, tex_uv);
    if (tex_uv.y < 0.0 || tex_uv.y > 1.0) color = texture(uBackground, vTextureCoord); // texture(uBackground, vTextureCoord);
}
`;var Be=class extends R{constructor(e){let n=L(e);if(!(n instanceof PIXI.Texture))throw new H;super(void 0,jr,{progress:0,offsets:new Array(512).fill(0).map(()=>Math.random()+1),uBackground:n})}};var We=class extends k{constructor(e){let n=L(e);if(!(n instanceof PIXI.Texture))throw new H;let i=PIXI.Texture.from("/modules/battle-transitions/assets/wipes/angular.webp");super(i,n)}};var qe=class extends k{constructor(e,n){let i=L(n);if(!(i instanceof PIXI.Texture))throw new H;let r=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/wave-${e==="inside"?"inside":"outside"}.webp`);super(r,i)}};var Yr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

void main() {
    color = 1.0 - texture(uSampler, vTextureCoord);
    color.a = 1.0;
}`;var Xe=class extends R{constructor(){super(void 0,Yr,{})}};var Xc={clockwise:{inside:"spiral-radial-clockwise-inside",outside:"spiral-radial-clockwise-outside"},counterclockwise:{inside:"spiral-radial-counterclockwise-inside",outside:"spiral-radial-counterclockwise-outside"}},Ge=class extends k{constructor(e,n,i){let r=L(i);if(!(r instanceof PIXI.Texture))throw new H;let o=Xc[e]?.[n];if(!o)throw new re(`${e}-${n}`);let a=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/${o}.webp`);super(a,r)}};var Ue=class extends k{constructor(e,n,i,r){let o=L(r);if(!(o instanceof PIXI.Texture))throw new H;let a=PIXI.Texture.from(`/modules/battle-transitions/assets/wipes/spiral-linear-${e}-${i}-${n}.webp`);if(!(a instanceof PIXI.Texture))throw new H;super(a,o)}};var Kr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform float shift;

void main() {
    vec4 texture_color = texture(uSampler, vTextureCoord);
    vec3 input_color = texture_color.rgb;

    vec3 color_hsv; {
        vec3 c = input_color;
        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
        vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
        float d = q.x - min(q.w, q.y);
        float e = 1.0e-10;
        color_hsv=vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
    }

    color_hsv.x = mod((color_hsv.x + shift), 1.0f);

    vec3 color_rgb; {
        vec3 c = color_hsv;
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        color_rgb=c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }

    color = vec4(color_rgb.rgb, texture_color.a);
}`;var ze=class extends R{constructor(e){super(void 0,Kr,{shift:e})}};function Uc(t){let e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new K;e.width=window.innerWidth,e.height=window.innerHeight;let i=n.createLinearGradient(0,0,e.width,0),r=n.createLinearGradient(0,0,e.width,0);i.addColorStop(0,"black"),i.addColorStop(1,"white"),r.addColorStop(0,"white"),r.addColorStop(1,"black");let o=e.height/t;for(let a=0;a<t;a++)n.fillStyle=a%2===0?i:r,n.fillRect(0,o*a,e.width,o+o*a);return PIXI.Texture.from(e)}function zc(t){let e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new K;e.width=window.innerWidth,e.height=window.innerHeight;let i=n.createLinearGradient(0,0,0,e.height),r=n.createLinearGradient(0,0,0,e.height);i.addColorStop(0,"black"),i.addColorStop(1,"white"),r.addColorStop(0,"white"),r.addColorStop(1,"black");let o=e.width/t;for(let a=0;a<t;a++)n.fillStyle=a%2===0?i:r,n.fillRect(o*a,0,o+o*a,e.height);return PIXI.Texture.from(e)}var Ve=class extends k{constructor(e,n,i){let r=L(i)??h("transparent");if(!(e==="horizontal"||e==="vertical"))throw new re(e);let o=e==="horizontal"?Uc(n):zc(n);super(o,r)}};var Zr=`#version 300 es

precision highp float;

uniform sampler2D uSampler;
in vec2 vTextureCoord;
out vec4 color;

uniform vec2 center;
uniform float amount;

uniform bool clampBounds;
uniform sampler2D bgSampler;

void main() {
    // color = texture(uSampler, vTextureCoord);

    vec2 zoomed_uv = (vTextureCoord - center) * amount + center;
    // Clamp to boundaries
    if (clampBounds) {
        zoomed_uv = clamp(zoomed_uv, vec2(0.0), vec2(1.0));
    }

    if (zoomed_uv.x < 0.0 || zoomed_uv.x > 1.0 || zoomed_uv.y < 0.0 || zoomed_uv.y > 1.0) {
        color = texture(bgSampler, zoomed_uv);
    } else {
        // vec2 tex_uv = vec2(zoomed_uv.x, 1.0 - zoomed_uv.y)
        color = texture(uSampler, zoomed_uv);
    }
}`;var Je=class extends R{constructor(e,n=0,i=!1,r="transparent"){let o=L(r)??h("transparent");super(void 0,Zr,{center:e,amount:n,clampBounds:i,bgSampler:o})}};var eo={CustomFilter:R,FireDissolveFilter:Ae,DiamondTransitionFilter:Re,TextureWipeFilter:k,FadeTransitionFilter:ke,LinearWipeFilter:Pe,BilinearWipeFilter:Fe,ClockWipeFilter:Me,SpotlightWipeFilter:He,RadialWipeFilter:$e,ChromaKeyFilter:Kt,TextureSwapFilter:oe,MeltFilter:Be,AngularWipeFilter:We,WaveWipeFilter:qe,InvertFilter:Xe,SpiralWipeFilter:Ue,SpiralShutterFilter:Ge,HueShiftFilter:ze,BarWipeFilter:Ve,ZoomFilter:Je};function Jc(t){switch(t.shape.type){case"r":return"RECTANGLE";case"c":return"CIRCLE";case"p":return"POLYGON";case"e":return"ELLIPSE";default:return"UNKNOWN"}}function oo(){return{horizontal:"BATTLETRANSITIONS.DIRECTIONS.HORIZONTAL",vertical:"BATTLETRANSITIONS.DIRECTIONS.VERTICAL",topleft:"BATTLETRANSITIONS.DIRECTIONS.TOPLEFT",topright:"BATTLETRANSITIONS.DIRECTIONS.TOPRIGHT"}}function xe(){return{clockwise:"BATTLETRANSITIONS.DIRECTIONS.CLOCKWISE",counterclockwise:"BATTLETRANSITIONS.DIRECTIONS.COUNTERCLOCKWISE"}}function to(t){return t?Object.fromEntries(t.drawings.contents.map(e=>[e.uuid,u(`BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.DRAWING.SHAPES.${Jc(e)}`)])):{}}function J(){return{overlay:"BATTLETRANSITIONS.SCENECONFIG.COMMON.DUALSTYLE.OVERLAY",scene:"BATTLETRANSITIONS.SCENECONFIG.COMMON.DUALSTYLE.SCENE",both:"BATTLETRANSITIONS.SCENECONFIG.COMMON.DUALSTYLE.BOTH"}}function x(){return{none:"BATTLETRANSITIONS.EASINGS.NONE",power1in:"BATTLETRANSITIONS.EASINGS.POWER1IN",power1out:"BATTLETRANSITIONS.EASINGS.POWER1OUT",power1inout:"BATTLETRANSITIONS.EASINGS.POWER1INOUT",power2in:"BATTLETRANSITIONS.EASINGS.POWER2IN",power2out:"BATTLETRANSITIONS.EASINGS.POWER2OUT",power2inout:"BATTLETRANSITIONS.EASINGS.POWER2INOUT",power3in:"BATTLETRANSITIONS.EASINGS.POWER3IN",power3out:"BATTLETRANSITIONS.EASINGS.POWER3OUT",power3inout:"BATTLETRANSITIONS.EASINGS.POWER3INOUT",power4in:"BATTLETRANSITIONS.EASINGS.POWER4IN",power4out:"BATTLETRANSITIONS.EASINGS.POWER4OUT",power4inout:"BATTLETRANSITIONS.EASINGS.POWER4INOUT",backin:"BATTLETRANSITIONS.EASINGS.BACKIN",backout:"BATTLETRANSITIONS.EASINGS.BACKOUT",backinout:"BATTLETRANSITIONS.EASINGS.BACKINOUT",bouncein:"BATTLETRANSITIONS.EASINGS.BOUNCEIN",bounceout:"BATTLETRANSITIONS.EASINGS.BOUNCEOUT",bounceinout:"BATTLETRANSITIONS.EASINGS.BOUNCEINOUT",circin:"BATTLETRANSITIONS.EASINGS.CIRCIN",circout:"BATTLETRANSITIONS.EASINGS.CIRCOUT",circinout:"BATTLETRANSITIONS.EASINGS.CIRCINOUT",elasticin:"BATTLETRANSITIONS.EASINGS.ELASTICIN",elasticout:"BATTLETRANSITIONS.EASINGS.ELASTICOUT",elasticinout:"BATTLETRANSITIONS.EASINGS.ELASTICINOUT",expoin:"BATTLETRANSITIONS.EASINGS.EXPOIN",expoout:"BATTLETRANSITIONS.EASINGS.EXPOOUT",expoinout:"BATTLETRANSITIONS.EASINGS.EXPOINOUT",sinein:"BATTLETRANSITIONS.EASINGS.SINEIN",sineout:"BATTLETRANSITIONS.EASINGS.SINEOUT",sineinout:"BATTLETRANSITIONS.EASINGS.SINEINOUT"}}function Zt(){return Object.fromEntries(FontConfig.getAvailableFonts().map(t=>[t,t]))}function en(){return{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM",topleft:"BATTLETRANSITIONS.DIRECTIONS.TOPLEFT",topright:"BATTLETRANSITIONS.DIRECTIONS.TOPRIGHT",bottomleft:"BATTLETRANSITIONS.DIRECTIONS.BOTTOMLEFT",bottomright:"BATTLETRANSITIONS.DIRECTIONS.BOTTOMRIGHT"}}function no(t){return t?Object.fromEntries(t.notes.contents.map(e=>[e.uuid,e.entry?.name??""])):{}}function ae(){return{inside:"BATTLETRANSITIONS.DIRECTIONS.INSIDE",outside:"BATTLETRANSITIONS.DIRECTIONS.OUTSIDE"}}function nt(t,e){let n=!!t?.tokens.contents.length,i=!!t?.tiles.contents.length,r=!!t?.notes.contents.length,o=!!t?.drawings.contents.length,a=!!e?.tokens.contents.length,s=!!e?.tiles.contents.length,c=!!e?.notes.contents.length,l=!!e?.drawings.contents.length;return{targetTypeSelect:{point:"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.POINT.LABEL",...t?{}:{prompt:"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.PROMPT.LABEL"},...n?{oldtoken:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TOKEN.CURRENTSCENE.LABEL",{scene:t.name})}:{},...i?{oldtile:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TILE.CURRENTSCENE.LABEL",{scene:t.name})}:{},...r?{oldnote:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.NOTE.CURRENTSCENE.LABEL",{scene:t.name})}:{},...o?{olddrawing:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.DRAWING.CURRENTSCENE.LABEL",{scene:t.name})}:{},...a?{newtoken:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TOKEN.NEWSCENE.LABEL",{scene:e.name})}:{},...s?{newtile:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TILE.NEWSCENE.LABEL",{scene:e.name})}:{},...c?{newnote:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.NOTE.NEWSCENE.LABEL",{scene:e.name})}:{},...l?{newdrawing:u("BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.DRAWING.NEWSCENE.LABEL",{scene:e.name})}:{}},oldTokenSelect:t?ro(t):{},oldTileSelect:t?io(t):{},oldNoteSelect:t?no(t):{},oldDrawingSelect:t?to(t):{},newTokenSelect:e?ro(e):{},newTileSelect:e?io(e):{},newNoteSelect:e?no(e):{},newDrawingSelect:e?to(e):{},oldHasTokens:n,oldHasTiles:i,oldHasNotes:r,oldHasDrawings:o,newHasTokens:a,newHasTiles:s,newHasNotes:c,newHasDrawings:l}}function io(t){return t?Object.fromEntries(t.tiles.contents.map(e=>[e.uuid,e.texture.src])):{}}function ro(t){return t?Object.fromEntries(t.tokens.contents.map(e=>[e.uuid,e.name])):{}}var mi=class t extends m{#e=null;static DefaultSettings={id:"",type:"angularwipe",duration:1e3,easing:"none",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon angular-wipe fa-fw fas'></i>";static key="angularwipe";static name="ANGULARWIPE";static reversible=!0;static template="angularwipe-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","easing","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e){let i={...t.DefaultSettings,...this.config}.deserializedTexture??h("transparent"),r=new We(i.baseTexture);this.#e=r,this.addFilter(e,r),await this.simpleTween(r)}async reverse(){this.#e instanceof We&&await this.simpleReverse(this.#e)}};var di=class t extends m{#e=null;static DefaultSettings={id:"",type:"barwipe",duration:1e3,easing:"none",direction:"horizontal",version:"1.1.0",backgroundType:"color",backgroundColor:"#00000000",backgroundImage:"",bgSizingMode:"stretch",bars:4};static category="wipe";static hidden=!1;static icon='<i class="fas fa-fw fa-bars"></i>';static key="barwipe";static name="BARWIPE";static reversible=!0;static template="barwipe-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),directionSelect:{horizontal:"BATTLETRANSITIONS.DIRECTIONS.HORIZONTAL",vertical:"BATTLETRANSITIONS.DIRECTIONS.VERTICAL"}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,...d(n,"id","duration","bars","direction","easing","backgroundType","backgroundColor","label"),serializedTexture:i})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=r.deserializedTexture??h("transparent"),a=new Ve(r.direction,r.bars,o.baseTexture);this.#e=a,this.addFilter(e,a),await this.simpleTween(a)}async reverse(){this.#e instanceof Ve&&await this.simpleReverse(this.#e)}};var gi=class t extends m{#e=null;static DefaultSettings={id:"",type:"bilinearwipe",duration:1e3,easing:"none",radial:"inside",direction:"vertical",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon='<i class="fas fa-fw fa-arrows-left-right-to-line"></i>';static key="bilinearwipe";static name="BILINEARWIPE";static reversible=!0;static template="bilinearwipe-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),directionSelect:oo(),radialSelect:ae()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","radial","easing","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??h("transparent"),o=new Fe(i.direction,i.radial,r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}async reverse(){this.#e instanceof Fe&&await this.simpleReverse(this.#e)}};function Q(t){return game.settings?.get("boss-splash",t)}var Ti=class t extends m{static get DefaultSettings(){return{id:"",type:"bosssplash",version:"1.1.0",duration:5e3,actor:"",topColor:Q("colorFirst"),midColor:Q("colorSecond"),botColor:Q("colorThird"),fontColor:Q("colorFont"),fontShadow:Q("colorShadow"),subColor:Q("subColorFont"),subShadow:Q("subColorShadow"),sound:Q("bossSound"),font:Q("fontFamily"),fontSize:Q("fontSize"),subSize:Q("subFontSize"),message:Q("splashMessage")==="{{actor.name}}"?"":Q("splashMessage"),subText:Q("subText"),animationDelay:Q("animationDelay")*1e3,animationDuration:Q("animationDuration")*1e3}}static get hidden(){return!game.modules?.get("boss-splash")?.active}static key="bosssplash";static name="BOSSSPLASH";static template="bosssplash-config";static category="effect";static icon="<i class='bt-icon boss-splash fa-fw fas'></i>";static RenderTemplate(e){let n=ao().sort(jc).map(i=>({..._c(i),selected:e?.actor===i.uuid}));return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},fontSelect:Zt(),actors:n})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLElement?t.fromFormElement(e[0]):new t({...t.DefaultSettings,...e})}static validateForm(e){let n=$(e);return!(!wt(n.find("#fontSize").val())||!wt(n.find("#subSize").val()))}static addEventListeners(e){let n=$(e);n.find("#fontSize").on("input",foundry.utils.debounce(i=>{$(i.currentTarget).val(it($(i.currentTarget).val()||""))},250)),n.find("#subSize").on("input",foundry.utils.debounce(i=>{$(i.currentTarget).val(it($(i.currentTarget).val()||""))},250)),n.find("#font option").each((i,r)=>{let o=$(r).val();$(r).css("font-family",o)}),n.find("#font").on("input",i=>{$(i.currentTarget).css("font-family",$(i.currentTarget).val())})}static fromFormElement(e){let n=$(e),i=n.find("#sound").val()??"",r=it(n.find("#fontSize").val()),o=it(n.find("#subSize").val());return new t({...t.DefaultSettings,sound:i,...d(n,"id","actor","message","subText","duration","animationDelay","animationDuration","topColor","midColor","botColor","fontColor","fontShadow","subColor","subShadow","font","label"),fontSize:wt(r)?r:t.DefaultSettings.fontSize,subSize:wt(o)?o:t.DefaultSettings.subSize})}async execute(e,n){let i={...t.DefaultSettings,...this.config};n.caller===game.user?.id&&game.bossSplash.splashBoss(Qc(i)),await ge(i.duration+i.animationDelay)}};function Qc(t){let e=fromUuidSync(t.actor);return{sound:t.sound,colorFirst:t.topColor,colorSecond:t.midColor,colorThird:t.botColor,colorFont:t.fontColor,subColorFont:t.subColor,colorShadow:t.fontShadow,subColorShadow:t.subShadow,message:t.message?t.message:e?.name??"",subText:t.subText,fontFamily:t.font,fontSize:t.fontSize,subFontSize:t.subSize,timer:t.duration,duration:t.duration,animationDelay:t.animationDelay,actorImg:e?.img??""}}function _c(t){let e={name:t.name,uuid:t.uuid,pack:"",type:t.type,selected:!1};if(game.packs){let n=t.uuid.split(".");if(n[0]==="Compendium"){let i=n.slice(1,3).join("."),r=game.packs.get(i);r?.documentName==="Actor"&&(e.pack=r.title)}}return e}function jc(t,e){let n=rt(t.uuid),i=rt(e.uuid);return n!==i?n.localeCompare(i):t.name.localeCompare(e.name)}var Si=class t extends m{static DefaultSettings={id:"",type:"cleareffects",version:"1.1.0",applyToOverlay:!0,applyToScene:!1};static hidden=!1;static key="cleareffects";static name="CLEAREFFECTS";static skipConfig=!0;static icon='<i class="fas fa-fw fa-eraser"></i>';static category="technical";static from(e){return new t({...t.DefaultSettings,id:foundry.utils.randomID()})}#e=null;teardown(){this.#e&&(Array.isArray(canvas?.stage?.filters)&&canvas.stage.filters.includes(this.#e)&&canvas.stage.filters.splice(canvas.stage.filters.indexOf(this.#e),1),this.#e.destroy(),this.#e=null)}execute(e,n,i){let r={...t.DefaultSettings,...this.config};if(r.applyToOverlay){let o=[...i.overlay];for(let a of o)if(Array.isArray(a.filters))for(let s of a.filters)a.filters.includes(s)&&a.filters.splice(a.filters.indexOf(s),1),s.destroy()}if(r.applyToScene&&canvas?.environment){let o=i.prepared.sceneFilters;for(let a of o)M(a)}}};var bi=class t extends m{#e=null;static DefaultSettings={id:"",type:"clockwipe",duration:1e3,easing:"none",clockDirection:"clockwise",direction:"top",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon clock-wipe fa-fw fas'></i>";static key="clockwipe";static name="CLOCKWIPE";static reversible=!0;static template="clockwipe-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),clockDirectionSelect:xe(),directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","direction","clockdirection","easing","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??h("transparent"),o=new Me(i.clockDirection,i.direction,r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}async reverse(){this.#e instanceof Me&&await this.simpleReverse(this.#e)}};var Ei=class t extends m{static DefaultSettings={id:"",type:"diamondwipe",size:40,duration:1e3,easing:"none",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon diamond-wipe fa-fw fas'></i>";static key="diamondwipe";static name="DIAMONDWIPE";static template="diamondwipe-config";static reversible=!0;static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","easing","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;async reverse(){this.#e instanceof Re&&await this.simpleReverse(this.#e)}async execute(e){let n={...t.DefaultSettings,...this.config},i=this.config.deserializedTexture??h("transparent"),r=new Re(n.size,i.baseTexture);this.#e=r,this.addFilter(e,r),await this.simpleTween(r)}};var hi=class t extends m{#e=null;static DefaultSettings={id:"",type:"fade",duration:1e3,version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundColor:"#00000000",easing:"none"};static category="effect";static hidden=!1;static icon="<i class='bt-icon fade fa-fw fas'></i>";static key="fade";static name="FADE";static reversible=!0;static template="fade-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","backgroundType","backgroundColor","easing","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n){let r={...t.DefaultSettings,...this.config}.deserializedTexture??h("transparent"),o=new ke(r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}async reverse(){this.#e instanceof ke&&await this.simpleReverse(this.#e)}};var Ii=class t extends m{static DefaultSettings={id:"",type:"firedissolve",duration:1e3,easing:"none",burnSize:1.3,version:"1.1.0"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon fire-dissolve fa-fw fas'></i>";static key="firedissolve";static name="FIREDISSOLVE";static template="firedissolve-config";static reversible=!0;static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=d($(e),"id","duration","easing","burnSize","label");return new t({...t.DefaultSettings,...n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;async reverse(){this.#e instanceof Ae&&await this.simpleReverse(this.#e)}async execute(e,n){let i=new Ae(this.config.burnSize);this.#e=i,this.addFilter(e,i),await this.simpleTween(i)}};var yi=class t extends m{static DefaultSettings={id:"",type:"flash",duration:250,version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000",applyToOverlay:!0,applyToScene:!1};static category="effect";static hidden=!1;static icon="<i class='bt-icon flash fa-fw fas'></i>";static key="flash";static name="FLASH";static template="flash-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=this.config.deserializedTexture??h("tranparent"),a=[];if(r.applyToOverlay){let s=new oe(o.baseTexture);this.addFilter(e,s),a.push(ge(r.duration).then(()=>{this.removeFilter(e,s),s.destroy()}))}if(r.applyToScene&&canvas?.stage){let s=new oe(o.baseTexture);_(s,i.prepared),a.push(ge(r.duration).then(()=>{M(s)}))}await Promise.all(a)}};var wi=class t extends m{static DefaultSettings={id:"",type:"hueshift",duration:0,version:"1.1.0",maxShift:0,easing:"none",applyToOverlay:!0,applyToScene:!1};static category="effect";static hidden=!1;static icon="<i class='bt-icon hue-shift fa-fw fas'></i>";static key="hueshift";static name="HUESHIFT";static template="hueshift-config";static reversible=!0;static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#maxShift input[type='number']").val(),r=n.find("#dualStyle").val();return new t({...t.DefaultSettings,maxShift:i,...d(n,"id","duration","easing","label"),applyToOverlay:r==="overlay"||r==="both",applyToScene:r==="scene"||r==="both"})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;teardown(){this.#e&&M(this.#e),this.#e=null}#t=[];async reverse(){let e={...t.DefaultSettings,...this.config};await Promise.all(this.#t.map(n=>TweenMax.to(n.uniforms,{shift:0,duration:e.duration/1e3,ease:e.easing})))}async execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=[];if(r.applyToOverlay){let a=new ze(0);this.addFilter(e,a),o.push(a)}if(r.applyToScene&&canvas?.stage){let a=new ze(0);_(a,i.prepared),this.#e=a,o.push(a)}this.#t=[...o],await Promise.all(o.map(a=>TweenMax.to(a.uniforms,{shift:r.maxShift,duration:r.duration/1e3,ease:r.easing??"none"})))}};var Ci=class t extends m{static DefaultSettings={id:"",type:"invert",version:"1.1.0",applyToOverlay:!0,applyToScene:!1};static hidden=!1;static key="invert";static name="INVERT";static template="invert-config";static category="effect";static icon="<i class='bt-icon invert fa-fw fas'></i>";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,...e||{},dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#dualStyle").val();return new t({...t.DefaultSettings,id:foundry.utils.randomID(),...d(n,"id"),applyToOverlay:i==="overlay"||i==="both",applyToScene:i==="scene"||i==="both"})}#e=null;teardown(){this.#e&&M(this.#e),this.#e=null}execute(e,n,i){let r={...t.DefaultSettings,...this.config};if(r.applyToOverlay){let o=new Xe;this.addFilter(e,o)}if(r.applyToScene&&canvas?.stage){let o=new Xe;_(o,i.prepared),this.#e=o}}};var vi=class t extends m{#e=null;defaultSettings={duration:1e3};static DefaultSettings={id:"",type:"linearwipe",duration:1e3,easing:"none",direction:"left",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon='<i class="fas fa-fw fa-arrow-right"></i>';static key="linearwipe";static name="LINEARWIPE";static reversible=!0;static template="linearwipe-config";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),directionSelect:en()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroundImage").val()??"",i=d($(e),"id","duration","direction","easing","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=i.deserializedTexture??h("transparent"),o=new Pe(i.direction,r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}async reverse(){this.#e instanceof Pe&&await this.simpleReverse(this.#e)}};var se=null,Li=class t extends m{static DefaultSettings={id:"",type:"loadingtip",version:"1.1.0",duration:0,source:"string",message:"Loading",location:"bottomcenter",style:{...JSON.parse(JSON.stringify(PIXI.HTMLTextStyle.defaultStyle)),fill:"#FFFFFF",dropShadow:!0,fontSize:64}};static category="effect";static hidden=!1;static icon='<i class="fas fa-spinner"></i>';static key="loadingtip";static name="LOADINGTIP";static template="loadingtip-config";static async RenderTemplate(e){let n=xi({...t.DefaultSettings,...e||{}}.style);return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},sourceSelect:{string:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.SOURCETYPE.STRING.LABEL",rolltable:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.SOURCETYPE.ROLLTABLE.LABEL"},locationSelect:{topleft:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.TOPLEFT",topcenter:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.TOPCENTER",topright:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.TOPRIGHT",center:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.CENTER",bottomleft:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.BOTTOMLEFT",bottomcenter:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.BOTTOMCENTER",bottomright:"BATTLETRANSITIONS.SCENECONFIG.LOADINGTIP.LOCATION.BOTTOMRIGHT"},tableSelect:Object.fromEntries(tl().map(i=>[i.uuid,i.name])),fontSelect:Zt(),fontFamily:n.fontFamily,fontSize:n.fontSize,fontColor:n.fill})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#sourceType").val(),r="",o="";i==="string"?r=n.find("#message").val():i==="rolltable"&&(o=n.find("#table").val());let a=JSON.parse(JSON.stringify(xi({...t.DefaultSettings.style,fontFamily:n.find("#fontFamily").val(),fontSize:n.find("#fontSize").val(),fill:n.find("#fontColor").val()})));return new t({...t.DefaultSettings,...d(n,"id","duration","location"),source:i,message:r,table:o,style:a})}execute(e){let n={...t.DefaultSettings,...this.config},i=xi(n.style);se||(se=new PIXI.HTMLText(n.message??""),e.parent.addChild(se)),se.text=Yc(n),se.style=i;let[r,o]=el(n),a=Zc(n);if(se.anchor.x=a[0],se.anchor.y=a[1],se.x=r,se.y=o,n.duration)return new Promise(s=>{setTimeout(()=>{this.teardown(),s()},n.duration)})}static addEventListeners(e){let n=$(e);lo(n,n.find("#sourceType").val()),n.find("#sourceType").on("input",()=>{let i=n.find("#sourceType").val();lo(n,i),i==="string"?n.find("#table").removeAttr("required"):i==="rolltable"&&n.find("#table").attr("required","true")})}teardown(){se&&(se.destroy(),se=null)}};function xi(t){let e=new PIXI.HTMLTextStyle;return ot(e,t),e}function Yc(t){if(t.source==="rolltable"){if(!t.table)throw new bt(t.table);let e=fromUuidSync(t.table);if(!(e instanceof RollTable))throw new bt(t.table);return e.results.contents[Math.floor(Math.random()*e.results.contents.length)].text}else return t.message??""}function Kc(){return{x:so("#controls"),y:co("#ui-top"),width:($("#sidebar").offset()??{top:0,left:0}).left-so("#controls"),height:($("#ui-bottom").offset()??{top:0,left:0}).top-co("#ui-top")-25}}function Zc(t){switch(t.location){case"topleft":return[0,0];case"topcenter":return[.5,0];case"topright":return[1,0];case"center":return[.5,.5];case"bottomleft":return[0,1];case"bottomcenter":return[.5,1];case"bottomright":return[1,1];default:throw new Et(t.location)}}function el(t){let e=Kc();switch(t.location){case"topleft":return[e.x,e.y];case"topcenter":return[window.innerWidth/2,e.y];case"topright":return[e.x+e.width,e.y];case"bottomleft":return[e.x,e.y+e.height];case"bottomcenter":return[window.innerWidth/2,e.y+e.height];case"bottomright":return[e.x+e.width,e.height+e.y];case"center":return[window.innerWidth/2,window.innerHeight/2];default:throw new Et(t.location)}}function so(t){return(($(t).offset()??{top:0,left:0}).left??0)+($(t).width()??0)}function co(t){return(($(t).offset()??{top:0,left:0}).top??0)+($(t).height()??0)}function tl(){return[...game?.tables?.contents??[]]}function lo(t,e){t.find("[data-source-type]").css("display","none"),t.find(`[data-source-type="${e}"]`).css("display","block")}var Ni=class t extends m{static DefaultSettings={id:"",type:"macro",macro:"",version:"1.1.0"};static hidden=!1;static key="macro";static name="MACRO";static template="macro-config";static icon="<i class='bt-icon macro fa-fw fas'></i>";static category="technical";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},macros:uo().sort(nl).map(il)})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=d($(e),"id","macro","label");return new t({...t.DefaultSettings,...n})}execute(e,n){let i={...t.DefaultSettings,...this.config},r=fromUuidSync(i.macro);if(!(r instanceof Macro))throw new Ke(i.macro);return r.execute()}};function nl(t,e){let n=rt(t.uuid),i=rt(e.uuid);return n!==i?n.localeCompare(i):t.name.localeCompare(e.name)}function il(t){let e={name:t.name,uuid:t.uuid,pack:""};if(game.packs){let n=t.uuid.split(".");if(n[0]==="Compendium"){let i=n.slice(1,3).join("."),r=game.packs.get(i);r?.documentName==="Macro"&&(e.pack=r.title)}}return e}var Oi=class t extends m{#e=null;static DefaultSettings={id:"",type:"melt",duration:1e3,version:"1.1.0",easing:"none",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="warp";static hidden=!1;static icon="<i class='bt-icon melt fa-fw fas'></i>";static key="melt";static name="MELT";static reversible=!0;static template="melt-config";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e).find("#backgroudnimage").val()??"",i=d($(e),"id","duration","easing","backgroundType","backgroundColor","label");return new t({...t.DefaultSettings,...i,serializedTexture:n})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}async execute(e,n){let i=this.config.deserializedTexture??h("transparent"),r=new Be(i.baseTexture);this.#e=r,this.addFilter(e,r),await this.simpleTween(r)}async reverse(){this.#e instanceof Be&&await this.simpleReverse(this.#e)}};var po=3e3,Di=class{#e;async#t(e){await P.executePreparedSequence(e)}async#n(e){await P.prepareSequence(e)}async execute(e){try{let n=foundry.utils.randomID(),i=await P.validateSequence(e);if(i instanceof Error)throw i;let r={caller:game.user?.id??"",id:n,sequence:i.map(c=>typeof c.id>"u"?{...c,id:foundry.utils.randomID()}:c)};if(!e.some(c=>c.type==="startplaylist")){let c={...at.DefaultSettings,...new at({}).config};r.sequence.push(c)}let o=await W(r.sequence),a=game.users?.contents.filter(c=>c.active)??[],s=[];await Promise.any([Promise.all(a.map(c=>this.#e.executeAsUser("transition.prep",c.id,r).then(()=>{s.push(c)}))),ge(po)]),s.length<a.length&&ui.notifications?.warn(u("BATTLETRANSITIONS.WARNINGS.PREPARETIMEOUT"),{console:!1}),await Promise.any([Promise.all(s.map(c=>this.#e.executeAsUser("transition.exec",c.id,r.id))),ge(o+po)])}catch(n){ui.notifications?.error(n.message,{console:!1}),console.error(n)}}register(e){Qe("Registering socket."),this.#e=e,e.register("transition.exec",this.#t.bind(this)),e.register("transition.prep",this.#n.bind(this))}},Ct=new Di;function rl(){let t=rn();return lunr(function(){this.field("name"),this.field("description"),this.ref("key");for(let e of t)this.add({name:u(`BATTLETRANSITIONS.${e.name}.NAME`),description:u(`BATTLETRANSITIONS.${e.name}.DESCRIPTION`),key:e.key})})}function Te(){nn=!1,$("#step-search-results").children().remove(),$("#step-search-results").css("display","none"),$("#clear-search").css("display","none")}function ol(){let t=document.createElement("div");return t.setAttribute("id","step-search-results"),t.classList.add("step-search-results"),document.body.appendChild(t),$(t)}function al(t){let e=document.createElement("div");return e.dataset.key=t.key,e.innerHTML=u(`BATTLETRANSITIONS.${t.name}.NAME`),t.icon?e.innerHTML=`${t.icon}${e.innerHTML}`:e.style.paddingLeft="calc(1.25em + 12px)",e}function sl(t){return rl().search(t).map(i=>I(i.ref)).filter(i=>!!i)}function tn(t,e,n){let i=t.val();if(!i||i.length<3){cl();return}let r=$("#step-search-results");(!r||!r.length)&&(r=ol()),Te(),$("#clear-search").css("display","block");let o=sl(i);for(let a of o){let s=al(a);$(s).on("click",()=>{n(a.key)}),r.append(s)}ll(t,e)}function cl(){nn=!1,Te(),$("#clear-search").css("display","none")}function fo(t,e){if(!nn)return;let n=$("#step-search-results");if(!n?.length||!t.length||e instanceof Dialog&&e.closing||foundry.applications?.api?.DialogV2&&e instanceof foundry.applications.api.DialogV2&&e.state===-2){Te();return}n.css("top",(t?.offset()?.top??0)+(t?.height()??0)+8),n.css("left",t?.offset()?.left??0),n.css("width",t?.width()??150),requestAnimationFrame(()=>{fo(t,e)})}function ll(t,e){$("#step-search-results").css("display","block"),nn=!0,fo(t,e)}var nn=!1;var on=class{static async prompt(){let e=await renderTemplate("/modules/battle-transitions/templates/dialogs/AddStepDialogV1.hbs",{tabs:[{icon:"",id:"wipes",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WIPES",data:Se("wipe")},{icon:"",id:"warps",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WARPS",data:Se("warp")},{icon:"",id:"effects",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.EFFECTS",data:Se("effect")},{icon:"",id:"technical",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.TECHNICAL",data:Se("technical")}]});return new Promise(n=>{let i=new Dialog({title:u("BATTLETRANSITIONS.DIALOGS.ADDSTEP.TITLE"),content:e,buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>{n(null)}}},close:()=>{Te()},render:r=>{ul(i,$(r),n)}});i.render(!0,{classes:["dialog","bt"],resizable:!0})})}};function ul(t,e,n){new Tabs({contentSelector:".tab-content",navSelector:'.tabs[data-group="primary-tabs"]',initial:"wipes",callback:()=>{t.setPosition()}}).bind($(e)[0]),e.find("#search-text").on("input",r=>{tn($(r.currentTarget),t,o=>{n(o),t.close()})}),e.find("#clear-search").on("click",()=>{Te(),e.find("#search-text").val("")}),e.find("button[data-transition]").on("click",r=>{r.preventDefault();let o=r.currentTarget?.dataset?.transition??"";n(o||null),t.close()})}var an=class{static async prompt(){let e=await renderTemplate("/modules/battle-transitions/templates/dialogs/AddStepDialogV2.hbs",{tabs:[{icon:"",id:"wipes",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WIPES",data:Se("wipe")},{icon:"",id:"warps",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.WARPS",data:Se("warp")},{icon:"",id:"effects",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.EFFECTS",data:Se("effect")},{icon:"",id:"technical",title:"BATTLETRANSITIONS.DIALOGS.ADDSTEP.TABS.TECHNICAL",data:Se("technical")}]});return new Promise(n=>{new foundry.applications.api.DialogV2({window:{title:u("BATTLETRANSITIONS.DIALOGS.ADDSTEP.TITLE")},content:e,position:{width:450},buttons:[{label:`<i class="fas fa-times"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel",callback:()=>(n(null),Promise.resolve())}]}).render(!0).then(r=>{pl(r,$(r.element),n)})})}};function pl(t,e,n){new Tabs({contentSelector:".tab-content",navSelector:".tabs[data-group='primary-tabs']",initial:"wipes"}).bind(t.element),e.find("button[data-transition]").on("click",r=>{r.preventDefault();let o=r.currentTarget.dataset.transition??"";n(o||null),Te(),t.close()}),e.find("#clear-search").on("click",()=>{Te(),e.find("#search-text").val("")}),e.find("#search-text").on("input",r=>{tn($(r.currentTarget),t,o=>{n(o),t.close(),Te()})})}var sn=class{static async prompt(e,n,i){let r=I(e.type);if(!r)throw new T(typeof e.type=="string"?e.type:typeof e.type);let o=await r.RenderTemplate(e,n,i);return new Promise(a=>{let s=new Dialog({title:u("BATTLETRANSITIONS.DIALOGS.EDITSTEP.TITLE",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)}),content:o,buttons:{ok:{icon:'<i class="fas fa-check"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),callback:c=>{let l=r.from($(c).find("form"))?.config??null;a(l?{...r.DefaultSettings,...l}:null)}},cancel:{icon:'<i class="fas fa-times"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>{a(null)}}},render:c=>{fl(s,$(c)),r.addEventListeners($(c),e);let l=Hooks.on("closeDialog",p=>{p.id===s.id&&(Hooks.off("closeDialog",l),r.editDialogClosed(c))})}});s.render(!0,{classes:["dialog","bt"],resizable:!0,width:500})})}};function mo(t){let e=t.find("[data-transition-type]").data("transition-type"),n=I(e);if(!n)throw new T(e);n.validateForm(t)&&t.find("form")[0]?.checkValidity()?t.find("button[data-action='ok']").removeAttr("disabled"):t.find("button[data-action='ok']").attr("disabled","true")}function fl(t,e){e.find("input[type='number'],input[type='text']").on("focus",i=>{i.currentTarget.select()}),mo(e),e.find("input").on("input",()=>{mo(e)}),e.find("[data-font-select] option").each((i,r)=>{r instanceof HTMLOptionElement&&(r.style.fontFamily=r.value)}),e.find("[data-font-select]").css("font-family",e.find("[data-font-select]").val()),e.find("[data-font-select]").on("input",i=>{$(i.currentTarget).css("font-family",$(i.currentTarget).val())}),e.find("#backgroundImage").on("input",()=>{let i=e.find("#backgroundImage").val()??"";if(i){let r=document.createElement("img"),o=$(r);o.addClass("bg-image-preview"),o.attr("src",i),e.find("#backgroundImagePreview img").remove(),e.find("#backgroundImagePreview").append(o)}else e.find("#backgroundImagePreview img").remove()}),new Tabs({contentSelector:".tab-content",navSelector:".tabs[data-group='primary-tabs']",initial:"wipes"}).bind(e[0]),go(e),e.find("#backgroundType").on("change",()=>{go(e)}),ColorPicker.install()}function go(t){let e=t.find("#backgroundType").val();t.find("[data-background-type]").css("display","none"),t.find(`[data-background-type="${e}"]`).css("display","block")}var cn=class{static async prompt(e,n,i){let r=I(e.type);if(!r)throw new T(typeof e.type=="string"?e.type:typeof e.type);let o=await r.RenderTemplate(e,n,i);return new Promise(a=>{new foundry.applications.api.DialogV2({window:{title:u("BATTLETRANSITIONS.DIALOGS.EDITSTEP.TITLE",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)})},content:o,buttons:[{label:`<i class="fas fa-check"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK")}`,default:!0,action:"ok",callback:(c,l,p)=>{let f=r.from($(p).find("form"))?.config??null;return a(f?{...r.DefaultSettings,...f}:null),Promise.resolve()}},{label:`<i class="fas fa-times"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel"}]}).render(!0).then(c=>{c.position.width=500;let l=$(c.element);ml(c,l),r.addEventListeners(l,e);let p=Hooks.on("closeDialogV2",f=>{f.id===c.id&&(Hooks.off("closeDialogV2",p),r.editDialogClosed(l))})})})}};function To(t){let e=t.find("[data-transition-type]").data("transition-type"),n=I(e);if(!n)throw new T(e);n.validateForm(t)&&t.find("form")[0]?.checkValidity()?t.find("button[data-action='ok']").removeAttr("disabled"):t.find("button[data-action='ok']").attr("disabled","true")}function ml(t,e){e.find("input[type='number'],input[type='text']").on("focus",i=>{i.currentTarget.select()}),To(e),e.find("input,select").on("input",()=>{To(e)}),e.find("#backgroundImage").on("input",()=>{let i=e.find("#backgroundImage").val()??"";if(i){let r=document.createElement("img"),o=$(r);o.addClass("bg-image-preview"),o.attr("src",i),e.find("#backgroundImagePreview img").remove(),e.find("#backgroundImagePreview").append(o)}else e.find("#backgroundImagePreview img").remove()}),e.find("[data-font-select] option").each((i,r)=>{r instanceof HTMLOptionElement&&(r.style.fontFamily=r.value)}),e.find("[data-font-select]").css("font-family",e.find("[data-font-select]").val()),e.find("[data-font-select]").on("input",i=>{$(i.currentTarget).css("font-family",$(i.currentTarget).val())}),new Tabs({contentSelector:".tab-content",navSelector:".tabs[data-group='primary-tabs']",initial:"wipes"}).bind(t.element),So(e),e.find("#backgroundType").on("change",()=>{So(e)}),ColorPicker.install()}function So(t){let e=t.find("#backgroundType").val();t.find("[data-background-type]").css("display","none"),t.find(`[data-background-type="${e}"]`).css("display","block")}var ln=class{static async prompt(e){let n=await renderTemplate("/modules/battle-transitions/templates/dialogs/TransitionBuilder.hbs",{newScene:e?.id,oldScene:game.scenes?.current?.id??"",scenes:game.scenes?.contents.map(i=>({id:i.id,name:i.name}))??[]});return new Promise(i=>{let r=new Dialog({title:u("BATTLETRANSITIONS.DIALOGS.TRANSITIONBUILDER.TITLE"),content:n,render:o=>{dl(r,$(o))},default:"ok",buttons:{ok:{icon:'<i class="fas fa-play"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.TRANSITION"),callback:o=>{let a=$(o),s=N(a),c=e?e.id:a.find("#newScene").val();if(!c)throw new O(typeof c=="string"?c:typeof c);let l=I("scenechange");if(!l)throw new T("scenechange");let p={...l.DefaultSettings,scene:c};i([p,...s])}},cancel:{icon:'<i class="fas fa-times"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>{i(null)}}}});r.render(!0,{resizable:!0})})}};function dl(t,e){e.find("button[data-action='add-step']").on("click",n=>{n.preventDefault(),Sl(t,e)}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),e.find('[data-action="import-json"]').on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),Tl(t,e))}),e.find("[data-action='clear-steps']").on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),gl(e))}),bo(e)}async function gl(t){await F("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.TITLE",u("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.MESSAGE"))&&(t.find("#transition-step-list").children().remove(),await Eo(t),bo(t))}function bo(t){N(t).length?t.find("#clear-steps").removeAttr("disabled"):t.find("#clear-steps").attr("disabled","true")}async function Tl(t,e){try{if(N(e).length&&!await F("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.TITLE",u("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.MESSAGE")))return;let i=await vt();e.find("#transition-step-list").children().remove();for(let r of i)await Ai(t,e,r)}catch(n){ui.notifications?.error(n.message,{console:!1}),console.error(n)}}async function Sl(t,e){let n=await ce();if(!n)return;let i=I(n);if(!i)throw new T(n);let r=null;i.skipConfig?r={...i.DefaultSettings,id:foundry.utils.randomID()}:r=await q(i.DefaultSettings),r&&(await Ai(t,e,r),t.setPosition())}async function Eo(t){let e=N(t),n=await W(e);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(n)}))}async function Ai(t,e,n){let i=I(n.type);if(!i)throw new T(n.type);let r=[...N(e),n],o=i.getDuration(n,r),a=o instanceof Promise?await o:o;await Eo(e);let s=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...i.DefaultSettings,...n,name:u(`BATTLETRANSITIONS.${i.name}.NAME`),description:u(`BATTLETRANSITIONS.${i.name}.DESCRIPTION`),type:i.key,calculatedDuration:a,skipConfig:i.skipConfig,flag:JSON.stringify({...i.DefaultSettings,...n})}),c=$(s),l=e.find(`[data-id="${n.id}"]`);l.length?l.replaceWith(c):e.find("#transition-step-list").append(c),bl(t,e,c,n)}function bl(t,e,n,i){n.find("[data-action='remove']").on("click",()=>{let r=I(i.type);if(!r)throw new T(i.type);F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)})).then(o=>{o&&(n.remove(),t.setPosition())}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{let r=e.find("#oldScene").val()??"",o=e.find("#newScene").val()??"";q(i,game.scenes?.get(r),game.scenes?.get(o)).then(a=>{if(a)return Ai(t,e,a)}).then(()=>{}).catch(a=>{ui.notifications?.error(a.message,{console:!1}),console.error(a)})})}var un=class{static async prompt(e){let n=await renderTemplate("/modules/battle-transitions/templates/dialogs/TransitionBuilder.hbs",{newScene:e?.id,oldScene:game.scenes?.current?.id??"",scenes:game.scenes?.contents.map(i=>({id:i.id,name:i.name}))??[]});return new Promise(i=>{new foundry.applications.api.DialogV2({window:{title:u("BATTLETRANSITIONS.DIALOGS.TRANSITIONBUILDER.TITLE")},content:n,buttons:[{label:`<i class="fas fa-play"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.TRANSITION")}`,default:!0,action:"ok",callback:(o,a,s)=>{let c=$(s),l=N(c),p=e?e.id:c.find("#scene").val();if(!p)throw new O(typeof p=="string"?p:typeof p);let f=I("scenechange");if(!f)throw new T("scenechange");let y={...f.DefaultSettings,scene:p};return i([y,...l]),Promise.resolve()}},{label:`<I class="fas fa-times"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel",callback:()=>(i(null),Promise.resolve())}]}).render(!0).then(o=>{El(o,$(o.element))})})}};function El(t,e){e.find("button[data-action='add-step']").on("click",n=>{n.preventDefault(),yl(t,e)}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),e.find('[data-action="import-json"]').on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),Il(t,e))}),e.find("[data-action='clear-steps']").on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),hl(e))}),pn(e)}async function hl(t){await F("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.TITLE",u("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.MESSAGE"))&&(t.find("#transition-step-list").children().remove(),await wl(t),pn(t))}function pn(t){N(t).length?t.find("#clear-steps").removeAttr("disabled"):t.find("#clear-steps").attr("disabled","true")}async function Il(t,e){try{if(N(e).length&&!await F("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.TITLE",u("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.MESSAGE")))return;let i=await vt();e.find("#transition-step-list").children().remove();for(let r of i)await Ri(t,e,r)}catch(n){ui.notifications?.error(n.message,{console:!1}),console.error(n)}}async function yl(t,e){let n=await ce();if(!n)return;let i=I(n);if(!i)throw new T(n);let r=null,o=e.find("#oldScene").val()??"",a=e.find("#newScene").val()??"";i.skipConfig?r={...i.DefaultSettings,id:foundry.utils.randomID()}:r=await q(i.DefaultSettings,game.scenes?.get(o),game.scenes?.get(a)),r&&await Ri(t,e,r)}async function wl(t){let e=N(t),n=await W(e);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(n)}))}async function Ri(t,e,n){let i=I(n.type);if(!i)throw new T(n.type);let r=[...N(e),n],o=i.getDuration(n,r),a=o instanceof Promise?await o:o,s=await W(r);e.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(s)}));let c=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...i.DefaultSettings,...n,name:u(`BATTLETRANSITIONS.${i.name}.NAME`),description:u(`BATTLETRANSITIONS.${i.name}.DESCRIPTION`),type:i.key,calculatedDuration:a,skipConfig:i.skipConfig,flag:JSON.stringify({...i.DefaultSettings,...n})}),l=$(c),p=e.find(`[data-id="${n.id}"]`);p.length?p.replaceWith(l):e.find("#transition-step-list").append(l),pn(e),Cl(t,e,l,n)}function Cl(t,e,n,i){n.find("[data-action='remove']").on("click",()=>{let r=I(i.type);if(!r)throw new T(i.type);F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)})).then(o=>{o&&(n.remove(),pn(e))}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{let r=e.find("#oldScene").val()??"",o=e.find("#newScene").val()??"";q(i,game.scenes?.get(r),game.scenes?.get(o)).then(a=>{if(a)return Ri(t,e,a)}).catch(a=>{ui.notifications?.error(a.message,{console:!1}),console.error(a)})})}async function ce(){return Le()?an.prompt():on.prompt()}function Se(t,e=!1){return rn().reduce((n,i)=>i.category===t&&(e||i.hidden===!1)?[...n,{key:i.key,name:`BATTLETRANSITIONS.${i.name}.NAME`,description:`BATTLETRANSITIONS.${i.name}.DESCRIPTION`,icon:i.icon,tooltip:"",hasIcon:!!i.icon}]:n,[])}async function q(t,e,n){return Le()?cn.prompt(t,e,n):sn.prompt(t,e,n)}async function F(t,e){return Le()?foundry.applications.api.DialogV2.confirm({window:{title:t},content:e}):Dialog.confirm({title:t,content:e}).then(n=>!!n)}function N(t){let e=[];return t.find("#transition-step-list [data-transition-type]").each((n,i)=>{let r=i.dataset.flag??"",o=JSON.parse(r);e.push(o)}),e}async function ho(t){return Le()?un.prompt(t):ln.prompt(t)}async function Io(t,e,n,i,r){return Le()?xl(t,e,n,i,r):vl(t,e,n,i,r)}async function vl(t,e,n,i,r){return new Promise(o=>{let a=0,s=new Dialog({title:u(t),content:e,buttons:n,render(c){i&&i($(c))},close(c){let l=$(c);o(l),r&&r(l),a=Hooks.on("closeDialog",p=>{p.id===s.id&&(Hooks.off("closeDialog",a),r&&r(l))})}});s.render(!0)})}async function xl(t,e,n,i,r){return new Promise((o,a)=>{let s=0,c=new foundry.applications.api.DialogV2({window:{title:u(t)},content:e,buttons:Object.entries(n).map(([l,p])=>({action:l,label:`${p.icon?`${p.icon} `:""}${u(p.label)}`,callback:()=>(p.callback&&p.callback($(c.element)),Promise.resolve())}))});c.render(!0).then(l=>{i&&i($(l.element));let p=l.element;s=Hooks.on("closeDialogV2",f=>{f.id===c.id&&(Hooks.off("closeDialogV2",s),o($(p)),r&&r($(p)))})}).catch(a)})}var kt=xr(Yi());var w=class{Migrate(e){let n=this.Version(e);if(kt.default.gt(n,this.NewestVersion))throw new ht(n);if(!n)throw new Gt(n);if(n===this.NewestVersion)return e;let i=Object.entries(this.migrationFunctions);for(let[r,o]of i)if(kt.default.satisfies(n,r))return o(e);throw new tt(n,this.NewestVersion)}NeedsMigration(e){let n=this.Version(e);if(kt.default.gt(n,this.NewestVersion))throw new ht(n);return kt.default.lt(n,this.NewestVersion)}};var yf="1.1.0",yn=class extends w{migrationFunctions={"~1.0":wf};Version(e){return typeof e.version>"u"?"1.0.5":e.version}NewestVersion=yf};function wf(t){let e={autoTrigger:t.config?.autoTrigger??!1,version:"1.1.0",isTriggered:!1,sequence:[]};return Array.isArray(t.steps)&&t.steps.length&&(e.sequence=t.steps.map(n=>{if(!I(n.type))throw new T(typeof n.type=="string"?n.type:typeof n.class);let r=Ne.TransitionSteps[n.type];if(!r)throw new tt("undefined","#{VERSION}#");return r.NeedsMigration(n)?r.Migrate(n):n})),e}var wn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Cn=class extends w{migrationFunctions={"~1.0":Cf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Cf(t){return{id:t.id??foundry.utils.randomID(),type:"bilinearwipe",version:"1.1.0",duration:t.duration,easing:t.easing,direction:t.direction,radial:t.radial,...Y(t)}}var vn=class extends w{migrationFunctions={"~1.0":vf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function vf(t){return{id:t.id??foundry.utils.randomID(),type:"clockwipe",version:"1.1.0",easing:t.easing,duration:t.duration,direction:t.direction,clockDirection:t.clockdirection,...Y(t)}}var xn=class extends w{migrationFunctions={"~1.0":xf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function xf(t){return{id:t.id??foundry.utils.randomID(),type:"diamondwipe",version:"1.1.0",duration:t.duration,size:t.size,easing:t.easing,...Y(t)}}var Ln=class extends w{migrationFunctions={"~1.0":Lf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Lf(t){return{id:t.id??foundry.utils.randomID(),easing:t.easing,duration:t.duration,type:"fade",version:"1.1.0",...Y(t)}}var Nn=class extends w{migrationFunctions={"~1.1.0":Nf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Nf(t){return{id:t.id??foundry.utils.randomID(),easing:t.easing,duration:t.duration,burnSize:t.burnSize,type:"firedissolve",version:"1.1.0"}}var On=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Dn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var An=class extends w{migrationFunctions={"~1.0":Of};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Of(t){return{id:t.id??foundry.utils.randomID(),type:"linearwipe",version:"1.1.0",duration:t.duration,direction:t.direction,easing:t.easing,...Y(t)}}var Rn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var kn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Fn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Pn=class extends w{migrationFunctions={"~1.0":Df};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Df(t){return{id:t.id??foundry.utils.randomID(),easing:t.easing??"none",version:"1.1.0",radial:t.radial,duration:t.duration,type:"radialwipe",target:[.5,.5],...Y(t)}}var Mn=class extends w{migrationFunctions={"~1.0":Af};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Af(t){return{id:foundry.utils.randomID(),type:t.type,version:"1.1.0"}}var Hn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var $n=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var Bn=class extends w{migrationFunctions={"~1.0":Rf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Rf(t){return{id:t.id,file:t.file,type:"sound",version:"1.1.0",volume:t.volume}}var Wn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var qn=class extends w{migrationFunctions={"~1.0":kf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function kf(t){return{id:t.id??foundry.utils.randomID(),version:"1.1.0",type:"spotlightwipe",duration:t.duration,easing:t.easing??"none",direction:t.direction,radial:t.radial,...Y(t)}}var Xn=class extends w{migrationFunctions={"~1.0":Ff};NewestVersion="1.1";Version(e){return e.version??"1.0.5"}};function Ff(t){return{id:t.id??foundry.utils.randomID(),version:"1.1.0",type:"textureswap",bgSizingMode:"stretch",backgroundImage:t.texture&&!be(t.texture)?t.texture:"",backgroundColor:t.texture&&!be(t.texture)?"":t.texture,backgroundType:t.texture&&!be(t.texture)?"image":"color",applyToOverlay:!0,applyToScene:!1}}var Gn=class extends w{migrationFunctions={"~1.0":Pf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Pf(t){return{version:"1.1.0",type:"video",id:t.id??foundry.utils.randomID(),file:t.file,volume:t.volume,clear:t.clear,videoSizingMode:"stretch",...Y(t)}}var Un=class extends w{migrationFunctions={"~1.0":Mf};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};function Mf(t){return{id:t.id??foundry.utils.randomID(),type:"wait",version:"1.1.0",duration:t.duration}}var zn=class extends w{migrationFunctions={};NewestVersion="1.1.0";Version(e){return e.version??"1.0.5"}};var fs={angularwipe:new wn,bilinearwipe:new Cn,clockwipe:new vn,diamondwipe:new xn,fade:new Ln,firedissolve:new Nn,flash:new On,invert:new Dn,linearwipe:new An,macro:new Rn,melt:new kn,parallel:new Fn,radialwipe:new Pn,removeoverlay:new Mn,restoreoverlay:new Hn,scenechange:new $n,sound:new Bn,spiralradialwipe:new Wn,spotlightwipe:new qn,textureswap:new Xn,video:new Gn,wait:new Un,wavewipe:new zn};var Ne=class{static SceneConfiguration=new yn;static TransitionSteps=fs};var Ee=class t{static AddToNavigationBar(e){e.push({name:"BATTLETRANSITIONS.NAVIGATION.TRIGGER",icon:'<i class="fas bt-icon fa-fw crossed-swords"></i>',condition:n=>{try{let i=Ki(n);if(!i||i.id===canvas?.scene?.id)return!1;let r=this.GetSceneTransition(i)??[];return Array.isArray(r)&&r.length}catch(i){ui.notifications?.error(i.message,{console:!1}),console.error(i)}},callback:n=>{let i=Ki(n);if(!i)throw new O(typeof n.data("sceneId")=="string"?n.data("sceneId"):typeof n.data("sceneId"));let r=this.GetSceneTransition(i)??[];if(!(Array.isArray(r)&&r.length))return;let o=new fe({scene:i.id??""}),a={...fe.DefaultSettings,id:foundry.utils.randomID(),...o.config};P.executeSequence([a,...r])}},{name:"BATTLETRANSITIONS.NAVIGATION.CUSTOM",icon:"<i class='fas fa-fw fa-hammer'></i>",condition:n=>{let i=Ki(n);return i?i.id!==canvas?.scene?.id:!1},callback:n=>{let i=n.data("sceneId"),r=game.scenes?.get(i);if(!(r instanceof Scene))throw new O(typeof i=="string"?i:typeof i);r.canUserModify(game.user,"update")&&P.BuildTransition(r)}})}static SetSceneConfiguration(e,n){let i={...n},r=e.flags["battle-transitions"];for(let o in r)Object.keys(i).includes(o)||(i[`-=${o}`]=null);return e.update({flags:{"battle-transitions":i}})}static GetSceneConfiguration(e){let n=e.flags["battle-transitions"];return n?Ne.SceneConfiguration.NeedsMigration(n)?Ne.SceneConfiguration.Migrate(n):n:{autoTrigger:!1,version:Ne.SceneConfiguration.NewestVersion,sequence:[]}}static GetSceneTransition(e){return t.GetSceneConfiguration(e).sequence}static async InjectSceneConfig(e,n,i){let r=t.GetSceneConfiguration(e.object);game.release?.isNewer("12")?await Jn.inject(e,n,i,r):await Vn.inject(e,n,i,t.GetSceneConfiguration(e.object))}static BuildTransitionFromForm(e){let n=[];return e.find("#transition-step-list [data-transition-type]").each((i,r)=>{let o=r.dataset.flag??"",a=JSON.parse(o);n.push(a)}),n}};function Ki(t){let e=t.data("sceneId");if(!e)return;if(!e)throw new O(typeof e=="string"?e:typeof e);let n=game.scenes?.get(e);if(!(n instanceof Scene))throw new O(typeof e=="string"?e:typeof e);return n}var Vn=class extends SceneConfig{static async inject(e,n,i,r){let o=await renderTemplate("/modules/battle-transitions/templates/config/scene-nav-bar.hbs",{});n.find("nav.sheet-tabs.tabs").append(o);let s=await renderTemplate("/modules/battle-transitions/templates/scene-config.hbs",r);n.find('button[type="submit"]').before(`<div class="tab" data-tab="battle-transitions">${s}</div>`),Hf(e,n)}};function Hf(t,e){e.find("button[data-action='add-step']").on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),$f(t,e))}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),e.find('button[data-action="export-json"]').on("click",n=>{if($(n.currentTarget).is(":visible")){n.preventDefault();let i=N(e);Qn(i,`${t.document.name}.json`)}}),e.find('button[data-action="import-json"]').on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),qf(t,e))}),e.find("button[type='submit']").on("click",()=>{let n=e.find("#auto-trigger").is(":checked")??!1,i=N(e);Ee.SetSceneConfiguration(t.document,{version:"1.1.0",autoTrigger:n,isTriggered:!1,sequence:i})}),e.find("[data-action='clear-steps']").on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),Wf(t,e))}),Zi(e)}async function $f(t,e){let n=await ce();if(!n)return;let i=I(n);if(!i)throw new T(n);let r=null;i.skipConfig?r={...i.DefaultSettings,id:foundry.utils.randomID()}:r=await q(i.DefaultSettings,void 0,t.document),r&&(await er(t,e,r),t.setPosition())}function Bf(t,e,n,i){n.find("[data-action='remove']").on("click",()=>{let r=I(i.type);if(!r)throw new T(i.type);F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)})).then(o=>{o&&(n.remove(),t.setPosition())}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{q(i,void 0,t.document).then(r=>{if(r)return er(t,e,r)}).then(()=>{}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})})}async function Wf(t,e){await F("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.TITLE",u("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.MESSAGE"))&&(e.find("#transition-step-list").children().remove(),await ms(e),Zi(e),t.setPosition())}function Zi(t){N(t).length?t.find("#clear-steps").removeAttr("disabled"):t.find("#clear-steps").attr("disabled","true")}async function ms(t){let e=N(t),n=await W(e);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(n)}))}async function qf(t,e){try{if(N(e).length&&!await F("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.TITLE",u("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.MESSAGE")))return;let i=await _n();if(!i)return;e.find("#transition-step-list").children().remove();for(let r of i)await er(t,e,r)}catch(n){ui.notifications?.error(n.message,{console:!1}),console.error(n)}}async function er(t,e,n){let i=I(n.type);if(!i)throw new T(n.type);let r=[...N(e),n],o=i.getDuration(n,r),a=o instanceof Promise?await o:o;await ms(e);let s=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...i.DefaultSettings,...n,name:u(`BATTLETRANSITIONS.${i.name}.NAME`),description:u(`BATTLETRANSITIONS.${i.name}.DESCRIPTION`),type:i.key,calculatedDuration:a,skipConfig:i.skipConfig,newScene:t.document.uuid,flag:JSON.stringify({...i.DefaultSettings,...n})}),c=$(s),l=e.find(`[data-id="${n.id}"]`);l.length?l.replaceWith(c):e.find("#transition-step-list").append(c),t.setPosition(),Zi(e),Bf(t,e,c,n)}var Jn=class extends SceneConfig{static async inject(e,n,i,r){let o=await renderTemplate("/modules/battle-transitions/templates/config/scene-nav-bar.hbs",{});n.find("nav.sheet-tabs.tabs[data-group='main']").append(o);let s=await renderTemplate("/modules/battle-transitions/templates/scene-config.hbs",r);n.find("footer.sheet-footer").before(`<div class="tab" data-group="main" data-tab="battle-transitions">${s}</div>`);for(let c of r.sequence)await jn(e,n,c);Xf(e,n)}};function Xf(t,e){e.find('button[data-action="add-step"]').on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),Gf(t,e))}),e.find("#transition-step-list").sortable({handle:".drag-handle",containment:"parent",axis:"y"}),e.find('[data-action="export-json"]').on("click",n=>{if($(n.currentTarget).is(":visible")){n.preventDefault();let i=N(e);Qn(i,`${t.document.name}.json`)}}),e.find('[data-action="import-json"]').on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),Vf(t,e))}),e.find(".sheet-footer button[type='submit']").on("click",()=>{let n=e.find("#auto-trigger").is(":checked")??!1,i=N(e);Ee.SetSceneConfiguration(t.document,{version:"1.1.0",autoTrigger:n,isTriggered:!1,sequence:i})}),e.find("[data-action='clear-steps']").on("click",n=>{$(n.currentTarget).is(":visible")&&(n.preventDefault(),zf(t,e))}),tr(e)}async function Gf(t,e){let n=await ce();if(!n)return;let i=I(n);if(!i)throw new T(n);let r=null;i.skipConfig?r={...i.DefaultSettings,id:foundry.utils.randomID()}:r=await q(i.DefaultSettings,void 0,t.document),r&&(await jn(t,e,r),t.setPosition())}function Uf(t,e,n,i){n.find("[data-action='remove']").on("click",()=>{let r=I(i.type);if(!r)throw new T(i.type);F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u(`BATTLETRANSITIONS.${r.name}.NAME`)})).then(o=>{o&&(n.remove(),t.setPosition())}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})}),n.find("[data-action='configure']").on("click",()=>{q(i,void 0,t.document).then(r=>{if(r)return jn(t,e,r)}).then(()=>{}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})})}async function zf(t,e){await F("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.TITLE",u("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.MESSAGE"))&&(e.find("#transition-step-list").children().remove(),await ds(e),tr(e),t.setPosition())}function tr(t){N(t).length?t.find("#clear-steps").removeAttr("disabled"):t.find("#clear-steps").attr("disabled","true")}async function ds(t){let e=N(t),n=await W(e);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(n)}))}async function Vf(t,e){try{if(N(e).length&&!await F("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.TITLE",u("BATTLETRANSITIONS.DIALOGS.IMPORTCONFIRM.MESSAGE")))return;let i=await _n();if(!i)return;e.find("#transition-step-list").children().remove();for(let r of i)await jn(t,e,r)}catch(n){ui.notifications?.error(n.message,{console:!1}),console.error(n)}}async function jn(t,e,n){let i=I(n.type);if(!i)throw new T(n.type);let r=[...N(e),n],o=i.getDuration(n,r),a=o instanceof Promise?await o:o;await ds(e);let s=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...i.DefaultSettings,...n,name:u(`BATTLETRANSITIONS.${i.name}.NAME`),description:u(`BATTLETRANSITIONS.${i.name}.DESCRIPTION`),type:i.key,calculatedDuration:a,skipConfig:i.skipConfig,newScene:t.document.uuid,flag:JSON.stringify({...i.DefaultSettings,...n})}),c=$(s),l=e.find(`[data-id="${n.id}"]`);l.length?l.replaceWith(c):e.find("#transition-step-list").append(c),t.setPosition(),tr(e),Uf(t,e,c,n)}var P=class t{#e=[];static Filters=eo;static SuppressSoundUpdates=!1;constructor(e){try{if(e){let n=Yt(e);if(!(n instanceof Scene))throw new O(typeof e=="string"?e:typeof e);if(n.id===canvas?.scene?.id)throw new jt;this.#e.push({type:"scenechange",scene:n.id})}}catch(n){throw ui.notifications?.error(n.message),n}}get sequence(){return this.#e}static async BuildTransition(e){let n=await ho(e);n&&await t.executeSequence(n)}static async SelectScene(e=!1){let n=await renderTemplate("/modules/battle-transitions/templates/scene-selector.hbs",{scenes:game.scenes?.contents.reduce((i,r)=>e&&r.id===game.scenes?.current?.id?i:[...i,{id:r.id,name:r.name}],[])});return Le()?foundry.applications.api.DialogV2.wait({window:{title:u("BATTLETRANSITIONS.SCENESELECTOR.TITLE")},content:n,buttons:[{label:`<i class="fas fa-times"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL")}`,action:"cancel",callback:()=>Promise.resolve(null)},{label:`<i class="fas fa-check"></i> ${u("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK")}`,action:"ok",callback:(i,r,o)=>Promise.resolve(game.scenes?.get($(o).find("#scene").val())??null)}]}):Dialog.wait({title:u("BATTLETRANSITIONS.SCENESELECTOR.TITLE"),content:n,default:"ok",buttons:{cancel:{icon:'<i class="fas fa-times"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL"),callback:()=>null},ok:{icon:'<i class="fas fa-check"></i>',label:u("BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"),callback:i=>game.scenes?.get($(i).find("#scene").val())??null}}})}static async executePreparedSequence(e){let n=Wt[e];if(!n)throw new T(typeof n);Hooks.callAll(pe.TRANSITION_START,n.original);let i=null;try{i=await Ss(),n.overlay=[...i.children],Es(),t.SuppressSoundUpdates=!0;for(let r of n.prepared.sequence){(r.config.backgroundType==="overlay"||r.config.serializedTexture==="overlay")&&(r.config.deserializedTexture=i.children[0].texture);let o=r.execute(i,n.original,n);o instanceof Promise&&await o}t.SuppressSoundUpdates=!1;for(let r of n.prepared.sequence)await r.teardown(i);Ts(n.prepared)}catch(r){ui.notifications?.error(r.message,{console:!1}),console.error(r)}finally{setTimeout(()=>{hs()},250),i&&bs(i),n?Hooks.callAll(pe.TRANSITION_END,n.original):Hooks.callAll(pe.TRANSITION_END),delete Wt[e]}}static async executeSequence(e){if(e[0].type!=="scenechange")throw new O("undefined");let n=game.scenes?.get(e[0].scene);if(!(n instanceof Scene))throw new O(typeof e[0].scene=="string"?e[0].scene:typeof e[0].scene);if(!n.canUserModify(game.user,"update"))throw new Jt;await Ct.execute(e)}static async prepareSequence(e){try{let n=[];for(let i of e.sequence){let r={...i},o=Jf(r);if(!o)throw new T(typeof r.type=="string"?r.type:typeof r.type);if(Object.prototype.hasOwnProperty.call(r,"backgroundType")){let s=r;if(s.serializedTexture)s.deserializedTexture=Yn(s.serializedTexture);else switch(s.backgroundType){case"color":s.deserializedTexture=Yn(s.backgroundColor??"transparent");break;case"image":s.deserializedTexture=Yn(s.backgroundImage??"transparent");break}}let a=o.prepare(e);a instanceof Promise&&await a,n.push(o)}return Wt[e.id]={original:e,prepared:{...e,sequence:n,sceneFilters:[]},overlay:[]},n}catch(n){return ui.notifications?.error(n.message,{console:!1}),console.error(n),[]}}static async teardownSequence(e,n){for(let i of n.sequence)await i.teardown(e)}static async validateSequence(e){try{let n=[];for(let i of e){let r=I(i.type);if(!r)throw new T(i.type);let o=await r.validate(i,e);if(o instanceof Error)return o;n.push(o)}return n}catch(n){return n}}angularWipe(e=1e3,n="transparent",i="none"){let r=X(n);return this.#e.push({type:"angularwipe",duration:e,serializedTexture:r,easing:i}),this}barWipe(e,n,i=1e3,r="transparent",o="none"){let a=X(r),s=I("barwipe");if(!s)throw new T("barwipe");return this.#e.push({...s.DefaultSettings,duration:i,bars:e,easing:o,direction:n,serializedTexture:a}),this}bilinearWipe(e,n,i=1e3,r="transparent",o="none"){let a=X(r);return this.#e.push({type:"bilinearwipe",serializedTexture:a,duration:i,direction:e,radial:n,easing:o}),this}bossSplash(e){let n=I("bosssplash");if(!n)throw new T("bosssplash");let i={...n.DefaultSettings,...e};return this.#e.push(i),this}burn(e=1e3,n=1.3,i="none"){return this.#e.push({type:"firedissolve",duration:e,burnSize:n,easing:i}),this}clearEffects(){let e=I("cleareffects");if(!e)throw new T("cleareffects");return this.#e.push({...e.DefaultSettings,id:foundry.utils.randomID()}),this}clockWipe(e,n,i=1e3,r="transparent",o="none"){let a=X(r);return this.#e.push({type:"clockwipe",serializedTexture:a,duration:i,clockDirection:e,direction:n,easing:o}),this}diamondWipe(e=40,n=1e3,i="transparent",r="none"){let o=X(i);return this.#e.push({type:"diamondwipe",serializedTexture:o,size:e,duration:n,easing:r}),this}async execute(){if(!(Array.isArray(this.#e)&&this.#e.length))throw new T(typeof this.#e);await Ct.execute(this.#e)}fade(e=1e3,n="transparent",i="none"){let r=X(n);return this.#e.push({type:"fade",serializedTexture:r,duration:e,easing:i}),this}flash(e,n){let i=I("flash");if(!i)throw new T("flash");let r=X(e);return this.#e.push({...i.DefaultSettings,duration:n,serializedTexture:r}),this}hideOverlay(){return this.#e.push({id:foundry.utils.randomID(),type:"removeoverlay",version:"1.1.0"}),this}hueShift(e,n=0){let i=I("hueshift");if(!i)throw new T("hueshift");let r={...i.DefaultSettings,maxShift:e,duration:n};return this.#e.push(r),this}invert(){let e=I("invert");if(!e)throw new T("invert");return this.#e.push({...e.DefaultSettings,id:foundry.utils.randomID()}),this}linearWipe(e,n=1e3,i="transparent",r="none"){let o=X(i);return this.#e.push({type:"linearwipe",serializedTexture:o,direction:e,duration:n,backgroundType:gs(i),easing:r}),this}loadingTip(e,n="bottomcenter",...i){let r=I("loadingtip");if(!r)throw new T("loadingtip");let o=typeof i[0]=="number"?i[0]:0,a=null;i[1]instanceof PIXI.HTMLTextStyle?a=i[1]:i[0]instanceof PIXI.HTMLTextStyle?a=i[0]:(a=new PIXI.HTMLTextStyle,ot(a,PIXI.HTMLTextStyle.defaultStyle),ot(a,r.DefaultSettings.style));let s=typeof foundry.utils.parseUuid=="function"?foundry.utils.parseUuid(e):parseUuid(e),c={...r.DefaultSettings,duration:o,location:n};if(s&&s.type===RollTable.documentName){let l=fromUuidSync(e);l instanceof RollTable&&(c.source="rolltable",c.table=l.uuid)}else c.source="string",c.message=e;return c.style=JSON.parse(JSON.stringify(a)),this.#e.push(c),this}macro(e){let n=Or(e);if(!n)throw new Ke(typeof e=="string"?e:typeof e);return this.#e.push({type:"macro",macro:n.uuid}),this}melt(e=1e3,n="transparent",i="none"){let r=X(n);return this.#e.push({type:"melt",serializedTexture:r,duration:e,easing:i}),this}parallel(...e){let n=[];for(let o of e){let a=o(new t);if(a instanceof Promise)throw new Vt;n.push(a.sequence)}let i=I("parallel");if(!i)throw new T("parallel");let r={...i?.DefaultSettings,id:foundry.utils.randomID(),sequences:n};return this.#e.push(r),this}pixelate(e=100,n=1e3){let i=I("pixelate");if(!i)throw new T("pixelate");let r={...i.DefaultSettings,maxSize:e,duration:n};return this.#e.push(r),this}radialWipe(e,n=1e3,...i){let r=I("radialwipe");if(!r)throw new T("radialwipe");let o="transparent",a="none",s=[.5,.5];Array.isArray(i[0])||typeof i[0]=="string"&&fromUuidSync(i[0])?(s=i[0],o=i[1]??"transparent",a=i[2]??"none"):typeof i[0]=="string"&&(o=i[0]??"transparent",a=i[1]??"none");let c=X(o),l={...r.DefaultSettings,serializedTexture:c,radial:e,duration:n,easing:a};if(Array.isArray(s))l.target=s;else if(typeof s=="string"&&fromUuidSync(s))l.target=s;else if(typeof s.uuid=="string")l.target=s.uuid;else throw new D(s);return this.#e.push(l),this}removeOverlay(){return ui.notifications?.warn("BATTLETRANSITIONS.WARNINGS.REMOVEOVERLAYDEPRECATION",{localize:!0}),this.hideOverlay()}repeat(e,...n){let i=typeof n[0]=="number"?n[0]:0,r=typeof n[0]=="number"?n[1]:n[0];if(typeof r=="function"&&!this.#e.some(a=>a.type!=="scenechange"))throw new Ze;let o=I("repeat");if(!o)throw new T("repeat");if(r){let a=new t,s=r(a);if(s instanceof Promise)throw new Qt;this.#e.push({...o.DefaultSettings,id:foundry.utils.randomID(),iterations:e,delay:i,style:"sequence",sequence:s.sequence})}else this.#e.push({...o.DefaultSettings,iterations:e-1,delay:i,style:"previous"});return this}restoreOverlay(){return ui.notifications?.warn("BATTLETRANSITIONS.WARNINGS.RESTOREOVERLAYDEPRECATION",{localize:!0}),this.showOverlay()}reverse(e=0){let n=I("reverse");if(!n)throw new T("reverse");if(this.#e.length===0)throw new T("reverse");let i=I(this.#e[this.#e.length-1].type);if(!i)throw new T("reverse");if(!i.reversible)throw new et(i.key);let r={...n.DefaultSettings,delay:e,id:foundry.utils.randomID()};return Qe("Adding reverse:",r),this.#e.push(r),this}showOverlay(){return this.#e.push({id:foundry.utils.randomID(),type:"restoreoverlay",version:"1.1.0"}),this}sound(e,n=100){let i=typeof e=="string"?e:e instanceof Sound?e.id:null;if(!i)throw new Xt(typeof e=="string"?e:typeof e);return this.#e.push({type:"sound",volume:n,file:i}),this}spiralShutter(e,n,i=1e3,r="transparent",o="none"){let a=X(r);return this.#e.push({type:"spiralradialwipe",serializedTexture:a,duration:i,easing:o,direction:e,radial:n}),this}spiralWipe(e,n,i,r=1e3,o="transparent",a="none"){let s=X(o),c=typeof s=="string"&&be(s)?"color":"image";return this.#e.push({type:"spiralwipe",version:"1.1.0",duration:r,direction:i,clockDirection:e,radial:n,easing:a,bgSizingMode:"stretch",backgroundType:c,serializedTexture:s}),this}spotlightWipe(e,n,i=1e3,r="transparent",o="none"){let a=X(r);return this.#e.push({type:"spotlightwipe",direction:e,radial:n,duration:i,serializedTexture:a,easing:o}),this}textureSwap(e){let n=X(e);return this.#e.push({type:"textureswap",serializedTexture:n}),this}twist(e=1e3,n="clockwise",i=10){return this.#e.push({type:"twist",duration:e,direction:n,maxAngle:i}),this}video(e,...n){let i=n.find(s=>typeof s=="number")??100,r=n.find(s=>typeof s=="boolean")??!1,o=n.find(s=>!(typeof s=="boolean"||typeof s=="number"))??"transparent",a=X(o);return this.#e.push({type:"video",volume:i,file:e,serializedTexture:a,clear:r}),this}wait(e){return this.#e.push({type:"wait",duration:e}),this}waveWipe(e,n=1e3,i="transparent",r="none"){let o=X(i);return this.#e.push({type:"wavewipe",serializedTexture:o,direction:e,duration:n,easing:r}),this}zoom(e,n=1e3,i=[.5,.5],r=!1,o="transparent",a="none"){let s=I("zoom");if(!s)throw new T("zoom");let c=X(o),l={...s.DefaultSettings,amount:e,duration:n,clampBounds:r,serializedTexture:c,easing:a};if(Array.isArray(i))l.target=i;else if(typeof i=="string"&&fromUuidSync(i))l.target=i;else if(typeof i.uuid=="string")l.target=i.uuid;else throw new D(i);return this.#e.push(l),this}zoomBlur(e=1e3,n=.5,i=0){return this.#e.push({type:"zoomblur",duration:e,maxStrength:n,innerRadius:i}),this}};function Jf(t){let e=I(t.type);if(!e)throw new T(t.type);return e.from(t)}var Ft=class t extends m{#e=[];static DefaultSettings={id:"",type:"parallel",version:"1.1.0",sequences:[]};static category="technical";static hidden=!1;static icon='<i class="fas fa-fw fa-arrows-down-to-line"></i>';static key="parallel";static name="PARALLEL";static template="parallel-config";get preparedSequences(){return this.#e}static RenderTemplate(e,n,i){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},oldScene:n?.id??"",newScene:i?.id??""})}static async addEventListeners(e,n){if(Array.isArray(n?.sequences)&&n.sequences.length)for(let i of n.sequences)await Kn(e,i);else await Kn(e,[]),await Kn(e,[]);nr(e,0),e.find('button[data-action="add-sequence"]').on("click",i=>{i.preventDefault(),Kn(e,[]).then(()=>{let r=e.find("#sequence-list .sequence-item").length-1;nr(e,r)}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})}),e.find("[data-action='add-step']").on("click",i=>{i.preventDefault(),_f(e)}),e.find("#selected-sequence-steps").sortable({handle:".drag-handle",containment:"parent",axis:"y"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static async getDuration(e){let n=0;for(let i of e.sequences){let r=await W(i);r>n&&(n=r)}return n}static fromFormElement(e){let n=[],i=$(e);i.find(".sequence-item").each((o,a)=>{if(!a.dataset.sequence)return;let s=JSON.parse(a.dataset.sequence);n.push(s)});let r={...t.DefaultSettings,...d(i,"id","label"),sequences:n};return new t(r)}async execute(e,n,i){await Promise.all(this.#e.map(r=>this.executeSequence(e,n,r,i)))}async prepare(e){let n={...t.DefaultSettings,...this.config};this.#e=[];for(let i of n.sequences){let r=await P.prepareSequence({...e,sequence:i});this.#e.push(r)}}async teardown(e){for(let n of this.#e)for(let i of n)await i.teardown(e)}async executeSequence(e,n,i,r){for(let o of i){let a=o.execute(e,n,r);a instanceof Promise&&await a}}};async function Kn(t,e=[]){let n=t.find("#sequence-list .sequence-item").length,i=await renderTemplate("/modules/battle-transitions/templates/config/sequence-item.hbs",{index:n,sequence:e,serialized:JSON.stringify(e),name:u("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:n+1})}),r=$(i);t.find("button[data-action='add-sequence']").before(r),Qf(r)}function Qf(t){t.find("[data-action='configure']").on("click",()=>{let e=t.data("index");nr(t.parents("[data-transition-type='parallel']"),e)}),t.find("[data-action='remove']").on("click",e=>{e.preventDefault();let n=t.data("index");F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:n})}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:n})})).then(i=>{if(i){let r=t.parents("#sequence-list");t.remove(),Yf(r)}}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})})}async function _f(t){let e=await ce();if(!e)return;let n=I(e);if(!n)throw new T(e);let i=t.find("#oldScene").val()??"",r=t.find("#newScene").val()??"",o=n.skipConfig?{...n.DefaultSettings,id:foundry.utils.randomID()}:await q(n.DefaultSettings,game.scenes?.get(i),game.scenes?.get(r));o&&ir(t,o)}function jf(t,e,n){e.find("[data-action='remove']").on("click",()=>{let i=I(n.type);if(!i)throw new T(n.type);F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u(`BATTLETRANSITIONS.${i.name}.NAME`)}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u(`BATTLETRANSITIONS.${i.name}.NAME`)})).then(r=>{r&&e.remove()}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})}),e.find("[data-action='configure']").on("click",()=>{let i=t.find("#oldScene").val()??"",r=t.find("#newScene").val()??"";q(n,game.scenes?.get(i),game.scenes?.get(r)).then(o=>{if(o)return ir(t,o)}).then(()=>{}).catch(o=>{ui.notifications?.error(o.message,{console:!1}),console.error(o)})})}function Is(t){let e=[];return t.find("#selected-sequence-steps [data-transition-type]").each((n,i)=>{let r=i.dataset.flag??"";if(!r)return;let o=JSON.parse(r);e.push(o)}),e}function Yf(t){t.find("[data-sequence]").each((e,n)=>{$(n).data("index",e),$(n).find("[data-action='configure']").text(u("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:e+1}))})}async function nr(t,e){let i=t.find(`.sequence-item[data-index="${e}"]`).attr("data-sequence"),r=JSON.parse(i),o=t.find("#selected-sequence");o.data("index",e),o.find("#sequence-name").text(u("BATTLETRANSITIONS.SCENECONFIG.PARALLEL.SEQUENCE",{index:e+1})),o.find("#selected-sequence-steps").children().remove();for(let s of r){if(!I(s.type))throw new T(typeof s.type=="string"?s.type:typeof s.type);await ir(t,s)}}async function ir(t,e){let n=I(e.type);if(!n)throw new T(e.type);let i=[...Is(t),e],r=n.getDuration(e,i),o=r instanceof Promise?await r:r,a=await W(i);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(a)}));let s=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...n.DefaultSettings,...e,name:u(`BATTLETRANSITIONS.${n.name}.NAME`),description:u(`BATTLETRANSITIONS.${n.name}.DESCRIPTION`),type:n.key,calculatedDuration:o,flag:JSON.stringify({...n.DefaultSettings,...e})}),c=$(s),l=t.find(`[data-id="${e.id}"]`);l.length?l.replaceWith(c):t.find("#selected-sequence-steps").append(c),jf(t,c,e);let p=c.parents("[data-index]").data("index"),f=Is(t);t.find(`#sequence-list [data-index="${p}"]`).attr("data-sequence",JSON.stringify(f))}var rr=class t extends m{static DefaultSettings={id:"",type:"pixelate",version:"1.1.0",maxSize:100,duration:1e3,easing:"none",applyToScene:!1,applyToOverlay:!0};static category="effect";static hidden=!1;static icon='<i class="fas fa-fw fa-image"></i>';static key="pixelate";static name="PIXELATE";static template="pixelate-config";static reversible=!0;static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#dualStyle").val();return new t({...t.DefaultSettings,...d(n,"id","duration","maxSize","label"),applyToOverlay:i==="overlay"||i==="both",applyToScene:i==="scene"||i==="both"})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;#t=[];async reverse(){let e={...t.DefaultSettings,...this.config};await Promise.all(this.#t.map(n=>TweenMax.to(n.uniforms.size,{0:1,1:1,duration:e.duration/1e3,ease:e.easing})))}teardown(){this.#e&&M(this.#e),this.#e=null}async execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=[];if(r.applyToOverlay){let a=new PIXI.filters.PixelateFilter(1);this.addFilter(e,a),o.push(a)}if(r.applyToScene&&canvas?.stage){let a=new PIXI.filters.PixelateFilter(1);_(a,i.prepared),o.push(a),this.#e=a}this.#t=[...o],await Promise.all(o.map(a=>TweenMax.to(a.uniforms.size,{0:r.maxSize,1:r.maxSize,duration:r.duration/1e3,ease:r.easing})))}};function V(t){t.find("button[data-action] i.fa-spinner").css("display","none");let e=t.find("[data-select-mode]").data("select-mode")||"0",n=parseInt(t.find("[data-select-hook]").data("select-hook")||"0")||0,i=parseInt(t.find("[data-select-hint]").data("select-hint")||"0")||0;switch(e){case"oldtoken":case"newtoken":n&&Hooks.off("controlToken",n),i&&ui.notifications&&ui.notifications.remove(i);break;case"oldtile":case"newtile":n&&Hooks.off("controlTile",n),i&&ui.notifications&&ui.notifications.remove(i);break;case"oldnote":case"newnote":n&&Hooks.off("activateNote",n),i&&ui.notifications&&ui.notifications.remove(i);break;case"olddrawing":case"newdrawing":n&&Hooks.off("controlDrawing",n),i&&ui.notifications&&ui.notifications.remove(i);break}t.find("[data-select-hook]").data("select-hook",""),t.find("[data-select-hint]").data("select-hint",""),t.find("[data-select-scene]").data("select-scene","")}function ys(t){if(t instanceof Token)return[t.mesh.width,t.mesh.height];if(t instanceof TokenDocument&&t.object instanceof Token)return[t.object.mesh.width,t.object.mesh.height];if(t instanceof Tile)return[t.document.width,t.document.height];if(t instanceof TileDocument)return[t.width,t.height];if(t instanceof Note||t instanceof NoteDocument)return[0,0];if(t instanceof Drawing)return[t.width,t.height];if(t instanceof DrawingDocument)return[t.object?.width??0,t.object?.height??0];throw new D(t)}function Pt(t){switch(t.find("#targetType").val()??"point"){case"oldtoken":return t.find("#selectedOldToken").val();case"newtoken":return t.find("#selectedNewToken").val();case"oldtile":return t.find("#selectedOldTile").val();case"newtile":return t.find("#selectedNewTile").val();case"olddrawing":return t.find("#selectedOldDrawing").val();case"newdrawing":return t.find("#selectedNewDrawing").val();case"oldnote":return t.find("#selectedOldNote").val();case"newnote":return t.find("#selectedNewNote").val();case"prompt":return"";case"point":return[parseFloat(t.find("#pointX").val()),parseFloat(t.find("#pointY").val())]}}function Kf(t){return t.find("#targetType").val()??"point"}function Zf(t){return t[0]>=0&&t[0]<=1&&t[1]>=0&&t[1]<=1}function em(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function ws(t,e){return[t/window.innerWidth,e/window.innerHeight]}function we(t){if(t instanceof Token||t instanceof Tile||t instanceof Note){let{x:e,y:n}=t.getGlobalPosition(),[i,r]=ys(t);return ws(e+i/2,n+r/2)}else if(t instanceof TokenDocument||t instanceof TileDocument||t instanceof NoteDocument){if(!t.object)throw new D(t);return we(t.object)}else if(t instanceof Drawing){let{x:e,y:n}=t.getGlobalPosition(),[i,r]=ys(t);return ws(e+i/2,n+r/2)}else if(t instanceof DrawingDocument){if(!t.object)throw new D(t);return we(t.object)}else if(t instanceof Actor){if(!t.token)throw new D(t);return we(t.token)}throw new D(t)}function Zn(t){V(t)}function tm(t){V(t),t.find("[data-action='select-new-drawing'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","newdrawing");let e=Hooks.on("controlDrawing",(n,i)=>{i&&(V(t),t.find("#selectedNewDrawing").val(n.document.uuid))});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.DRAWING.SELECTHINT")}function nm(t){V(t),t.find("[data-action='select-new-note']").css("display","block"),t.find("[data-select-mode]").data("select-mode","newnote");let e=Hooks.on("activateNote",n=>{V(t),t.find("#selectedNewNote").val(n.document.uuid)});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.NOTE.SElECTHINT")}function im(t){V(t),t.find("[data-action='select-new-tile'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","newtile");let e=Hooks.on("controlTile",(n,i)=>{i&&(V(t),t.find("#selectedNewTile").val(n.document.uuid))});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TILE.SELECTHINT")}function rm(t){V(t),t.find("[data-action='select-new-token'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","newtoken");let e=Hooks.on("controlToken",(n,i)=>{i&&(V(t),t.find("#selectedNewToken").val(n.document.uuid))});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TOKEN.SELECTHINT")}function om(t){V(t),t.find("[data-action='select-old-drawing'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","olddrawing");let e=Hooks.on("controlDrawing",(n,i)=>{i&&(V(t),t.find("#selectedOldDrawing").val(n.document.uuid))});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.DRAWING.SELECTHINT")}function am(t){V(t),t.find("[data-action='select-old-note'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","oldnote");let e=Hooks.on("activateNote",n=>{V(t),t.find("#selectedOldNote").val(n.document.uuid)});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.NOTE.SELECTHINT")}function sm(t){V(t),t.find("[data-action='select-old-tile'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","oldtile");let e=Hooks.on("controlTile",(n,i)=>{i&&(V(t),t.find("#selectedOldTile").val(n.document.uuid))});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TILE.SELECTHINT")}function cm(t){V(t),t.find("[data-action='select-old-token'] i").css("display","block"),t.find("[data-select-mode]").data("select-mode","oldtoken");let e=Hooks.on("controlToken",(n,i)=>{i&&(V(t),t.find("#selectedOldToken").val(n.document.uuid))});t.find("[data-select-hook]").data("select-hook",e),Oe(t,"BATTLETRANSITIONS.SCENECONFIG.COMMON.TARGETTYPE.TOKEN.SELECTHINT")}function Oe(t,e){if(ui.notifications){let n=ui.notifications.info(e,{console:!1,localize:!0,permanent:!0});t.find("[data-select-hint]").data("select-hint",n)}}function Mt(t){vs(t),t.find("#targetType").on("input",()=>{vs(t)}),t.find("button[data-action] i.fa-spinner").css("display","none"),t.find("button[data-action] i.fa-spinner").parent().on("click",e=>{switch(e.preventDefault(),$(e.currentTarget).data("action")||""){case"select-old-token":cm(t);break;case"select-new-token":rm(t);break;case"select-old-tile":sm(t);break;case"select-new-tile":im(t);break;case"select-old-note":am(t);break;case"select-new-note":nm(t);break;case"select-old-drawing":om(t);break;case"select-new-drawing":tm(t);break}})}var Cs={prompt:"",point:"#pointX, #pointY",oldtoken:"#selectedOldToken",newtoken:"#selectedNewToken",oldtile:"#selectedOldTile",newtile:"#selectedNewTile",olddrawing:"#selectedOldDrawing",newdrawing:"#selectedNewDrawing",oldnote:"#selectedOldNote",newnote:"#selectedNewNote"};function vs(t){t.find("section[data-target-type]").css("display","none"),t.find("section[data-target-type] input, section[data-target-type] select").removeAttr("required");let e=Kf(t);t.find(`section[data-target-type="${e}"]`).css("display","block"),Cs[e]&&t.find(Cs[e]).attr("required","true")}async function ei(t,e,n){let{target:i}=t;if(em(i)&&Zf(i))return i;if(typeof i=="string"&&i){if(!await fromUuid(i))throw new D(i);let o=foundry.utils.parseUuid(i);if(o.primaryType!=="Scene")throw new D(i);if(e&&e.id===o.primaryId||n&&n.id===o.primaryId)return i}else if(typeof i=="string"){let r=await renderTemplate("/modules/battle-transitions/templates/config/target-selector.hbs",{...nt(e,n),pointX:.5,pointY:.5}),o=await Io("BATTLETRANSITIONS.SCENECONFIG.TARGETTYPE.DIALOG.TITLE",r,{ok:{icon:'<i class="fas fa-check"></i>',label:"BATTLETRANSITIONS.DIALOGS.BUTTONS.OK"},cancel:{icon:'<i class="fas fa-times"></i>',label:"BATTLETRANSITIONS.DIALOGS.BUTTONS.CANCEL",callback:()=>{throw new D(void 0)}}},a=>{Mt(a)});return Pt(o)}throw new D(i)}var or=class t extends m{#e=null;#t=[.5,.5];static DefaultSettings={id:"",type:"radialwipe",easing:"none",radial:"inside",duration:1e3,bgSizingMode:"stretch",version:"1.1.0",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000",target:[.5,.5]};static category="wipe";static hidden=!1;static icon="<i class='bt-icon radial-wipe fa-fw fas'></i>";static key="radialwipe";static name="RADIALWIPE";static reversible=!0;static template="radialwipe-config";static RenderTemplate(e,n,i){let r=ti({...t.DefaultSettings,...e||{}},n,i);return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),radialSelect:ae(),targetType:r,oldScene:n?.id??"",newScene:i?.id??"",selectedTarget:e?e.target:"",...nt(n,i),pointX:Array.isArray(e?.target)?e.target[0]:.5,pointY:Array.isArray(e?.target)?e.target[1]:.5})}static async addEventListeners(e,n){Mt(e)}static editDialogClosed(e){Zn($(e))}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"",r=Pt(n);return new t({...t.DefaultSettings,serializedTexture:i,target:r,...d(n,"id","duration","radial","backgroundType","backgroundColor","easing","label")})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}static async validate(e,n){try{let i=n.reduce((a,s)=>s.type==="scenechange"?s.scene:a,null);if(!i)throw new O(typeof i=="string"?i:typeof i);let r=game.scenes?.get(i);if(!r)throw new O(typeof i=="string"?i:typeof i);let o=await ei({...t.DefaultSettings,...e},canvas?.scene,r);return{...t.DefaultSettings,...e,target:o}}catch(i){return i}}async execute(e){let n={...t.DefaultSettings,...this.config};if(!Array.isArray(n.target)){let o=await fromUuid(n.target);if(!o)throw new D(n.target);let a=foundry.utils.parseUuid(n.target);if(a?.primaryType!=="Scene")throw new D(n.target);a.primaryId===canvas?.scene?.id&&(this.#t=we(o))}let i=n.deserializedTexture??h("transparent"),r=new $e(n.radial,this.#t[0],this.#t[1],i.baseTexture);this.addFilter(e,r),this.#e=r,await this.simpleTween(r)}async prepare(){let e={...t.DefaultSettings,...this.config};if(Array.isArray(e.target))this.#t=e.target;else{let n=await fromUuid(e.target);if(!n)throw new D(e.target);let i=foundry.utils.parseUuid(e.target);if(i?.primaryType!=="Scene")throw new D(e.target);i.primaryId===canvas?.scene?.id&&(this.#t=we(n))}}async reverse(){this.#e instanceof $e&&await this.simpleReverse(this.#e)}};var ar=class t extends m{static DefaultSettings={id:"",type:"removeoverlay",version:"1.1.0"};static hidden=!1;static key="removeoverlay";static name="HIDEOVERLAY";static skipConfig=!0;static template="";static icon="<i class='bt-icon hide-overlay fa-fw fas'></i>";static category="technical";static RenderTemplate(e){throw new te}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,id:foundry.utils.randomID(),...d($(e),"id")})}execute(e,n,i){i.overlay.forEach(r=>r.alpha=0)}};var lm="1.1.0",Ht=class t extends m{static DefaultSettings={id:"",type:"wait",duration:0,version:lm};static category="technical";static hidden=!1;static icon="<i class='bt-icon wait fa-fw fas'></i>";static key="wait";static name="WAIT";static template="wait-config";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e);return new t({...t.DefaultSettings,...d(n,"id","duration","label")})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}execute(){let e={...t.DefaultSettings,...this.config};return new Promise(n=>{setTimeout(n,e.duration)})}};var $t=class t extends m{#e=[];static DefaultSettings={id:"",type:"repeat",version:"1.1.0",style:"previous",delay:0,iterations:2};static category="technical";static hidden=!1;static icon='<i class="fas fa-fw fa-repeat"></i>';static key="repeat";static name="REPEAT";static template="repeat-config";get preparedSequence(){return this.#e}async teardown(e){for(let n of this.#e)await n.teardown(e)}static RenderTemplate(e,n,i){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},oldScene:n?.id??"",newScene:i?.id??"",styleSelect:{sequence:"BATTLETRANSITIONS.SCENECONFIG.REPEAT.SEQUENCE.LABEL",previous:"BATTLETRANSITIONS.SCENECONFIG.REPEAT.PREVIOUS.LABEL"}})}static addEventListeners(e,n){let i=$(e);xs(i),i.find("#style").on("input",()=>{xs(i)}),i.find("[data-action='add-step']").on("click",r=>{r.preventDefault(),um(i)}),i.find("[data-action='clear-steps']").on("click",r=>{$(r.currentTarget).is(":visible")&&(r.preventDefault(),fm(i))}),sr(i)}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=Ls(n);return new t({...t.DefaultSettings,...d(n,"id","iterations","style","delay","label"),id:foundry.utils.randomID(),sequence:i})}static async getDuration(e,n){if(e.style==="previous"){let i=n.findIndex(c=>c.id===e.id);if(i===-1)throw new T(t.key);if(i===0)throw new Ze;let r=n[i-1],o=I(r.type);if(!o)throw new T(typeof r.type=="string"?r.type:typeof r.type);let a=o.getDuration(r,n);return((a instanceof Promise?await a:a)+e.delay)*(e.iterations-1)+e.delay}else return await W(e.sequence??[])+e.delay*e.iterations}async execute(e,n,i){for(let r of this.#e){let o=r.execute(e,n,i);o instanceof Promise&&await o}}async prepare(e){let n={...t.DefaultSettings,...this.config};if(n.style==="sequence"&&!n.sequence?.length)throw new T(t.key);let i=e.sequence.findIndex(s=>s.id===n.id);if(i===-1)throw new T(t.key);let r=e.sequence[i-1];if(!r)throw new T(t.key);let o={...Ht.DefaultSettings,duration:n.delay},a=[];if(n.delay&&n.style==="previous"&&a.push(o),n.style==="previous")for(let s=0;s<n.iterations-1;s++)a.push({...r,id:foundry.utils.randomID()}),n.delay&&a.push(o);else n.style==="sequence"&&(a.push(...n.sequence??[]),n.delay&&a.push(o));this.#e=await P.prepareSequence({...e,sequence:a})}};async function um(t){let e=await ce();if(!e)return;let n=I(e);if(!n)throw new T(e);let i=t.find("#oldScene").val()??"",r=t.find("#newScene").val()??"",o=n.skipConfig?{...n.DefaultSettings,id:foundry.utils.randomID()}:await q(n.DefaultSettings,game.scenes?.get(i),game.scenes?.get(r));o&&Ns(t,o)}function pm(t,e,n){e.find("[data-action='remove']").on("click",()=>{let i=I(n.type);if(!i)throw new T(n.type);F(u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.TITLE",{name:u(`BATTLETRANSITIONS.${i.name}.NAME`)}),u("BATTLETRANSITIONS.DIALOGS.REMOVECONFIRM.CONTENT",{name:u(`BATTLETRANSITIONS.${i.name}.NAME`)})).then(r=>{r&&e.remove()}).catch(r=>{ui.notifications?.error(r.message,{console:!1}),console.error(r)})}),e.find("[data-action='configure']").on("click",()=>{q(n).then(i=>{if(i)return Ns(t,i)}).then(()=>{}).catch(i=>{ui.notifications?.error(i.message,{console:!1}),console.error(i)})})}function Ls(t){let e=[];return t.find("#transition-step-list [data-transition-type]").each((n,i)=>{let r=i.dataset.flag??"";if(!r)return;let o=JSON.parse(r);e.push(o)}),e}function xs(t){let e=t.find("#style").val();t.find("[data-repeat-style='previous']").css("display",e==="previous"?"block":"none"),t.find("[data-repeat-style='sequence']").css("display",e==="sequence"?"block":"none"),t.find("#sequenceContainer").css("display",e==="sequence"?"block":"none")}async function Ns(t,e){let n=I(e.type);if(!n)throw new T(e.type);let i=[...N(t),e],r=n.getDuration(e,i),o=r instanceof Promise?await r:r,a=await W(i);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(a)}));let s=await renderTemplate("/modules/battle-transitions/templates/config/step-item.hbs",{...n.DefaultSettings,...e,name:u(`BATTLETRANSITIONS.${n.name}.NAME`),description:u(`BATTLETRANSITIONS.${n.name}.DESCRIPTION`),calculatedDuration:o,type:n.key,flag:JSON.stringify({...n.DefaultSettings,...e})}),c=$(s),l=t.find(`[data-id="${e.id}"]`);l.length?l.replaceWith(c):t.find("#transition-step-list").append(c),pm(t,c,e);let p=c.parents("[data-index]").data("index"),f=Ls(t);t.find(`#sequence-list [data-index="${p}"]`).attr("data-sequence",JSON.stringify(f)),sr(t)}async function fm(t){await F("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.TITLE",u("BATTLETRANSITIONS.DIALOGS.CLEARSTEPS.MESSAGE"))&&(t.find("#transition-step-list").children().remove(),await mm(t),sr(t))}function sr(t){N(t).length?t.find("#clear-steps").removeAttr("disabled"):t.find("#clear-steps").attr("disabled","true")}async function mm(t){let e=N(t),n=await W(e);t.find("#total-duration").text(u("BATTLETRANSITIONS.SCENECONFIG.TOTALDURATION",{duration:z(n)}))}var cr=class t extends m{static template="";static DefaultSettings={id:"",type:"restoreoverlay",version:"1.1.0"};static hidden=!1;static key="restoreoverlay";static name="SHOWOVERLAY";static skipConfig=!0;static icon="<i class='bt-icon show-overlay fa-fw fas'></i>";static category="technical";static RenderTemplate(e){throw new te}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,id:foundry.utils.randomID(),...d($(e),"id")})}execute(e,n,i){i.overlay.forEach(r=>r.alpha=1)}};function pr(t,e){return e[0]instanceof m?ur(t,e):lr(t,e)}function lr(t,e){for(let n=0;n<e.length;n++){let i=e[n];if(i.id===t&&n>0)return e[n-1];if(i.id===t&&n===0)return;if(i.type==="parallel"){let r=i;for(let o of r.sequences){let a=lr(t,o);if(a)return a}}else if(i.type==="repeat"){let r=i;if(r.sequence&&Array.isArray(r.sequence)){let o=lr(t,r.sequence);if(o)return o}}}}function ur(t,e){for(let n=0;n<e.length;n++){let i=e[n];if(i.config.id===t&&n>0)return e[n-1];if(i.config.id===t&&n===0)return;if(i instanceof Ft)for(let r of i.preparedSequences){let o=ur(t,r);if(o)return o}else if(i instanceof $t){let r=ur(t,i.preparedSequence);if(r)return r}}}var fr=class t extends m{static DefaultSettings={id:"",type:"reverse",version:"1.1.0",delay:0};static category="technical";static hidden=!1;static icon='<i class="fas fa-fw fa-backward"></i>';static key="reverse";static name="REVERSE";static template="reverse-config";static skipConfig=!1;static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,...d($(e),"id","delay")})}static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,...e||{}})}static validate(e,n){let i=pr(e.id,n);if(!i)throw new T("reverse");let r=I(i.type);if(!r)throw new T(typeof i.type=="string"?i.type:typeof i.type);if(!r.reversible)throw new et(r.key);return e}execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=pr(r.id,i.prepared.sequence);if(!o)throw new T("reverse");return r.delay?ge(r.delay).then(()=>o.reverse()):o.reverse()}};var fe=class t extends m{static DefaultSettings={id:"",type:"scenechange",scene:"",version:"1.1.0"};static hidden=!0;static key="scenechange";static name="SCENECHANGE";static template="scenechange-config";static icon="<i class='bt-icon scene-change fa-fw fas'></i>";static category="technical";static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=d($(e),"id","scene");return new t({...t.DefaultSettings,...n})}async execute(e,n){if(this.config.scene===canvas?.scene?.id)throw new _t;n.caller===game.user.id?await Ds({...t.DefaultSettings,...this.config}.scene):await lt(pe.SCENE_ACTIVATED),Os()}async validate(){return game.scenes.get(this.config.scene)instanceof Scene?Promise.resolve(!0):Promise.resolve(new O({...t.DefaultSettings,...this.config}.scene))}};var mr=class t extends m{#e=null;static DefaultSettings={id:"",type:"sound",volume:100,file:"",version:"1.1.0"};static category="technical";static hidden=!1;static icon="<i class='bt-icon sound fa-fw fas'></i>";static key="sound";static name="SOUND";static template="sound-config";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{}})}static addEventListeners(e){let n=$(e);n.find("#file input").attr("required","true"),n.find("form input").trigger("input")}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#file").val()??"",r=n.find("#volume").val()??100;return new t({...t.DefaultSettings,file:i,volume:r,...d(n,"id","label")})}static getDuration(e){return new Promise((n,i)=>{let r=new Audio;r.onloadedmetadata=()=>{n(Math.round(r.duration*1e3))},r.onerror=(o,a,s,c,l)=>{i(l||new Error(o.toString()))},r.src=e.file})}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=await foundry.audio.AudioHelper.play({src:this.config.file,volume:i.volume/100,autoplay:!0},!0);this.#e=r}async prepare(){await foundry.audio.AudioHelper.preloadSound(this.config.file)}teardown(e){this.#e?.stop()}};var dr=class t extends m{static DefaultSettings={id:"",type:"spiralshutter",duration:1e3,direction:"clockwise",radial:"inside",easing:"none",bgSizingMode:"stretch",version:"1.1.0",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon spiral-shutter fa-fw fas'></i>";static key="spiralshutter";static name="SPIRALSHUTTER";static template="spiralshutter-config";static reversible=!0;static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),radialSelect:ae(),directionSelect:xe()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,backgroundImage:i,...d(n,"id","duration","easing","backgroundType","backgroundColor","direction","radial","label")})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;async reverse(){this.#e instanceof Ge&&await this.simpleReverse(this.#e)}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??h("transparent"),o=new Ge(i.direction,i.radial,r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}};var gr=class t extends m{static DefaultSettings={id:"",type:"spiralwipe",duration:1e3,direction:"left",clockDirection:"clockwise",radial:"outside",easing:"none",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon='<i class="fas fa-fw fa-arrows-spin"></i>';static key="spiralwipe";static name="SPIRALWIPE";static template="spiralwipe-config";static reversible=!0;static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),radialSelect:ae(),directionSelect:{top:"BATTLETRANSITIONS.DIRECTIONS.TOP",left:"BATTLETRANSITIONS.DIRECTIONS.LEFT",right:"BATTLETRANSITIONS.DIRECTIONS.RIGHT",bottom:"BATTLETRANSITIONS.DIRECTIONS.BOTTOM"},clockDirectionSelect:xe()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,backgroundImage:i,...d(n,"id","duration","backgroundType","backgroundColor","radial","direction","clockDirection","easing","label")})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;async reverse(){this.#e instanceof Ue&&await this.simpleReverse(this.#e)}async execute(e){let n={...t.DefaultSettings,...this.config},i=n.deserializedTexture??h("transparent"),r=new Ue(n.clockDirection,n.radial,n.direction,i.baseTexture);this.#e=r,this.addFilter(e,r),await this.simpleTween(r)}};var Tr=class t extends m{defaultSettings={duration:1e3,easing:"none"};static DefaultSettings={id:"",type:"spotlightwipe",duration:1e3,easing:"none",direction:"top",radial:"outside",bgSizingMode:"stretch",version:"1.1.0",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon spotlight-wipe fa-fw fas'></i>";static key="spotlightwipe";static name="SPOTLIGHTWIPE";static template="spotlightwipe-config";static reversible=!0;static RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),directionSelect:en(),radialSelect:ae()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,serializedTexture:i,...d(n,"id","duration","direction","radial","backgroundType","backgroundColor","easing","label")})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;async reverse(){this.#e instanceof He&&await this.simpleReverse(this.#e)}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??h("transparent"),o=new He(i.direction,i.radial,r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}};var at=class t extends m{static template="";static hidden=!1;static skipConfig=!0;static key="startplaylist";static name="STARTPLAYLIST";static icon="<i class='bt-icon start-ambient-playlist fa-fw fas'></i>";static category="technical";static DefaultSettings={id:"",type:"startplaylist",version:"1.1.0"};static RenderTemplate(e){throw new te}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){return new t({...t.DefaultSettings,id:foundry.utils.randomID(),...d($(e),"id")})}async prepare(e){let n=e.sequence.filter(i=>i.type==="scenechange");for(let i of n){let r=i,o=game.scenes?.get(r.scene);if(!(o instanceof Scene))throw new O(typeof r.scene=="string"?r.scene:typeof r.scene);if(o.playlist)if(o.playlistSound){let a=typeof o.playlistSound=="string"?o.playlist.sounds.get(o.playlistSound):o.playlistSound;a&&await a.load()}else{let a=o.playlist.playbackOrder[0],s=o.playlist.sounds.get(a);s&&await s.load()}}}execute(e,n){P.SuppressSoundUpdates=!1;let i=n.sequence.reduce((o,a)=>a instanceof fe?a:o);if(!i)throw new O(typeof i);let r=game.scenes?.get(i.scene);if(!(r instanceof Scene))throw new O(i.scene);if(r.canUserModify(game.user,"update"))if(r.playlist&&!r.playlistSound)switch(r.playlist.mode){case CONST.PLAYLIST_MODES.SEQUENTIAL:case CONST.PLAYLIST_MODES.SHUFFLE:if(r.playlist.playbackOrder.length){let o=r.playlist.sounds.get(r.playlist.playbackOrder[0]);o&&r.playlist.playSound(o)}break;case CONST.PLAYLIST_MODES.SIMULTANEOUS:r.playlist.playAll();break}else r.playlist&&r.playlistSound instanceof PlaylistSound&&r.playlist.playSound(r.playlistSound)}};var Sr=class t extends m{defaultSettings={};static DefaultSettings={id:"",type:"textureswap",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000",applyToScene:!1,applyToOverlay:!0};static hidden=!1;static key="textureswap";static name="TEXTURESWAP";static template="textureswap-config";static icon="<i class='bt-icon texture-swap fa-fw fas'></i>";static category="effect";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"",r=n.find("#dualStyle").val();return new t({...t.DefaultSettings,serializedTexture:i,...d(n,"id","backgroundType","backgroundColor","label"),applyToOverlay:r==="overlay"||r==="both",applyToScene:r==="scene"||r==="both"})}#e=null;teardown(){this.#e&&M(this.#e),this.#e=null}execute(e,n,i){let r={...t.DefaultSettings,...this.config};if(r.applyToOverlay){let o=r.deserializedTexture??h("transparent"),a=new oe(o.baseTexture);this.addFilter(e,a)}if(r.applyToScene&&canvas?.stage){let o=r.deserializedTexture??h("transparent"),a=new oe(o.baseTexture);_(a,i.prepared),this.#e=a}}};var br=class t extends m{static DefaultSettings={id:"",type:"twist",version:"1.1.0",duration:1e3,maxAngle:10,easing:"none",direction:"clockwise",applyToScene:!1,applyToOverlay:!0};static category="warp";static hidden=!1;static icon="<i class='bt-icon twist fa-fw fas'></i>";static key="twist";static name="TWIST";static template="twist-config";static reversible=!0;static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},directionSelect:xe(),easingSelect:x(),dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#dualStyle").val();return new t({...t.DefaultSettings,...d(n,"id","duration","direction","easing","label"),applyToOverlay:i==="overlay"||i==="both",applyToScene:i==="scene"||i==="both"})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;teardown(){this.#e&&M(this.#e),this.#e=null}#t=[];async reverse(){let e={...t.DefaultSettings,...this.config};await Promise.all(this.#t.map(n=>TweenMax.to(n.uniforms,{angle:0,duration:e.duration/1e3,ease:e.easing})))}async execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=[];if(r.applyToOverlay){let a=new PIXI.filters.TwistFilter({radius:window.innerWidth,angle:0,offset:{x:window.innerWidth/2,y:window.innerHeight/2}});this.addFilter(e,a),o.push(a)}if(r.applyToScene&&canvas?.stage){let a=new PIXI.filters.TwistFilter({radius:window.innerWidth,angle:0,offset:{x:window.innerWidth/2,y:window.innerHeight/2}});_(a,i.prepared),o.push(a)}this.#t=[...o],await Promise.all(o.map(a=>TweenMax.to(a.uniforms,{angle:this.config.direction==="clockwise"?r.maxAngle*-1:this.config.maxAngle,duration:r.duration/1e3,ease:this.config.easing||"none"})))}};var Er=class t extends m{#e=null;#t=null;static DefaultSettings={id:"",type:"video",volume:100,clear:!1,file:"",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000",videoSizingMode:"stretch",version:"1.1.0"};static hidden=!1;static key="video";static name="VIDEO";static template="video-config";static icon="<i class='bt-icon video fa-fw fas'></i>";static category="effect";static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{}})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static addEventListeners(e){let n=$(e);n.find("#file input").attr("required","true"),n.find("form input").trigger("input")}static fromFormElement(e){let n=$(e).find("#file").val()??"",i=$(e).find("#volume input[type='number']").val(),r=$(e).find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,...n?{file:n}:{},...i?{volume:i/100}:{},serializedTexture:r,...d($(e),"id","background","backgroundType","backgroundColor","label")})}static getDuration(e){return new Promise((n,i)=>{let r=document.createElement("video");r.onloadedmetadata=()=>{n(Math.round(r.duration*1e3))},r.onerror=(o,a,s,c,l)=>{i(l||new Error(o.toString()))},r.src=e.file})}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=this.#e;if(!r)throw new qt(i.file);let o=this.config.deserializedTexture??h("transparent"),s=(r?.baseTexture.resource).source;return new Promise((c,l)=>{let p=new oe(r.baseTexture),f=PIXI.Sprite.from(r),y=PIXI.Sprite.from(o),g=new PIXI.Container;g.addChild(y),y.width=window.innerWidth,y.height=window.innerHeight,g.addChild(f),f.width=window.innerWidth,f.height=window.innerHeight,f.filters=[p],s.currentTime=0,this.#t=g,e.addChild(g),s.addEventListener("ended",()=>{i.clear&&setTimeout(()=>{f.destroy()},500),c()}),s.addEventListener("error",De=>{l(De.error)}),s.play()})}async prepare(){let e={...t.DefaultSettings,...this.config},n=await PIXI.loadVideo.load(e.file);this.#e=n}teardown(e){if(!this.#t)return;let n=[...this.#t.children];for(let i of n)i.destroy();this.#t.destroy()}};var hr=class t extends m{static DefaultSettings={id:"",type:"wavewipe",duration:1e3,easing:"none",direction:"inside",version:"1.1.0",bgSizingMode:"stretch",backgroundType:"color",backgroundImage:"",backgroundColor:"#00000000"};static category="wipe";static hidden=!1;static icon="<i class='bt-icon wave-wipe fa-fw fas'></i>";static key="wavewipe";static name="WAVEWIPE";static template="wavewipe-config";static reversible=!0;static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},radialSelect:ae(),easingSelect:x()})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"";return new t({...t.DefaultSettings,serializedTexture:i,...d(n,"id","label","duration","backgroundType","backgroundColor","easing","direction")})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;async reverse(){this.#e instanceof qe&&await this.simpleReverse(this.#e)}async execute(e,n){let i={...t.DefaultSettings,...this.config},r=this.config.deserializedTexture??h("transparent"),o=new qe(i.direction,r.baseTexture);this.#e=o,this.addFilter(e,o),await this.simpleTween(o)}};var Ir=class t extends m{static DefaultSettings={id:"",type:"zoomblur",version:"1.1.0",duration:1e3,maxStrength:.5,easing:"none",innerRadius:0,applyToOverlay:!0,applyToScene:!1};static category="warp";static hidden=!1;static icon="<i class='bt-icon zoomblur fa-fw fas'></i>";static key="zoomblur";static name="ZOOMBLUR";static template="zoomblur-config";static reversible=!0;static async RenderTemplate(e){return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},easingSelect:x(),dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#maxStrength input[type='number']").val()??1,r=n.find("#innerRadius input[type='number']").val()??0,o=n.find("#dualStyle").val();return new t({...t.DefaultSettings,...d(n,"id","duration","label"),maxStrength:i,innerRadius:r,applyToOverlay:o==="overlay"||o==="both",applyToScene:o==="scene"||o==="both"})}static getDuration(e){return{...t.DefaultSettings,...e}.duration}#e=null;teardown(){this.#e&&M(this.#e),this.#e=null}#t=[];async reverse(){let e={...t.DefaultSettings,...this.config};await Promise.all(this.#t.map(n=>TweenMax.to(n.uniforms,{uStrength:0,duration:e.duration/1e3,ease:e.easing})))}async execute(e,n,i){let r={...t.DefaultSettings,...this.config},o=[];if(r.applyToOverlay){let a=new PIXI.filters.ZoomBlurFilter({strength:0,innerRadius:r.innerRadius*window.innerWidth,radius:-1,center:[window.innerWidth/2,window.innerHeight/2]});this.addFilter(e,a),o.push(a)}if(r.applyToScene&&canvas?.stage){let a=new PIXI.filters.ZoomBlurFilter({strength:0,innerRadius:r.innerRadius*window.innerWidth,radius:-1,center:[window.innerWidth/2,window.innerHeight/2]});this.#e=a,_(a,i.prepared),o.push(a)}this.#t=[...o],await Promise.all(o.map(a=>TweenMax.to(a.uniforms,{uStrength:r.maxStrength,duration:r.duration/1e3,ease:r.easing||"none"})))}};var yr=class t extends m{#e=[];#t=null;#n=[.5,.5];static DefaultSettings={id:"",type:"zoom",duration:1e3,backgroundType:"color",bgSizingMode:"stretch",backgroundColor:"#00000000",version:"1.1.0",easing:"none",amount:0,clampBounds:!1,target:[.5,.5],applyToOverlay:!0,applyToScene:!1};static category="warp";static hidden=!1;static icon='<i class="fas fa-fw fa-magnifying-glass"></i>';static key="zoom";static name="ZOOM";static reversible=!0;static template="zoom-config";static async RenderTemplate(e,n,i){let r=ti({...t.DefaultSettings,...e||{}},n,i);return renderTemplate(`/modules/battle-transitions/templates/config/${t.template}.hbs`,{...t.DefaultSettings,id:foundry.utils.randomID(),...e||{},oldScene:n?.id??"",newScene:i?.id??"",easingSelect:x(),targetType:r,...nt(n,i),pointX:Array.isArray(e?.target)?e.target[0]:.5,pointY:Array.isArray(e?.target)?e.target[1]:.5,dualStyleSelect:J(),dualStyle:e?e.applyToOverlay&&e.applyToScene?"both":e.applyToOverlay?"overlay":e.applyToScene?"scene":"overlay":"overlay"})}static async addEventListeners(e,n){Mt(e),As(e),e.find("#clampBounds").on("change",()=>{As(e)})}static editDialogClosed(e){Zn($(e))}static from(e){return e instanceof HTMLFormElement?t.fromFormElement(e):e[0]instanceof HTMLFormElement?t.fromFormElement(e[0]):new t(e)}static fromFormElement(e){let n=$(e),i=n.find("#backgroundImage").val()??"",r=n.find("#dualStyle").val(),o=Pt(n),a={...t.DefaultSettings,...d(n,"id","label","duration","easing","amount","backgroundType","backgroundColor","clampBounds"),serializedTexture:i,target:o,applyToOverlay:r==="overlay"||r==="both",applyToScene:r==="scene"||r==="both"};return new t(a)}static getDuration(e){return{...t.DefaultSettings,...e}.duration}static async validate(e,n){try{let i=n.reduce((a,s)=>s.type==="scenechange"?s.scene:a,null);if(!i)throw new O(typeof i=="string"?i:typeof i);let r=game.scenes?.get(i);if(!r)throw new O(typeof i=="string"?i:typeof i);let o=await ei({...t.DefaultSettings,...e},canvas?.scene,r);return{...t.DefaultSettings,...e,target:o}}catch(i){return i}}async execute(e,n,i){let r={...t.DefaultSettings,...this.config};if(!Array.isArray(r.target)){let s=await fromUuid(r.target);if(!s)throw new D(r.target);let c=foundry.utils.parseUuid(r.target);if(c?.primaryType!=="Scene")throw new D(r.target);c.primaryId===canvas?.scene?.id&&(this.#n=we(s))}let o=this.config.deserializedTexture??h("transparent"),a=[];if(r.applyToOverlay){let s=new Je(this.#n,r.duration?1:r.amount,r.clampBounds,o.baseTexture);this.addFilter(e,s),a.push(s)}if(r.applyToScene&&canvas?.stage){let s=new Je(this.#n,r.duration?1:r.amount,r.clampBounds,o.baseTexture);_(s,i.prepared),a.push(s),this.#t=s}r.duration&&(this.#e=[...a],await Promise.all(a.map(s=>TweenMax.to(s.uniforms,{amount:r.amount,duration:r.duration/1e3,ease:r.easing}))))}async prepare(){let e={...t.DefaultSettings,...this.config};if(Array.isArray(e.target))this.#n=e.target;else{let n=await fromUuid(e.target);if(!n)throw new D(e.target);let i=foundry.utils.parseUuid(e.target);if(i?.primaryType!=="Scene")throw new D(e.target);i.primaryId===canvas?.scene?.id&&(this.#n=we(n))}}async reverse(){let e={...t.DefaultSettings,...this.config};await Promise.all(this.#e.map(n=>TweenMax.to(n.uniforms,{amount:1,duration:e.duration/1e3,ease:e.easing})))}teardown(){this.#t&&M(this.#t),this.#t=null}};function As(t){t.find("#clampBounds").is(":checked")?t.find(".background-selector").css("display","none"):t.find(".background-selector").css("display","block")}async function lt(t){return new Promise(e=>{Hooks.once(t,(...n)=>{e(n)})})}function h(t){let e=document.createElement("canvas");e.width=1,e.height=1;let n=e.getContext("2d");if(!n)throw new he;let i=new PIXI.Color(t);return n.fillStyle=i.toHexa(),n.fillRect(0,0,1,1),PIXI.Texture.from(e)}function Br(t,e,n){let i=document.createElement("canvas");i.width=t,i.height=1;let r=i.getContext("2d");if(!r)throw new he;let o=r.createLinearGradient(0,0,t,0),a=e??new PIXI.Color("white"),s=n??new PIXI.Color("black");return o.addColorStop(0,a.toHex()),o.addColorStop(1,s.toHex()),r.fillStyle=o,r.fillRect(0,0,t,1),PIXI.Texture.from(i)}function Wr(t=256,e=256,n){let i=Fr(n),r=document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new he;r.width=t,r.height=e;let a=o.createImageData(r.width,r.height),s=a.data;for(let c=0;c<r.height;c++)for(let l=0;l<r.width;l++){let p=i(l/32,c/32),f=(c*r.width+l)*4;s[f]=p*255,s[f+1]=p*255,s[f+2]=p*255,s[f+3]=255}return o.putImageData(a,0,0),PIXI.Texture.from(r)}function Rs(t){let e=atob(t.split(",")[1]),n=new Uint8Array(e.length);for(let i=0;i<n.length;i++)n[i]=e.charCodeAt(i);return n}function dm(t){let e=Pr(t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer):t.buffer);return PIXI.Texture.from(`data:${t.mimeType};base64,${e}`)}function Yn(t){if(typeof t=="string")return L(t)??h("transparent");let e=t;if(e.buffer&&e.mimeType)return dm(e);let n=t;if(n.buffer&&n.width&&n.height)return gm(n);throw new H}function gm(t){return PIXI.Texture.fromBuffer(t.buffer,t.width,t.height)}function Tm(t){return typeof t=="number"?!0:typeof t=="string"?parseFloat(t).toString()===t:!1}function wr(t,e){let n=t.find(({name:i})=>i===e);if(e==="background"){let i=t.find(({name:r})=>r==="backgroundType");return i?i.value==="image"?wr(t,"backgroundImage"):wr(t,"backgroundColor"):null}return n?e==="id"&&!n.value?foundry.utils.randomID():Tm(n.value)?parseFloat(n.value):n.value:null}function rn(){return Object.values(ni).sort((t,e)=>u(`BATTLETRANSITIONS.TRANSITIONTYPES.${t.name}`).localeCompare(u(`BATTLETRANSITIONS.TRANSITIONTYPES.${e.name}`)))}function I(t){return Object.values(ni).find(e=>e.key===t)}function u(t,e={}){return game.i18n?.format(t,e)??t}function Qe(...t){console.log(Nr,"Battle Transitions","|",...t)}function d(t,...e){let n=t.serializeArray();return Object.fromEntries(e.map(r=>[r,wr(n,r)]))}function Sm(t){let e=Rs(t.toDataURL());return{width:t.width,height:t.height,buffer:e}}function bm(t){let e=Rs(t);return{mimeType:t.split(";")[0].split(":")[1],buffer:e}}function X(t){if(typeof t=="string"&&t==="overlay")return"overlay";if(typeof t=="string"&&t.startsWith("data:"))return bm(t);if(typeof t=="string")return t;if(typeof t.src=="string")return t.src;if(typeof t.value<"u")return t.value;let n=t.baseTexture.resource;if(typeof n.data<"u")return{width:n.width,height:n.height,buffer:n.data};let i=n.source;if(i instanceof HTMLImageElement)return i.getAttribute("src");if(i instanceof HTMLCanvasElement)return Sm(i);throw console.error(t),new H}function Le(){return(game.release?.isNewer("12")??!1)&&!!foundry.applications.api.ApplicationV2}async function ge(t){return new Promise(e=>{setTimeout(e,t)})}function be(t){return CSS.supports("color",t)}function Y(t){return{backgroundType:t.background&&!be(t.background)?"image":"color",backgroundColor:be(t.background)?t.background:"",backgroundImage:!be(t.background)&&t.background?t.background:"",bgSizingMode:"stretch"}}function uo(){return[...game.macros?.contents.slice()??[],...game.packs?.contents.reduce((t,e)=>e.documentName!=="Macro"?t:[...t,...e.index.contents],[])??[]]}function ao(){return[...game.actors?.contents.slice()??[],...game.packs?.contents.reduce((t,e)=>e.documentName!=="Actor"?t:[...t,...e.index.contents],[])??[]]}function rt(t){let e=t.split(".");return e[0]!=="Compendium"?"":e[2]}function z(t){return u("BATTLETRANSITIONS.FORMATTERS.MILLISECONDS",{value:t.toLocaleString()})}function ot(t,e){if(typeof t!="object")throw new St(t);if(typeof e!="object")throw new St(e);for(let n in e)Array.isArray(e[n])?t[n]=e[n].slice():typeof e[n]=="object"?ot(t[n],e[n]):t[n]=e[n]}function gs(t){return typeof t=="string"&&t==="overlay"?"overlay":typeof t=="string"&&be(t)?"color":"image"}function Qn(t,e){let n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e.endsWith(".json")?e:`${e}.json`,r.click(),URL.revokeObjectURL(i)}async function _n(){let t=await vt(),e=[];if(!t)return null;if(!Array.isArray(t))throw new Tt;for(let n of t){let i=I(n.type);if(!i)throw new Tt;let r=i.validate(n,t),o=r instanceof Promise?await r:r;if(o instanceof Error)throw o;e.push(o)}return e}function vt(){return new Promise((t,e)=>{let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept","application/json"),n.onchange=i=>{let r=i.currentTarget.files?.[0];if(!r){e(new It);return}let o=new FileReader;o.onload=a=>{if(!a.target?.result)throw new It;typeof a.target.result=="string"&&t(JSON.parse(a.target.result))},o.readAsText(r)},n.onerror=(i,r,o,a,s)=>{e(s||new Error(typeof i=="string"?i:"undefined"))},n.click()})}function B(t,e,n,i,r,o,a){let s=document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new K;s.width=t,s.height=e;let l=c.createLinearGradient(n,i,r,o);for(let p of a)l.addColorStop(p.point,p.color);return c.fillStyle=l,c.fillRect(0,0,s.width,s.height),PIXI.Texture.from(s)}function U(t,e,n,i,r,o){let a=document.createElement("canvas"),s=a.getContext("2d");if(!s)throw new K;a.width=t,a.height=e;let c=s.createConicGradient(n,i,r);for(let l of o)c.addColorStop(l.point,l.color);return s.fillStyle=c,s.fillRect(0,0,a.width,a.height),PIXI.Texture.from(a)}function ne(t,e,n,i){return Math.atan2(i-e,n-t)}function ti(t,e,n){if(t&&typeof t.target=="string"&&t.target){let i=foundry.utils.parseUuid(t.target);if(i.primaryType!=="Scene")throw new D(t.target);let r=i.primaryId===e?.id?"old":i.primaryId===n?.id?"new":"";return Array.isArray(i.embedded)?`${r}${i.embedded[0].toLowerCase()}`:(i.type??"").toLowerCase()}else{if(t&&Array.isArray(t.target))return"point";if(t&&typeof t.target=="string"&&!t.target)return"prompt"}return"point"}function it(t){return parseInt(t).toString()==t?`${t}px`:t}function wt(t){let e=it(t),n=document.createElement("div");return n.style.fontSize=e,n.style.fontSize!==""}var me=document.createElement("div");me.style.display="none";me.style.position="absolute";me.style.width="100%";me.style.height="100%";me.style.backgroundRepeat="no-repeat";me.id=fi;document.body.appendChild(me);var ii=null;function ks(){ii=new gt,canvas?.stage?.addChild(ii)}async function Em(){if(!canvas)throw new K;if(!(canvas.app&&canvas.hidden&&canvas.primary&&canvas.tiles&&canvas.drawings&&canvas.scene&&canvas.stage))throw new zt;let t=window.innerWidth,e=window.innerHeight,n=canvas.app.renderer,i=PIXI.RenderTexture.create({width:t,height:e});n.render(canvas.stage,{renderTexture:i,skipUpdateTransform:!0,clear:!0});let r=document.getElementById(fi);if(!r)throw new Ut;r.style.backgroundImage="";let o=await n.extract.image(i),a=document.createElement("canvas"),s=a.getContext("2d");if(!s)throw new he;a.width=o.width,a.height=o.height,s.fillStyle=n.background.backgroundColor.toHex(),s.fillRect(0,0,a.width,a.height),s.drawImage(o,0,0);let c=a.toDataURL();return r.style.backgroundImage=`url(${c})`,r.style.backgroundColor=n.background.backgroundColor.toHex(),r.style.display="block",new PIXI.Sprite(i)}function Ts(t){t.sceneFilters.forEach(e=>M(e))}function _(t,e){Array.isArray(canvas?.environment?.filters)?canvas.environment.filters.push(t):canvas?.environment&&(canvas.environment.filters=[t]),e.sceneFilters.push(t)}function M(t){Array.isArray(canvas?.environment?.filters)&&canvas.environment.filters.includes(t)&&canvas.environment?.filters?.splice(canvas.environment.filters.indexOf(t),1),t.destroy()}async function Ss(){if(!ii)throw new he;let t=await Em(),e=new PIXI.Container;return e.width=window.innerWidth,e.height=window.innerHeight,e.addChild(t),ii.addChild(e),e}function bs(t){if(me.style.display="none",me.style.backgroundImage="",t){if(Array.isArray(t.children)&&t.children.length){let e=[...t.children??[]];for(let n of e)n.destroy()}t.destroy()}}function Es(){let t=document.getElementById("loading");t&&(t.style.opacity="0")}function hs(){let t=document.getElementById("loading");t&&t.style.removeProperty("opacity")}function Os(){me.style.display="none",me.style.removeProperty("backgroundImage")}async function Ds(t){let e=Yt(t);if(!(e instanceof Scene))throw new O(typeof t=="string"?t:"[Object object]");return await e.setFlag("battle-transitions","isTriggered",!0),e.activate(),await lt("canvasReady"),e}async function W(t){let e=0;for(let n of t){let i=I(n.type);if(!i)throw new T(typeof n.type=="string"?n.type:typeof n.type);let r=i.getDuration(n,t);e+=r instanceof Promise?await r:r}return e}function hm(t,e){for(var n=e.split("."),i=n.pop();e=n.shift();)if(t=t[e],t==null)return;return t[i]}function Fs(){return""}function Cr(t){var e={group:function(n,i){i=i||{};var r=i.fn||Fs,o=i.inverse||Fs,a=i.hash,s=a&&a.by,c=[],l={};if(!s||!n||!n.length)return o(this);function p(y){var g=hm(y,s);c.indexOf(g)===-1&&c.push(g),l[g]||(l[g]={value:g,items:[]}),l[g].items.push(y)}function f(y,g){return y+r(l[g])}return n.forEach(p),c.reduce(f,"")}};return t.registerHelper(e),t}Cr.register=Cr;var Ps=Cr;function Ms(){Handlebars.registerHelper("switch",function(t,e){this._switch_value_=t;let n=e.fn(this);return delete this._switch_value_,n}),Handlebars.registerHelper("case",function(t,e){if(t==this._switch_value_)return e.fn(this)}),Ps.register(Handlebars),Handlebars.registerHelper("formatDuration",function(t){return typeof t=="number"?z(t):typeof t=="string"&&!isNaN(parseFloat(t))?z(parseFloat(t)):"NaN"}),Handlebars.registerHelper("when",function(t,e,n,i){return{eq:function(a,s){return a==s},noteq:function(a,s){return a!=s},gt:function(a,s){return Number(a)>Number(s)},or:function(a,s){return a||s},and:function(a,s){return a&&s},"%":function(a,s){return a%s===0}}[e](t,n)?i.fn(this):i.inverse(this)})}async function Hs(){return loadTemplates(["/modules/battle-transitions/templates/scene-config.hbs",...["add-step","fade-config","linearwipe-config","step-item","background-selector","duration-selector","add-step-button","sequence-item","target-selector","dualtransition-selector"].map(t=>`/modules/battle-transitions/templates/config/${t}.hbs`),"/modules/battle-transitions/templates/scene-selector.hbs","/modules/battle-transitions/templates/transition-steps.hbs","/modules/battle-transitions/templates/font-selector.hbs","/modules/battle-transitions/templates/actor-selector.hbs"])}var $s=xr(Yi());var wm={},Bt;var Im=new RegExp(`([^.[]+|\\[('([^'\\\\]|\\\\.)+?'|"([^"\\\\]|\\\\.)+?")\\])`,"g"),ym=new RegExp(`(^\\['|'\\]$|^\\["|"\\]$)`,"g");Hooks.once("init",()=>{if(globalThis.libWrapper&&!(globalThis.libWrapper.is_fallback??!0)){Bt=globalThis.libWrapper;return}Bt=class{static get is_fallback(){return!0}static get WRAPPER(){return"WRAPPER"}static get MIXED(){return"MIXED"}static get OVERRIDE(){return"OVERRIDE"}static get LISTENER(){return"LISTENER"}static register(t,e,n,i="MIXED",{chain:r=void 0,bind:o=[]}={}){let a=e.endsWith("#set");e=a?e.slice(0,-4):e;let s=e.match(Im).map(G=>G.replace(/\\(.)/g,"$1").replace(ym,"")),c=s.splice(0,1)[0],l,p;if(s.length==0)l=globalThis,p=c;else{let G=eval;p=s.pop(),l=s.reduce((je,Ye)=>je[Ye],globalThis[c]??G(c))}let f=l,y=null;for(;f&&(y=Object.getOwnPropertyDescriptor(f,p),!y);)f=Object.getPrototypeOf(f);if(!y||y?.configurable===!1)throw new Error(`libWrapper Shim: '${e}' does not exist, could not be found, or has a non-configurable descriptor.`);let g=null,De=i==3||i.toUpperCase?.()=="OVERRIDE"||i==3,de=i==4||i.toUpperCase?.()=="LISTENER"||i==4?function(...G){return n.call(this,...o,...G),g.call(this,...G)}:r??!De?function(...G){return n.call(this,g.bind(this),...o,...G)}:function(...G){return n.call(this,...o,...G)};if(!a)y.value?(g=y.value,y.value=de):(g=y.get,y.get=de);else{if(!y.set)throw new Error(`libWrapper Shim: '${e}' does not have a setter`);g=y.set,y.set=de}y.configurable=!0,Object.defineProperty(l,p,y)}};{let[t,e]=(()=>{let n=(wm?.url??Error().stack)?.match(/\/(worlds|systems|modules)\/(.+)(?=\/)/i);if(n?.length!==3)return[null,null];let i=n[2].split("/");if(n[1]==="worlds")return i.find(a=>a&&game.world.id===a)?[game.world.id,game.world.title]:[null,null];if(n[1]==="systems")return i.find(a=>a&&game.system.id===a)?[game.system.id,game.system.title??game.system.data.title]:[null,null];let r=i.find(a=>a&&game.modules.has(a)),o=game.modules.get(r);return[r,o?.title??o?.data?.title]})();if(!t||!e){console.error("libWrapper Shim: Could not auto-detect package ID and/or title. The libWrapper fallback warning dialog will be disabled.");return}Hooks.once("ready",()=>{let n=e,i=`
				<p><b>'${e}' depends on the 'libWrapper' module, which is not present.</b></p>
				<p>A fallback implementation will be used, which increases the chance of compatibility issues with other modules.</p>
				<small><p>'libWrapper' is a library which provides package developers with a simple way to modify core Foundry VTT code, while reducing the likelihood of conflict with other packages.</p>
				<p>You can install it from the "Add-on Modules" tab in the <a href="javascript:game.shutDown()">Foundry VTT Setup</a>, from the <a href="https://foundryvtt.com/packages/lib-wrapper">Foundry VTT package repository</a>, or from <a href="https://github.com/ruipin/fvtt-lib-wrapper/">libWrapper's Github page</a>.</p></small>
			`,r="libwrapper-dont-remind-again";console.warn(`${e}: libWrapper not present, using fallback implementation.`),game.settings.register(t,r,{name:"",default:!1,type:Boolean,scope:"world",config:!1}),game.user.isGM&&!game.settings.get(t,r)&&new Dialog({title:n,content:i,buttons:{ok:{icon:'<i class="fas fa-check"></i>',label:"Understood"},dont_remind:{icon:'<i class="fas fa-times"></i>',label:"Don't remind me again",callback:()=>game.settings.set(t,r,!0)}}}).render(!0)})}});window.semver=$s.default;window.BattleTransition=P;Hooks.once("canvasReady",()=>{ks(),Hooks.callAll(pe.INITIALIZE)});Hooks.once("init",async()=>{Ms(),await Hs(),typeof Bt=="function"&&Bt.register("battle-transitions","Scene.prototype.update",function(t,...e){let n=e[0],i=Ee.GetSceneConfiguration(this);if(n.active&&i.autoTrigger&&i.sequence?.length&&!this.flags["battle-transitions"].isTriggered){delete n.active;let r=new fe({scene:this.id??""});if(P.executeSequence([{...fe.DefaultSettings,id:foundry.utils.randomID(),...r.config},...i.sequence]),Object.keys(n).length===0)return!1}return t(n)},"MIXED")});Hooks.on("renderSceneConfig",(t,e,n)=>{Ee.InjectSceneConfig(t,e,n)});Hooks.once("socketlib.ready",()=>{Ct.register(socketlib.registerModule("battle-transitions"))});Hooks.on("getSceneNavigationContext",(t,e)=>{Ee.AddToNavigationBar(e)});Hooks.on("preUpdatePlaylist",(t,e)=>{if(e.playing&&P.SuppressSoundUpdates)return!1});Hooks.on("preUpdatePlaylistSound",(t,e)=>{if(e.playing&&P.SuppressSoundUpdates)return!1});Hooks.on(pe.TRANSITION_START,(...t)=>{Qe("Transition start:",t)});Hooks.on(pe.TRANSITION_END,(...t)=>{Qe("Transition end:",t)});Hooks.on("updateScene",(t,e,n,i)=>{e.active&&(t.canUserModify(game.user,"update")&&t.unsetFlag("battle-transitions","isTriggered"),lt("canvasReady").then(()=>{Hooks.callAll(pe.SCENE_ACTIVATED,t)}).catch(console.error))});})();
